# Chapter9. ë°ì´í„° ì¡°ì§í™”

> í•˜ë‚˜ì˜ ê°’ì´ ì—¬ëŸ¬ ëª©ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤ë©´ í˜¼ë€ê³¼ ë²„ê·¸ë¥¼ ë‚³ëŠ”ë‹¤

## í›„ê¸° 

ì´ë²ˆ ì±•í„°ì—ì„œëŠ” `ë³€ìˆ˜ ìª¼ê°œê¸°(9.1)`ì™€ `íŒŒìƒ ë³€ìˆ˜ë¥¼ ì§ˆì˜ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°(9.2)`ê°€ í¥ë¯¸ë¡œì› ë‹¤.
í•˜ë‚˜ì˜ ë³€ìˆ˜ì— ì¬í• ë‹¹í•˜ì—¬ í™œìš©í•˜ê±°ë‚˜, í•˜ë‚˜ì˜ í•¨ìˆ˜ì—ì„œ ì—¬ëŸ¬ í–‰ìœ„ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²½ìš°ëŠ” í¬ê²Œ ì˜ì‹í•˜ì§€ ì•Šê³  ìì£¼ í•´ì™”ì—ˆë‹¤.
ë¦¬íŒ©í„°ë§ ê³¼ì •ì„ í†µí•´ `í•œ ê°€ì§€ ì—­í• ì„ ìˆ˜í–‰`í•œë‹¤ëŠ” ê²ƒì´ `í•¨ìˆ˜`ë‚˜ `ë³€ìˆ˜`ì™€ ê°™ì€ ì‘ì€ ë‹¨ìœ„ì—ë„ ì ìš©ë  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì„ ìˆ˜ ìˆì—ˆê³ , 
ì´ ê³¼ì •ì„ í†µí•´ ì½”ë“œ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì´ ê°œì„ ëœë‹¤ëŠ” ì ë„ ì¢‹ì•˜ë‹¤.

<br/>

ë°˜ë©´, `ì°¸ì¡°ë¥¼ ê°’(ê°ì²´)ìœ¼ë¡œ ë°”ê¾¸ê¸°(9.4)`ì™€ `ê°’(ê°ì²´)ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ê¸°(9.5)`ëŠ” ì˜ˆì‹œëŠ” ì‰½ê²Œ í•´ ë³¼ ìˆ˜ ìˆì—ˆì§€ë§Œ, ê°œë…ì€ í•œë²ˆì— ì´í•´ë˜ì§€ ì•ŠëŠ” ëŠë‚Œì´ì—ˆë‹¤
- `ì°¸ì¡°ë¥¼ ê°’(ê°ì²´)ìœ¼ë¡œ ë°”ê¾¸ê¸°(9.4)`:
  - ê³µìœ ëœ ê°ì²´ë¥¼ ì§ì ‘ ë©”ì„œë“œ í˜¸ì¶œí•´ ê°±ì‹ í•˜ëŠ” ë°©ì‹ì—ì„œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ë³€ê²½ì„ ë°˜ì˜í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì „í™˜
  - ë³€ê²½ì´ ì¼ì–´ë‚  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ê°’ ê°ì²´ê°€ ìƒì„±ë˜ë¯€ë¡œ, ë³€ê²½ì˜ íë¦„ì„ ë” ì‰½ê²Œ ì¶”ì  (**ë¶ˆë³€ì„± ìœ ì§€**)
- `ê°’(ê°ì²´)ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ê¸°(9.5)`: 
  - ê¸°ì¡´ì—ëŠ” ë…ë¦½ì ì¸ ê°’ ê°ì²´ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ, ì´ë¥¼ ê³µìœ ëœ ì°¸ì¡° ê°ì²´ë¡œ ì „í™˜í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë ¤ëŠ” ëª©ì 
  - ì¤‘ë³µ ë°ì´í„°ë¥¼ ì¤„ì´ê³ , íŠ¹ì • ê°ì²´ë¥¼ ì—¬ëŸ¬ ê³³ì—ì„œ ë™ì¼í•œ ì°¸ì¡°ë¡œ ì‚¬ìš©
  - (ë‚´ ìƒê°) ìì›ì„ ê´€ë¦¬í•˜ëŠ” ì €ì¥ì†Œê°€ ìˆê³ , ì°¸ì¡°ë¥¼ ê³µìœ í•´ì„œ ì‚¬ìš©í•œë‹¤ë©´ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì¼ ë•Œ ë™ì‹œì„± ì´ìŠˆë¥¼ ê³ ë ¤í•´ì•¼ í•˜ì§€ ì•Šë‚˜ ì‹¶ë‹¤
---

## í•™ìŠµ ê¸°ë¡
**ëª©ì°¨**
- [9.1 ë³€ìˆ˜ ìª¼ê°œê¸°](#91-ë³€ìˆ˜-ìª¼ê°œê¸°)
- [9.2 í•„ë“œ ì´ë¦„ ë°”ê¾¸ê¸°](#92-í•„ë“œ-ì´ë¦„-ë°”ê¾¸ê¸°)
- [9.3 íŒŒìƒ ë³€ìˆ˜ë¥¼ ì§ˆì˜ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°](#93-íŒŒìƒ-ë³€ìˆ˜ë¥¼-ì§ˆì˜-í•¨ìˆ˜ë¡œ-ë°”ê¾¸ê¸°)
- [9.4 ì°¸ì¡°ë¥¼ ê°’ìœ¼ë¡œ ë°”ê¾¸ê¸°](#94--ì°¸ì¡°ë¥¼-ê°’ìœ¼ë¡œ-ë°”ê¾¸ê¸°)
- [9.5 ê°’ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ê¸°](#95-ê°’ì„-ì°¸ì¡°ë¡œ-ë°”ê¾¸ê¸°)
- [9.6 ë§¤ì§ ë¦¬í„°ëŸ´ ë°”ê¾¸ê¸°](#96-ë§¤ì§-ë¦¬í„°ëŸ´-ë°”ê¾¸ê¸°)

<br/>

### 9.1 ë³€ìˆ˜ ìª¼ê°œê¸°
- ì¹´íƒˆë¡œê·¸: [Split Variable](https://refactoring.com/catalog/splitVariable.html)
- ë°”ë¡œê°€ê¸°
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch09/ex1)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch09/ex1)

<br/>

**ë°°ê²½**
- ì—­í• ì´ ë‘˜ ì´ìƒì¸ ë³€ìˆ˜ê°€ ìˆë‹¤ë©´ ìª¼ê°œì•¼ í•œë‹¤
  - ì˜ˆì™¸ë€ ì—†ë‹¤
  - ì—­í•  í•˜ë‚˜ë‹¹ ë³€ìˆ˜ í•˜ë‚˜ë‹¤
- ì—¬ëŸ¬ ìš©ë„ë¡œ ì“°ì¸ ë³€ìˆ˜ëŠ” ì½”ë“œë¥¼ ì½ëŠ” ì´ì—ê²Œ ì»¤ë‹¤ë€ í˜¼ë€ì„ ì£¼ê¸° ë•Œë¬¸ì´ë‹¤

<br/>

**ì ˆì°¨**
- ë³€ìˆ˜ë¥¼ ì„ ì–¸í•œ ê³³ê³¼ ê°’ì„ ì²˜ìŒ ëŒ€ì…í•˜ëŠ” ê³³ì—ì„œ ë³€ìˆ˜ ì´ë¦„ì„ ë°”ê¾¼ë‹¤
- ê°€ëŠ¥í•˜ë©´ ì´ë•Œ `ë¶ˆë³€(immutable)`ìœ¼ë¡œ ì„ ì–¸í•œë‹¤
- ì´ ë³€ìˆ˜ì— ë‘ ë²ˆì§¸ë¡œ ê°’ì„ ëŒ€ì…í•˜ëŠ” ê³³ ì•ê¹Œì§€ì˜ ëª¨ë“  ì°¸ì¡°(ì´ ë³€ìˆ˜ê°€ ì“°ì¸ ê³³)ë¥¼ ìƒˆë¡œìš´ ë³€ìˆ˜ ì´ë¦„ìœ¼ë¡œ ë°”ê¾¼ë‹¤
- ë‘ ë²ˆì§¸ ëŒ€ì… ì‹œ ë³€ìˆ˜ë¥¼ ì›ë˜ ì´ë¦„ìœ¼ë¡œ ë‹¤ì‹œ ì„ ì–¸í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ë°˜ë³µí•œë‹¤. ë§¤ ë°˜ë³µì—ì„œ ë³€ìˆ˜ë¥¼ ìƒˆë¡œìš´ ì´ë¦„ìœ¼ë¡œ ì„ ì–¸í•˜ê³  ë‹¤ìŒë²ˆ ëŒ€ì… ë•Œê¹Œì§€ì˜ ëª¨ë“  ì°¸ì¡°ë¥¼ ìƒˆ ë³€ìˆ˜ëª…ìœ¼ë¡œ ë°”ê¾¼ë‹¤
  - ì´ ê³¼ì •ì„ ë§ˆì§€ë§‰ ëŒ€ì…ê¹Œì§€ ë°˜ë³µí•œë‹¤
<br/>

**ğŸ’©before**
```java
public double distanceTravelled(Scenario scenario, int time) {
    double acc = scenario.primaryForce() / scenario.mass(); // ê°€ì†ë„(a) = í˜(F) / ì§ˆëŸ‰(m)
    int primaryTime = Math.min(time, scenario.delay());
    double result = 0.5 * acc * primaryTime * primaryTime; // ì „íŒŒëœ ê±°ë¦¬
    int secondaryTime = time - scenario.delay();
    if (secondaryTime > 0) { // ë‘ ë²ˆì§¸ í˜ì„ ë°˜ì˜í•´ ë‹¤ì‹œ ê³„ì‚°
      double primaryVelocity = acc * scenario.delay();
      acc = (scenario.primaryForce() + scenario.secondaryForce()) / scenario.mass();
      result += primaryVelocity * secondaryTime + 0.5 * acc * secondaryTime * secondaryTime;
    }

    return result;
}
```
- acc ë³€ìˆ˜ì— ê°’ì´ ë‘ ë²ˆ ëŒ€ì…ëœë‹¤ = `ì—­í• ì´ ë‘ ê°œë¼ëŠ” ì‹ í˜¸`
  - ì²« ë²ˆì§¸ í˜ì´ ìœ ë°œí•œ ì´ˆê¸° ê°€ì†ë„ë¥¼ ì €ì¥í•˜ëŠ” ì—­í• 
  - ë‘ ë²ˆì§¸ í˜ê¹Œì§€ ë°˜ì˜ëœ í›„ì˜ ê°€ì†ë„ë¥¼ ì €ì¥í•˜ëŠ” ì—­í• 
  - ìª¼ê°œì•¼í•  ë³€ìˆ˜ë‹¤
<br/>

> í•¨ìˆ˜ë‚˜ íŒŒì¼ì—ì„œ íŠ¹ì • ì‹¬ë²Œì´ ì“°ì¸ ìœ„ì¹˜ë¥¼ ì‹œê°ì ìœ¼ë¡œ ê°•ì¡°í•´ì£¼ëŠ” ì½”ë“œ í¸ì§‘ê¸°ë¥¼ ì‚¬ìš©í•˜ë©´ ë³€ìˆ˜ì˜ ì“°ì„ì„ ë¶„ì„í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤.
> ë¬¼ë¡  ìš”ì¦˜ í¸ì§‘ê¸°ë“¤ì€ ëŒ€ë¶€ë¶„ ì§€ì›í•œë‹¤

**âœ¨after**
```java
public static double distanceTravelled(Scenario scenario, int time) {
    double primaryAcceleration = scenario.primaryForce() / scenario.mass(); // ê°€ì†ë„(a) = í˜(F) / ì§ˆëŸ‰(m)
    int primaryTime = Math.min(time, scenario.delay());
    double result = 0.5 * primaryAcceleration * primaryTime * primaryTime; // ì „íŒŒëœ ê±°ë¦¬
    int secondaryTime = time - scenario.delay();
    if (secondaryTime > 0) { // ë‘ ë²ˆì§¸ í˜ì„ ë°˜ì˜í•´ ë‹¤ì‹œ ê³„ì‚°
      double primaryVelocity = primaryAcceleration * scenario.delay();
      double secondaryAcceleration =
          (scenario.primaryForce() + scenario.secondaryForce()) / scenario.mass();
      result +=
          primaryVelocity * secondaryTime
              + 0.5 * secondaryAcceleration * secondaryTime * secondaryTime;
    }

    return result;
  }
```
- `primaryVelocity` ì™€ `secondaryAcceleration` ë³€ìˆ˜ëª…ìœ¼ë¡œ ë¶„ë¦¬
<br/>

**ğŸ’©before**
```javascript
function discount(inputValue, quantity) {
    if(inputValue > 50) inputValue = inputValue - 2;
    if(quantity > 100) inputValue = inputValue - 1;
    return inputValue;
}
```
- ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë§¤ê°œë³€ìˆ˜ëŠ” ê°’ì— ì˜í•œ í˜¸ì¶œ(call by value) ë°©ì‹ìœ¼ë¡œ ì „ë‹¬ë¨
  - `inputValue`ë¥¼ ìˆ˜ì •í•´ë„ í˜¸ì¶œìì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤
<br/>


**âœ¨after**
```javascript
// 1. inputValueë¥¼ ìª¼ê° ë‹¤
function discount(originalInputValue, quantity) {
    let inputValue = originalInputValue;
    if(inputValue > 50) inputValue -= 2;
    if(quantity > 100) inputValue -= 1;
    return inputValue;
}

// 2. ë³€ìˆ˜ ì´ë¦„ ë°”ê¾¸ê¸°ë¥¼ ë‘ ë²ˆ ìˆ˜í–‰í•´ì„œ ê°ê°ì˜ ì“°ì„ì— ì–´ìš¸ë¦¬ëŠ” ì´ë¦„ì„ ì§€ì–´ì¤€ë‹¤
function discount(inputValue, quantity) {
  let result = inputValue;
  if(inputValue > 50) result -= 2;
  if(quantity > 100) result -= 1;
  return result;
}
```
<br/>

### 9.2 í•„ë“œ ì´ë¦„ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Rename Field](https://refactoring.com/catalog/renameField.html)
- ë°”ë¡œê°€ê¸°
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch09/ex2)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch09/ex2)

<br/>

**ë°°ê²½**
- ì´ë¦„ì€ ì¤‘ìš”í•˜ë‹¤
- ë ˆì½”ë“œ êµ¬ì¡°ì²´ì˜ í•„ë“œ ì´ë¦„ë“¤ì€ íŠ¹íˆ ë” ì¤‘ìš”í•˜ë‹¤
- ë°ì´í„° êµ¬ì¡°ëŠ” í”„ë¡œê·¸ë¨ì„ ì´í•´í•˜ëŠ” ë° í° ì—­í• ì„ í•œë‹¤
  - ë°ì´í„° êµ¬ì¡°ê°€ ì¤‘ìš”í•œ ë§Œí¼ ë°˜ë“œì‹œ ê¹”ë”í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í•œë‹¤

<br/>

**ì ˆì°¨**
- ë ˆì½”ë“œì˜ ìœ íš¨ ë²”ìœ„ê°€ ì œí•œì ì´ë¼ë©´ í•„ë“œì— ì ‘ê·¼í•˜ëŠ” ëª¨ë“  ì½”ë“œë¥¼ ìˆ˜ì •í•œ í›„ í…ŒìŠ¤íŠ¸í•œë‹¤
  - ì´í›„ ë‹¨ê³„ëŠ” í•„ìš” ì—†ë‹¤
- ë ˆì½”ë“œê°€ ìº ìŠí™”ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìš°ì„  ë ˆì½”ë“œë¥¼ `ìº¡ìŠí™”(7.1)`í•œë‹¤
- ìº¡ìŠí™”ëœ ê°ì²´ ì•ˆì˜ private í•„ë“œëª…ì„ ë³€ê²½í•˜ê³ , ê·¸ì— ë§ê²Œ ë‚´ë¶€ ë©”ì„œë“œë“¤ì„ ìˆ˜ì •í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ìƒì„±ìì˜ ë§¤ê°œë³€ìˆ˜ ì¤‘ í•„ë“œì™€ ì´ë¦„ì´ ê²¹ì¹˜ëŠ” ê²Œ ìˆë‹¤ë©´ `í•¨ìˆ˜ ì„ ì–¸ ë°”ê¾¸ê¸°(6.5)`ë¡œ ë³€ê²½í•œë‹¤
- ì ‘ê·¼ìë“¤ì˜ ì´ë¦„ë„ ë°”ê¿”ì¤€ë‹¤
<br/>

**ğŸ’©before**
```java
public class Organization {
  private String name;
  private String country;

  public Organization(String name, String country) {
    this.name = name;
    this.country = country;
  }
  
  // getter, setter ìƒëµ
}
```
- `name` ì„ `title`ë¡œ ë°”ê¾¸ëŠ” ê³¼ì •ì„ ë‹¤ë£¬ë‹¤ 
<br/>

> **WARNING** ë‹¨, ë¦¬íŒ©í„°ë§ ë„ì¤‘ í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í•œë‹¤ë©´ ë” ì‘ì€ ë‹¨ê³„ë¡œ ë‚˜ëˆ  ì§„í–‰í•´ì•¼ í•œë‹¤ëŠ” ì‹ í˜¸ì„ì„ ìŠì§€ ë§ì

**âœ¨after**
```java
public class Organization {
  private String title;
  private String country;

  public Organization(String title, String country) {
    this.title = title;
    this.country = country;
  }
    
  // getter, setter
}
```
- ì±…ì—ì„œëŠ” ì ì§„ì ìœ¼ë¡œ í•„ë“œëª… ë°”ê¾¸ëŠ” ê³¼ì •ì„ ë¦¬íŒ©í„°ë§í•œë‹¤
  - Intellij ì—ì„œ ì œê³µí•˜ëŠ” ë¦¬íŒ©í„°ë§ ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ í•œêº¼ë²ˆì— ë³€ê²½í•  ìˆ˜ ìˆë‹¤
<br/>


### 9.3 íŒŒìƒ ë³€ìˆ˜ë¥¼ ì§ˆì˜ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Derived Variable with Query](https://refactoring.com/catalog/replaceDerivedVariableWithQuery.html)
- ë°”ë¡œê°€ê¸°
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch09/ex3)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch09/ex3)

<br/>

**ë°°ê²½**
- ê°€ë³€ ë°ì´í„°ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ì— ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ” ê°€ì¥ í° ê³¨ì¹®ê±°ë¦¬ì— ì†í•œë‹¤
- ì˜ˆì»¨ëŒ€ í•œ ìª½ ì½”ë“œì—ì„œ ìˆ˜ì •í•œ ê°’ì´ ì—°ì‡„ íš¨ê³¼ë¥¼ ì¼ìœ¼ì¼œ ë‹¤ë¥¸ ìª½ ì½”ë“œì— ì›ì¸ì„ ì°¾ê¸° ì–´ë ¤ìš´ ë¬¸ì œë¥¼ ì•¼ê¸°í•˜ê¸°ë„ í•œë‹¤
- ì´ì— ì €ìëŠ” **ê°€ë³€ ë°ì´í„°ì˜ ìœ íš¨ ë²”ìœ„ë¥¼ ê°€ëŠ¥í•œ í•œ ì¢í˜€ì•¼ í•œë‹¤ê³  ì£¼ì¥í•œë‹¤**
- íš¨ê³¼ê°€ ì¢‹ì€ ë°©ë²•ìœ¼ë¡œ, <u>ê°’ì„ ì‰½ê²Œ ê³„ì‚°í•´ë‚¼ ìˆ˜ ìˆëŠ” ë³€ìˆ˜ë“¤ì€ ëª¨ë‘ ì œê±°í•  ìˆ˜ ìˆë‹¤</u>

<br/>

**ì ˆì°¨**
- ë³€ìˆ˜ ê°’ì´ ê°±ì‹ ë˜ëŠ” ì§€ì ì„ ëª¨ë‘ ì°¾ëŠ”ë‹¤. í•„ìš”í•˜ë©´ ë³€ìˆ˜ ìª¼ê°œê¸°(9.1)ì„ í™œìš©í•´ ê° ê°±ì‹  ì§€ì ì—ì„œ ë³€ìˆ˜ë¥¼ ë¶„ë¦¬í•œë‹¤
- í•´ë‹¹ ë³€ìˆ˜ì˜ ê°’ì„ ê³„ì‚°í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤
- í•´ë‹¹ ë³€ìˆ˜ê°€ ì‚¬ìš©ë˜ëŠ” ëª¨ë“  ê³³ì— ì–´ì„œì…˜ì„ ì¶”ê°€í•˜ì—¬ í•¨ìˆ˜ì˜ ê²Œì‚° ê²°ê³¼ê°€ ë³€ìˆ˜ì˜ ê°’ê³¼ ê°™ì€ì§€ í™•ì¸í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ë³€ìˆ˜ë¥¼ ì½ëŠ” ì½”ë“œë¥¼ ëª¨ë‘ í•¨ìˆ˜ í˜¸ì¶œë¡œ ëŒ€ì²´í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ë³€ìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ê°±ì‹ í•˜ëŠ” ì½”ë“œë¥¼ `ì£½ì€ ì½”ë“œ ì œê±°í•˜ê¸°(8.9)`ë¡œ ì—†ì•¤ë‹¤
<br/>


**ğŸ’©before**
```java
public class ProductionPlan {
  private int production;
  private List<Adjustment> adjustments;
  
  //..

  public int production() {
      return this.production;
  }
  
  public void applyAdjustment(Adjustment adjustment) {
    this.adjustments.add(adjustment);
    this.production += adjustment.amount();
  }
}
```
- ì¼ë°˜ì ì¸ ì½”ë“œ ì¤‘ë³µì€ ì•„ë‹ˆê³ , `ë°ì´í„° ì¤‘ë³µ`ì´ë‹¤
- ì´ ì½”ë“œëŠ” ì¡°ì • ê°’ adjustmentë¥¼ ì ìš©í•˜ëŠ” ê³¼ì •ì—ì„œ ì§ì ‘ ê´€ë ¨ ì—†ëŠ” ëˆ„ì  ê°’ productionê¹Œì§€ ê°±ì‹ í–ˆë‹¤
- ê·¸ëŸ°ë° ì´ ëˆ„ì  ê°’ì€ ë§¤ë²ˆ ê°±ì‹ í•˜ì§€ ì•Šê³ ë„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤ (ê°€ì •)
<br/>


**âœ¨after**
```java
public class ProductionPlan {
  private int production;
  private List<Adjustment> adjustments;

  public ProductionPlan() {
    this.production = 0;
    this.adjustments = new ArrayList<>();
  }

  public int getProduction() {
    return this.adjustments.stream().mapToInt(Adjustment::amount).sum();
  }

  public void applyAdjustment(Adjustment adjustment) {
    this.adjustments.add(adjustment);
  }
}
```
<br/>

**ğŸ’©before**

```java
import java.util.ArrayList;

public class ProductionPlan {
  private int production;
  private List<Adjustment> adjustments;

  public ProductionPlan(int production) {
    this.production = production;
    adjustments = new ArrayList<>();
  }

  public int production() {
    return this.production;
  }

  public void applyAdjustment(Adjustment adjustment) {
    this.adjustments.add(adjustment);
    this.production += adjustment.amount();
  }
}
```
- ì–´ì„œì…˜ ì½”ë“œë¥¼ ì•ì˜ ì˜ˆì™€ ë˜‘ê°€íŒ… ì‘ì„±í•œë‹¤ë©´ productionì˜ ì´ˆê¸° ê°’ì´ 0ì´ ì•„ë‹ˆë©´ ì‹¤íŒ¨í•˜ê³  ë§Œë‹¤
- ì´ íŒŒìƒ ë°ì´í„°ë¥¼ ëŒ€ì²´í•  ë°©ë²•ì€ ì‚¬ì‹¤ ê°„ë‹¨í•˜ë‹¤
  - ì•ì—ì„œì™€ì˜ ì°¨ì´ë¼ë©´ ë³€ìˆ˜ ìª¼ê°œê¸°(9.1)ì„ ë¨¼ì € ì ìš©í•˜ëŠ” ê²ƒ ë¿ì´ë‹¤
<br/>

```java
import java.util.ArrayList;

public class ProductionPlan {
  private int initialProduction;
  private int productionAccumulator;
  private List<Adjustment> adjustments;

  public ProductionPlan(int production) {
    this.initialProduction = production;  
    this.productionAccumulator = 0;
    adjustments = new ArrayList<>();
  }

  public int production() {
    return this.initialProduction + this.productionAccumulator;
  }

  public void applyAdjustment(Adjustment adjustment) {
    this.adjustments.add(adjustment);
    this.production += adjustment.amount();
  }
}
```
<br/>

```java
import java.util.ArrayList;

public class ProductionPlan {
  private int initialProduction;
  private int productionAccumulator;
  private List<Adjustment> adjustments;

  public ProductionPlan(int production) {
    this.initialProduction = production;  
    this.productionAccumulator = 0;
    adjustments = new ArrayList<>();
  }

  public int production() {
    assert this.productionAccumulator == this.calculatedProductionAccumulator();  
    return this.initialProduction + this.productionAccumulator;
  }
  
  private int calculatedProductionAccumulator() {
      return this.adjustments.stream().mapToInt(Adjustment::amount).sum();
  }

  public void applyAdjustment(Adjustment adjustment) {
    this.adjustments.add(adjustment);
    this.production += adjustment.amount();
  }
}
```
- ê·¸ ë‹¤ìŒì€ ì´ì „ê³¼ ê°™ë‹¤
- ë‹¤ë§Œ ì´ë²ˆì—ëŠ” `calculatedProductionAccumulator()`ë¥¼ ì¸ë¼ì¸í•˜ì§€ ì•Šê³  ì†ì„±ìœ¼ë¡œ ë‚¨ê²¨ë‘ëŠ” í¸ì´ ë‚˜ì•„ ë³´ì¸ë‹¤

### 9.4 ì°¸ì¡°ë¥¼ ê°’ìœ¼ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Change Reference to Value](https://refactoring.com/catalog/changeReferenceToValue.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§ [ê°’ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ê¸°](#95-ê°’ì„-ì°¸ì¡°ë¡œ-ë°”ê¾¸ê¸°)
- ë°”ë¡œê°€ê¸°
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch09/ex4)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch09/ex4)

<br/>

**ë°°ê²½**
- í•„ë“œë¥¼ ê°’ìœ¼ë¡œ ë‹¤ë£¬ë‹¤ë©´ ë‚´ë¶€ ê°ì²´ì˜ í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•˜ì—¬ `ê°’ ê°ì²´(VO: Value Object)`ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤
- ê°’ ê°ì²´ëŠ” ëŒ€ì²´ë¡œ ììœ ë¡­ê²Œ í™œìš©í•˜ê¸° ì¢‹ì€ë°, íŠ¹íˆ **ë¶ˆë³€**ì´ê¸° ë•Œë¬¸ì´ë‹¤
- ì¼ë°˜ì ìœ¼ë¡œ ë¶ˆë³€ ë°ì´í„° êµ¬ì¡°ëŠ” ë‹¤ë£¨ê¸° ë” ì‰½ë‹¤.
- ë¶ˆë³€ ë°ì´í„° ê°’ì€ í”„ë¡œê·¸ë¨ ì™¸ë¶€ë¡œ ê±´ë„¤ì¤˜ë„ ë‚˜ì¤‘ì— ê·¸ ê°’ì´ ëª°ë˜ ë°”ë€Œì–´ì„œ ë‚´ë¶€ì— ì˜í–¥ì„ ì¤„ê¹Œ ì—¼ë ¤í•˜ì§€ ì•Šì•„ë„ ëœë‹¤
- ë°˜ë©´, ì´ë²ˆ ë¦¬íŒ©í„°ë§ì„ ì ìš©í•˜ë©´ ì•ˆë˜ëŠ” ìƒí™©ë„ ìˆë‹¤
  - ì˜ˆì»¨ëŒ€ íŠ¹ì • ê°ì²´ë¥¼ ì—¬ëŸ¬ ê°ì²´ì— ê³µìœ í•˜ê³ ì í•œë‹¤ë©´, ê·¸ë˜ì„œ ê³µìœ  ê°ì²´ì˜ ê°’ì´ ë³€ê²½í–ˆì„ ë–„ ì´ë¥¼ ê´€ë ¨ ê°ì²´ ëª¨ë‘ì— ì•Œë ¤ì¤˜ì•¼ í•œë‹¤ë©´ ê³µìœ  ê°ì²´ë¥¼ ì°¸ì¡°ë¡œ ë‹¤ë¤„ì•¼ í•œë‹¤

<br/>

**ì ˆì°¨**
- í›„ë³´ í´ë˜ìŠ¤ê°€ ë¶ˆë³€ì¸ì§€, í˜¹ì¸ ë¶ˆë³€ì´ ë  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤
- ê°ê°ì˜ ì„¸í„°ë¥¼ í•˜ë‚˜ì”© ì œê±°(11.7)í•œë‹¤
- ì´ ê°’ ê°ì²´ì˜ í•„ë“œë“¤ì„ ì‚¬ìš©í•˜ëŠ” **ë™ì¹˜ì„±(equality)** ë¹„êµ ë©”ì„œë“œë¥¼ ë§Œë“ ë‹¤
  <br/>


**ğŸ’©before**
```java
public class Person {
  private TelephoneNumber telephoneNumber;

  public Person(TelephoneNumber telephoneNumber) {
    this.telephoneNumber = telephoneNumber;
  }

  public String officeAreaCode() {
    return this.telephoneNumber.getAreaCode();
  }

  public void officeAreaCode(String arg) {
    this.telephoneNumber.setNumber(arg);
  }

  public String officeNumber() {
    return this.telephoneNumber.getNumber();
  }

  public void officeNumber(String arg) {
    this.telephoneNumber.setNumber(arg);
  }
}


public class TelephoneNumber {
  private String areaCode;
  private String number;

  public TelephoneNumber(String areaCode, String number) {
    this.areaCode = areaCode;
    this.number = number;
  }
  
  // getter, setter ìƒëµ
}
```
<br/>


**âœ¨after**
```java
public class Person {
  private TelephoneNumber telephoneNumber;

  public Person(TelephoneNumber telephoneNumber) {
    this.telephoneNumber = telephoneNumber;
  }

  public String officeAreaCode() {
    return this.telephoneNumber.getAreaCode();
  }

  public void officeAreaCode(String arg) {
    this.telephoneNumber = new TelephoneNumber(arg, this.officeNumber());
  }

  public String officeNumber() {
    return this.telephoneNumber.getNumber();
  }

  public void officeNumber(String arg) {
    this.telephoneNumber = new TelephoneNumber(this.officeAreaCode(), arg);
  }
}

public class TelephoneNumber {
  private final String areaCode;
  private final String number;

  public TelephoneNumber(String areaCode, String number) {
    this.areaCode = areaCode;
    this.number = number;
  }
  
  // getter
}
```
<br/>


### 9.5 ê°’ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Change Value to Reference](https://refactoring.com/catalog/changeValueToReference.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§ [ì°¸ì¡°ë¥¼ ê°’ìœ¼ë¡œ ë°”ê¾¸ê¸°](#94-ì°¸ì¡°ë¥¼-ê°’ìœ¼ë¡œ-ë°”ê¾¸ê¸°)
- ë°”ë¡œê°€ê¸°
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch09/ex5)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch09/ex5)

<br/>

**ë°°ê²½**
- ë…¼ë¦¬ì ìœ¼ë¡œ ê°™ì€ ë°ì´í„°ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ë³µì œí•´ ì‚¬ìš©í•  ë•Œ ê°€ì¥ í¬ê²Œ ë¬¸ì œë˜ëŠ” ìƒí™©ì€ ê·¸ ë°ì´í„°ë¥¼ ê°±ì‹ í•´ì•¼ í•  ë•Œë‹¤
- ëª¨ë“  ë³µì œë³¸ì„ ì°¾ì•„ì„œ ë¹ ì§ì—†ì´ ê°±ì‹ í•´ì•¼ í•˜ë©°, í•˜ë‚˜ë¼ë„ ë†“ì¹˜ë©´ ë°ì´í„° ì¼ê´€ì„±ì´ ê¹¨ì ¸ë²„ë¦°ë‹¤
- ì´ëŸ° ìƒí™©ì´ë¼ë©´ ë³µì œëœ ë°ì´í„°ë“¤ì„ ëª¨ë‘ ì°¸ì¡°ë¡œ ë°”ê¿”ì£¼ëŠ”ê²Œ ì¢‹ë‹¤
- ë°ì´í„°ê°€ í•˜ë‚˜ë©´ ê°±ì‹ ëœ ë‚´ìš©ì´ í•´ë‹¹ ê³ ê°ì˜ ì£¼ë¬¸ ëª¨ë‘ì— ê³§ë°”ë¡œ ë°˜ì˜ë˜ê¸° ë–„ë¬¸ì´ë‹¤
- ê°’ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ë©´ ì—”í‹°í‹°(entity) í•˜ë‚˜ë‹¹ ê°ì²´ë„ ë‹¨ í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ê²Œ ë˜ëŠ”ë°, ê·¸ëŸ¬ë©´ ë³´í†µ ì´ëŸ° ê°ì²´ë“¤ì„ í•œë° ëª¨ì•„ë†“ê³  í´ë¼ì´ì–¸íŠ¸ë“¤ì˜ ì ‘ê·¼ì„ ê´€ë¦¬í•´ì£¼ëŠ” ì¼ì¢…ì˜ ì €ì¥ì†Œê°€ í•„ìš”í•´ì§„ë‹¤
  - (ë‚´ ìƒê°) ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë ˆì´ìŠ¤ ì»¨ë””ì…˜, ë°ì´í„° ì •í•©ì„± ë¬¸ì œë¥¼ ê³ ë ¤í•´ì•¼ í•˜ì§€ ì•Šë‚˜ ì‹¶ë‹¤

<br/>

**ì ˆì°¨**
- ê°™ì€ ë¶€ë¥˜ì— ì†í•˜ëŠ” ê°ì²´ë“¤ì„ ë³´ê´€í•  ì €ì¥ì†Œë¥¼ ë§Œë“ ë‹¤(ì´ë¯¸ ìˆë‹¤ë©´ ìƒëµ)
- ìƒì„±ìì—ì„œ ì´ ë¶€ë¥˜ì˜ ê°ì²´ë“¤ ì¤‘ íŠ¹ì • ê°ì²´ë¥¼ ì •í™•íˆ ì°¾ì•„ë‚´ëŠ” ë°©ë²•ì´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤
- í˜¸ìŠ¤íŠ¸ ê°ì²´ì˜ ìƒì„±ìë“¤ì„ ìˆ˜ì •í•˜ì—¬ í•„ìš”í•œ ê°ì²´ë¥¼ ì´ ì €ì¥ì†Œì—ì„œ ì°¾ë„ë¡ í•œë‹¤
  - í•˜ë‚˜ ìˆ˜ì •í•  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Order {
  private final int number;
  private final Customer customer;

  public Order(int number, Customer customer) {
    this.number = number;
    this.customer = new Customer(customer.getId());
  }

  public Customer getCustomer() {
    return customer;
  }
}


public class Customer {
  private final int id;

  public Customer(int id) {
    this.id = id;
  }

  public int getId() {
    return id;
  }
}
```
<br/>


**âœ¨after**
```java
public class RepositoryData {
  private final Map<Integer, Customer> customers;

  public RepositoryData() {
    this(new HashMap<>());
  }

  public RepositoryData(Map<Integer, Customer> customers) {
    this.customers = customers;
  }

  public Customer registerCustomer(Integer id) {
    if (!customers.containsKey(id)) {
      customers.put(id, new Customer(id));
    }

    return findCustomer(id);
  }

  public Customer findCustomer(Integer id) {
    return customers.get(id);
  }
}


public class Order {
  private final int number;
  private final Customer customer;

  public Order(int number, int customerId, RepositoryData repository) {
    this.number = number;
    this.customer = repository.registerCustomer(customerId); // ì°¸ì¡°ë¥¼ ê°€ì ¸ì˜´
  }
}
```
<br/>

```java
class OrderTest {

  @Test
  void createWithSameCustomerId() {
    RepositoryData repositoryData = new RepositoryData(); // ì¤‘ì•™ ê´€ë¦¬ ê°ì²´

    Order order1 = new Order(1, 2, repositoryData);
    Order order2 = new Order(1, 2, repositoryData); // ê°™ì€ ê³ ê° ID ì‚¬ìš©

    assertThat(order1.getCustomer()).isEqualTo(order2.getCustomer());
  }
}
```

### 9.6 ë§¤ì§ ë¦¬í„°ëŸ´ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Magic Literal](https://refactoring.com/catalog/replaceMagicLiteral.html)

<br/>

**ë°°ê²½**
- ì½”ë“œ ìì²´ê°€ ëœ»ì„ ë¶„ëª…í•˜ê²Œ ë“œëŸ¬ë‚´ëŠ” ê²Œ ì¢‹ë‹¤ 
- ìƒìˆ˜ë¥¼ ì •ì˜í•˜ê³  ìˆ«ì ëŒ€ì‹  ìƒìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë°”ê¾¸ë©´ ë  ê²ƒì´ë‹¤

<br/>

**ì ˆì°¨**
- ìƒìˆ˜ë¥¼ ì„ ì–¸í•˜ê³  ë§¤ì§ ë¦¬í„°ëŸ´ì„ ëŒ€ì…í•œë‹¤
- í•´ë‹¹ ë¦¬í„°ëŸ´ì´ ì‚¬ìš©ë˜ëŠ” ê³³ì„ ëª¨ë‘ ì°¾ëŠ”ë‹¤
- ì°¾ì€ ê³³ ê°ê°ì—ì„œ ë¦¬í„°ëŸ´ì´ ìƒˆ ìƒìˆ˜ì™€ ë˜‘ê°™ì€ ì˜ë¯¸ë¡œ ì“°ì˜€ëŠ”ì§€ í™•ì¸í•˜ë©°, ê°™ì€ ì˜ë¯¸ë¼ë©´ ìƒìˆ˜ë¡œ ëŒ€ì²´í•œ í›„ í…ŒìŠ¤íŠ¸í•œë‹¤

<br/>

**ğŸ’©before**
```java
public double potentialEnergy(int mass, int height) {
    return mass * 9.81 * height;
}
```
<br/>


**âœ¨after**
```java
private static final double STANDARD_GRAVITY = 9.81;

public double potentialEnergy(int mass, int height) {
    return mass * STANDARD_GRAVITY * height;
}

```
<br/>

> **INFO** ì´ ë¦¬íŒ©í„°ë§ì´ ì œëŒ€ë¡œ ë˜ì—ˆëŠ”ì§€ ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì„ê¹Œ? ì¢‹ì€ ë°©ë²• ì¤‘ í•˜ë‚˜ëŠ” ìƒìˆ˜ì˜ ê°’ì„ ë°”ê¾¸ê³ , ê´€ë ¨ í…ŒìŠ¤íŠ¸ ëª¨ë‘ê°€ ë°”ë€ ê°’ì— í•´ë‹¹í•˜ëŠ” ê²°ê³¼ë¥¼ ë‚´ëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²ƒì´ë‹¤.
> í•­ìƒ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ì•„ë‹ˆì§€ë§Œ ê°€ëŠ¥í•œ ê²½ìš°ë¼ë©´ ì•„ì£¼ í¸ë¦¬í•˜ë‹¤ 


**ğŸ’©before**
```java
public class InputView {
    private static final String ERROR_VALUE_MUST_BE_AT_LEAST_ONE = "1ì´ìƒì˜ ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”";
    private static final int ONE = 1;
    
    // ..
    
    private void assertAtLeastOne(int value) {
       if (value < ONE) {
           throw new IllegalArgumentException(ERROR_VALUE_MUST_BE_AT_LEAST_ONE);
        }
    }
}
```
- ë¬´ë¶„ë³„í•œ ë§¤ì§ë„˜ë²„/ìŠ¤íŠ¸ë§ ì²˜ë¦¬ëŠ” ì˜¤íˆë ¤ ê°€ë…ì„±ì„ ì €í•´í•  ìˆ˜ ìˆê³ , ì¤‘ë³µì„ ë°œìƒ ì‹œí‚¬ ìˆ˜ ìˆë‹¤
- `assertAtLeastOne(..)`ì— ì´ë¯¸ ONEì´ë¼ëŠ” ì •ë³´ê°€ ìˆëŠ”ë°, ì¡°ê±´ì‹ì—ì„œ ONE ìƒìˆ˜ ì²˜ë¦¬ëŠ” ê³¼ìœ ë¶ˆê¸‰ì´ì—ˆë‹¤
<br/>

**âœ¨after**
```java
private void assertAtLeastOne(int value) {
    if (value < 1) {
       throw new IllegalArgumentException(ERROR_VALUE_MUST_BE_AT_LEAST_ONE);
    }
}
```
<br/>

---

### Reference.
- [Inpa ê¸°ìˆ  ë¸”ë¡œê·¸- ìë°”ëŠ” Call by Reference ê°œë…ì´ ì—†ë‹¤?](https://inpa.tistory.com/entry/JAVA-%E2%98%95-%EC%9E%90%EB%B0%94%EB%8A%94-Call-by-reference-%EA%B0%9C%EB%85%90%EC%9D%B4-%EC%97%86%EB%8B%A4-%E2%9D%93)
