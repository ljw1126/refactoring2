# Chapter10. ì¡°ê±´ë¶€ ë¡œì§ ê°„ì†Œí™”

## í›„ê¸°

**10.1 ~ 10.3** <br/>
ë³µì¡í•œ ì¡°ê±´ë¬¸ì„ í•¨ìˆ˜ ì¶”ì¶œì´ë‚˜ ê°„ì†Œí™” í†µí•´ ì •ë¦¬í•˜ëŠ” ë¦¬íŒ©í„°ë§ ê¸°ë²•ì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤. 
íŠ¹íˆ `not`ê³¼ ê°™ì€ ë…¼ë¦¬ ì—°ì‚°ì€ ì„ í˜¸í•˜ì§€ ì•ŠëŠ” í¸ì¸ë°, 10.3 ë‘ë²ˆì§¸ ì˜ˆì‹œì—ì„œ `ë“œëª¨ë¥´ê°„ ë²•ì¹™`ì„ í™œìš©í•´ ë…¼ë¦¬ ì—°ì‚°ì„ ì´í•´í•˜ê¸° ì‰½ê²Œ ë§Œë“œëŠ” ê³¼ì •ì´ ì¸ìƒì ì´ì—ˆë‹¤.

<br/>

**10.4 ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°** <br/>
í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ë°›ì³ì¤¬ê¸° ë•Œë¬¸ì— ë¦¬íŒ©í„°ë§í•˜ëŠ” ê³¼ì •ì„ ì¬ë¯¸ìˆê²Œ ë°›ì•„ ë“¤ì¼ ìˆ˜ ìˆì—ˆë‹¤. 
ì²«ë²ˆì§¸ ì˜ˆì‹œì—ì„œ `new Bird(bird).plumage()`ì™€ ê°™ì´ `Bird` ê°ì²´ ìì‹ ì—ì„œ ì±…ì„ì„ ìœ„ì„í•˜ëŠ” ê²ƒì„ ì‹œì‘ìœ¼ë¡œ í•˜ì—¬, ìµœì¢…ì ìœ¼ë¡œ ì •ì  íŒ©í† ë¦¬ ë©”ì„œë“œë¥¼ ë§Œë“œëŠ” ê³¼ì •ì´ ì¸ìƒê¹Šì—ˆë‹¤. 
ë‘ë²ˆì§¸ ì˜ˆì‹œì—ì„œë„ ê¸°ë³¸ ì¡°ê±´ë¬¸ ì•ˆì— `ì¤‘êµ­ í¬í•¨ ì—¬ë¶€`ë¥¼ í™•ì¸í•˜ëŠ” íŠ¹ì´ ì¡°ê±´ë¬¸ì´ ìì‹ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ê°„íŒŒí•˜ì§€ ëª»í–ˆì§€ë§Œ ì‹œì•¼ë¥¼ ë°°ìš¸ ìˆ˜ ìˆì–´ ì¢‹ì•˜ë‹¤.

> **NOTE** 
> 10.4 ì˜ˆì‹œì—ì„œ ë¶€ëª¨ í´ë˜ìŠ¤ì— ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œë¥¼ ë‘ë‹ˆ ì •ì  ë¶„ì„ ë„êµ¬ í†µí•´ ìˆœí™˜ ì°¸ì¡° ğŸ’©code smell í™•ì¸
> - ì›ì¸: ìƒì†ì´ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ ìì‹ì´ ë¶€ëª¨ë¥¼ ì•„ëŠ”ë°, ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œë¡œ ì¸í•´ ë¶€ëª¨ê°€ ìì‹ì„ ì•Œê²Œ ë¨
> - í•´ê²°: íŒ©í„°ë¦¬ í´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ë§Œë“¦ 

<br/>

**10.5 íŠ¹ì´ ì¼€ì´ìŠ¤ ì¶”ê°€í•˜ê¸°** <br/>
`Null Object Pattern`ì— ëŒ€í•œ ë‚´ìš©ì´ì—ˆëŠ”ë°, ì˜ˆì‹œì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì—¬ëŸ¬ ê³³ì— **íŠ¹ì´ ì¼€ì´ìŠ¤ ì¡°ê±´ë¬¸**ì´ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì„¤ëª…í•˜ë‹ˆ ì¡°ê¸ˆ ì´í•´í•˜ê¸° ì–´ë ¤ì› ë‹¤.
ê·¸ë˜ë„ Nullì„ ëŒ€ì²´í•˜ëŠ” ê°ì²´ë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ìœ ì§€ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì´ì ì´ ìˆì–´ë³´ì˜€ê³ , ì´ë¥¼ ì˜ í™œìš©í•´ ë´ì•¼ ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

<br/>

---

## ëª©ì°¨
- [10.1 ì¡°ê±´ë¬¸ ë¶„í•´í•˜ê¸°](#101-ì¡°ê±´ë¬¸-ë¶„í•´í•˜ê¸°)
- [10.2 ì¡°ê±´ì‹ í†µí•©í•˜ê¸°](#102-ì¡°ê±´ì‹-í†µí•©í•˜ê¸°)
- [10.3 ì¤‘ì²© ì¡°ê±´ë¬¸ì„ ë³´í˜¸ êµ¬ë¬¸ìœ¼ë¡œ ë°”ê¾¸ê¸°](#103-ì¤‘ì²©-ì¡°ê±´ë¬¸ì„-ë³´í˜¸-êµ¬ë¬¸ìœ¼ë¡œ-ë°”ê¾¸ê¸°)
- [10.4 ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°](#104-ì¡°ê±´ë¶€-ë¡œì§ì„-ë‹¤í˜•ì„±ìœ¼ë¡œ-ë°”ê¾¸ê¸°)
- [10.5 íŠ¹ì´ ì¼€ì´ìŠ¤ ì¶”ê°€í•˜ê¸°](#105-íŠ¹ì´-ì¼€ì´ìŠ¤-ì¶”ê°€í•˜ê¸°)
- [10.6 ì–´ì„œì…˜ ì¶”ê°€í•˜ê¸°](#106-ì–´ì„œì…˜-ì¶”ê°€í•˜ê¸°)
- [10.7 ì œì–´ í”Œë˜ê·¸ë¥¼ íƒˆì¶œë¬¸ìœ¼ë¡œ ë°”ê¾¸ê¸°](#107-ì œì–´-í”Œë˜ê·¸ë¥¼-íƒˆì¶œë¬¸ìœ¼ë¡œ-ë°”ê¾¸ê¸°)

<br/>

### 10.1 ì¡°ê±´ë¬¸ ë¶„í•´í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Decompose Conditional](https://refactoring.com/catalog/decomposeConditional.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch10/ex1)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch10/ex1)
<br/>

**ë°°ê²½**
- ë³µì¡í•œ ì¡°ê±´ë¶€ ë¡œì§ì€ í”„ë¡œê·¸ë¨ì„ ë³µì¡í•˜ê²Œ ë§Œë“œëŠ” ê°€ì¥ í”í•œ ì›í‰ì— ì†í•œë‹¤
- ì¡°ê±´ì„ ê²€ì‚¬í•˜ê³  ê·¸ ê²°ê³¼ì— ë”°ë¥¸ ë™ì‘ì„ í‘œí˜„í•˜ëŠ” ì½”ë“œëŠ” ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚˜ëŠ”ì§€ ì´ì•¼ê¸°í•´ì£¼ì§€ë§Œ
  - `ì™œ` ì¼ì–´ë‚˜ëŠ”ì§€ëŠ” ì œëŒ€ë¡œ ë§í•´ì£¼ì§€ ì•Šì„ë•Œê°€ ë§ì€ ê²ƒì´ ë¬¸ì œë‹¤
- ê±°ëŒ€í•œ ì½”ë“œ ë¸”ë¡ì´ ì£¼ì–´ì§€ë©´ ì½”ë“œë¥¼ ë¶€ìœ„ë³„ë¡œ ë¶„í•´í•œ ë‹¤ìŒ í•´ì²´ëœ ì½”ë“œ ë©ì–´ë¦¬ë“¤ì„ ê° ë©ì–´ë¦¬ì˜ ì˜ë„ë¥¼ ì‚´ë¦° ì´ë¦„ì˜ í•¨ìˆ˜ í˜¸ì¶œë¡œ ë°”ê¿”ì£¼ì
- ê·¸ëŸ¬ë©´ `ì „ì²´ì ì¸ ì˜ë„`ê°€ ë” í™•ì‹¤íˆ ë“œëŸ¬ë‚œë‹¤
  - ê²°ê³¼ì ìœ¼ë¡œ í•´ë‹¹ ì¡°ê±´ì´ ë¬´ì—‡ì¸ì§€ ê°•ì¡°í•˜ê³ , ê·¸ë˜ì„œ ë¬´ì—‡ì„ ë¶„ê¸°í–ˆëŠ”ì§€ê°€ ëª…í™•í•´ì§„ë‹¤
  - ë˜í•œ ë¶„ê¸°í•œ ì´ìœ  ì—­ì‹œ ë” ëª…í™•í•´ì§„ë‹¤
<br/>

**ì ˆì°¨**
- ì¡°ê±´ì‹ê³¼ ê·¸ ì¡°ê±´ì‹ì— ë”¸ë¦° ì¡°ê±´ì ˆ ê°ê°ì„ `í•¨ìˆ˜ë¡œ ì¶”ì¶œ(6.1)`í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class ServiceCharge {
  private final Plan plan;

  public ServiceCharge(Plan plan) {
    this.plan = plan;
  }

  public double charge(int quantity, LocalDate aDate) {
    if (!aDate.isBefore(plan.summerStart()) && !aDate.isAfter(plan.summerEnd())) {
      return quantity * plan.summerRate();
    }

    return quantity * plan.regularRate() + plan.regularServiceCharge();
  }
}
```

**âœ¨after**
```java
public class ServiceCharge {
  private final Plan plan;

  public ServiceCharge(Plan plan) {
    this.plan = plan;
  }

  public double charge(int quantity, LocalDate aDate) {
    return summer(aDate) ? summerCharge(quantity) : regularCharge(quantity);
  }

  private boolean summer(LocalDate aDate) {
    return !aDate.isBefore(plan.summerStart()) && !aDate.isAfter(plan.summerEnd());
  }

  private double summerCharge(int quantity) {
    return quantity * plan.summerRate();
  }

  private double regularCharge(int quantity) {
    return quantity * plan.regularRate() + plan.regularServiceCharge();
  }
}
```


<br/>

### 10.2 ì¡°ê±´ì‹ í†µí•©í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Consolidate Conditional Expression](https://refactoring.com/catalog/consolidateConditionalExpression.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch10/ex2)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch10/ex2)
<br/>

**ë°°ê²½**
- ì–´íŒŒì¹˜ ê°™ì€ ì¼ì„ í•  ê±°ë¼ë©´ ì¡°ê±´ ê²€ì‚¬ë„ í•˜ë‚˜ë¡œ í†µí•©í•˜ëŠ”ê²Œ ë‚«ë‹¤
  - `í•¨ìˆ˜ ì¶”ì¶œí•˜ê¸°(6.1)`ë¡œ ì´ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤
  - ë³µì¡í•œ ì¡°ê±´ì‹ì„ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•˜ë©´ ì½”ë“œì˜ ì˜ë„ê°€ í›¨ì”¬ ë¶„ëª…í•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤
- ì½”ë“œë¥¼ `ì™œ` í•˜ëŠ”ì§€ë¥¼ ë§í•´ì£¼ëŠ” ì½”ë“œë¡œ ë°”ê¿”ì£¼ëŠ” íš¨ê³¼ì ì¸ ë„êµ¬ì„ì„ ê¸°ì–µí•˜ì
  - `what â¡ï¸ why`
<br/>

**ì ˆì°¨**
- í•´ë‹¹ ì¡°ê±´ì‹ë“¤ ëª¨ë‘ì— ë¶€ìˆ˜íš¨ê³¼ê°€ ì—†ëŠ”ì§€ í™•ì¸í•œë‹¤
  - ë¶€ìˆ˜ íš¨ê³¼ê°€ ìˆëŠ” ì¡°ê±´ì‹ë“¤ì—ëŠ” ì§ˆì˜ í•¨ìˆ˜ì™€ ë³€ê²½ í•¨ìˆ˜ ë¶„ë¦¬í•˜ê¸°(11.1)ë¥¼ ë¨¼ì € ì ìš©í•œë‹¤
- ì¡°ê±´ë¬¸ ë‘ ê°œë¥¼ ì„ íƒí•˜ì—¬ ë‘ ì¡°ê±´ë¬¸ì˜ ì¡°ê±´ì‹ë“¤ì„ ë…¼ë¦¬ ì—°ì‚°ìë¡œ ê²°í•©í•œë‹¤
  - ìˆœì°¨ì ìœ¼ë¡œ ì´ë¤„ì§€ëŠ”(ë ˆë²¨ì´ ê°™ì€) ì¡°ê±´ë¬¸ì€ orë¡œ ê²°í•©í•˜ê³ , ì¤‘ì²©ëœ ì¡°ê±´ë¬¸ì€ andë¡œ ê²°í•©í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ì¡°ê±´ì´ í•˜ë‚˜ë§Œ ë‚¨ì„ë•Œê¹Œì§€ `2~3` ê³¼ì •ì„ ë°˜ë³µí•œë‹¤
- í•˜ë‚˜ë¡œ í•©ì³ì§„ ì¡°ê±´ì‹ì„ `í•¨ìˆ˜ë¡œ ì¶”ì¶œ(6.1)`í• ì§€ ê³ ë ¤í•´ë³¸ë‹¤
<br/>


**ğŸ’©before**
```java
public class EmployeeUtils {

  private EmployeeUtils() {}

  // ì¥ì•  ìˆ˜ë‹¹
  public int disabilityAmount(Employee anEmployee) {
    if (anEmployee.seniority() < 2) return 0;
    if (anEmployee.monthsDisabled() > 12) return 0;
    if (anEmployee.partTime()) return 0;

    return 10_000;
  }

  public double vacationAmount(Employee anEmployee) {
    if (anEmployee.onVacation()) {
      if (anEmployee.seniority() > 10) {
        return 1;
      }
    }
    return 0.5;
  }
}
```

**âœ¨after**
```java
public class EmployeeUtils {

  private EmployeeUtils() {}

  // ì¥ì•  ìˆ˜ë‹¹
  public static int disabilityAmount(Employee anEmployee) {
    return isNotEligibleForDisability(anEmployee) ? 0 : 10_000;
  }

  private static boolean isNotEligibleForDisability(Employee anEmployee) {
    return anEmployee.seniority() < 2 || anEmployee.monthsDisabled() > 12 || anEmployee.partTime();
  }

  public static double vacationAmount(Employee anEmployee) {
    return isEligibleForVacationAmount(anEmployee) ? 1 : 0.5;
  }

  private static boolean isEligibleForVacationAmount(Employee anEmployee) {
    return anEmployee.onVacation() && anEmployee.seniority() > 10;
  }
}

```
<br/>

### 10.3 ì¤‘ì²© ì¡°ê±´ë¬¸ì„ ë³´í˜¸ êµ¬ë¬¸ìœ¼ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Nested Conditional with Guard Clauses](https://refactoring.com/catalog/replaceNestedConditionalWithGuardClauses.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch10/ex3)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch10/ex3)

<br/>

**ë°°ê²½**
- ì¤‘ì²© ì¡°ê±´ë¬¸ì„ ë³´í˜¸ êµ¬ë¬¸ìœ¼ë¡œ ë°”ê¾¸ê¸° ë¦¬íŒ©í„°ë§ì˜ í•µì‹¬ì€ ì˜ë„ë¥¼ ë¶€ê°í•˜ëŠ”ë° ìˆë‹¤
- ë³´í˜¸ êµ¬ë¬¸ì€ `"ì´ê±´ ì´ í•¨ìˆ˜ì˜ í•µì‹¬ì´ ì•„ë‹ˆë‹¤. ì´ ì¼ì´ ì¼ë„ˆë§ˆë…€ ë¬´ì–¸ê°€ ì¡°ì¹˜ë¥¼ ì·¨í•œ í›„ í•¨ìˆ˜ì—ì„œ ë¹ ì ¸ë‚˜ì˜¨ë‹¤"`ë¼ê³  ì´ì•¼ê¸°í•œë‹¤
  - <u>í•¨ìˆ˜ì˜ ì§„ì…ì ê³¼ ë°˜í™˜ì ì´ í•˜ë‚˜ì—¬ì•¼ í•œë‹¤ëŠ” ë‚´ìš© ìƒëµ</u>
<br/>

**ì ˆì°¨**
- êµì²´í•´ì•¼ í•  ì¡°ê±´ ì¤‘ ê°€ì¥ ë°”ê¹¥ ê²ƒì„ ì„ íƒí•˜ì—¬ ë³´í˜¸ êµ¬ë¬¸ìœ¼ë¡œ ë°”ê¾¼ë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- `1~2` ê³¼ì •ì„ í•„ìš”í•œ ë§Œí¼ ë°˜ë³µí•œë‹¤
- ëª¨ë“  ë³´í˜¸ êµ¬ë¬¸ì´ ê°™ì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤ë©´ `ë³´í˜¸ êµ¬ë¬¸ë“¤ì˜ ì¡°ê±´ì‹ì„ í†µí•©(10.2)`í•œë‹¤ 
<br/>

**ğŸ’©before**
```java
public class PayrollCalculator {

  private PayrollCalculator() {}

  public static Payroll payAmount(Employee employee) {
    Payroll result;
    if (employee.separated()) { // í‡´ì‚¬í•œ ì§ì›ì¸ê°€?
      result = new Payroll(0, ReasonCode.SEP); 
    } else {
      if (employee.retired()) { // ì€í‡´í•œ ì§ì›ì¸ê°€?
        result = new Payroll(0, ReasonCode.RET);
      } else {
        // ê¸‰ì—¬ ê³„ì‚° ë¡œì§
        int money = 3_000_000;
        result = new Payroll(money, ReasonCode.BASIC);
      }
    }

    return result;
  }

  public static int adjustedCapital(Instrument anInstrument) {
    int result = 0;
    if (anInstrument.capital() > 0) {
      if (anInstrument.interestRate() > 0 && anInstrument.duration() > 0) {
        result =
            (anInstrument.income() / anInstrument.duration()) * anInstrument.adjustmentFactor();
      }
    }

    return result;
  }
}

```

**âœ¨after**
```java
public class PayrollCalculator {

  private PayrollCalculator() {}

  public static Payroll payAmount(Employee employee) {
    if (employee.separated()) {
      return new Payroll(0, ReasonCode.SEP);
    }
    if (employee.retired()) {
      return new Payroll(0, ReasonCode.RET);
    }

    // ê¸‰ì—¬ ê³„ì‚° ë¡œì§
    int money = 3_000_000;
    return new Payroll(money, ReasonCode.BASIC);
  }

  public static int adjustedCapital(Instrument anInstrument) {
    if (anInstrument.capital() <= 0
            || anInstrument.interestRate() <= 0
            || anInstrument.duration() <= 0) return 0;

    return (anInstrument.income() / anInstrument.duration()) * anInstrument.adjustmentFactor();
  }
}
```


<br/>

### 10.4 ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Conditional with Polymorphism](https://refactoring.com/catalog/replaceConditionalWithPolymorphism.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch10/ex4)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch10/ex4)

<br/>

**ë°°ê²½**
- ì €ìëŠ” ì¡°ê±´ë¶€ ë¡œì§ì„ ì§ê´€ì ìœ¼ë¡œ êµ¬ì¡°í™”í•  ë°©ë²•ì„ í•­ìƒ ê³ ë¯¼í•œë‹¤ê³  ë§í•œë‹¤
  - ì¢…ì¢… ë” ë†’ì€ ìˆ˜ì¤€ì˜ ê°œë…ì„ ë„ì…í•´ ì´ ì¡°ê±´ë“¤ì„ ë¶„ë¦¬í•´ë‚¼ ìˆ˜ ìˆë‹¤
  - ì¡°ê±´ë¬¸ êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ë‘” ì±„ í•´ê²°ë  ë•Œë„ ìˆì§€ë§Œ, í´ë˜ìŠ¤ì™€ ë‹¤í˜•ì„±ì„ ì´ìš©í•˜ë©´ ë” í™•ì‹¤í•˜ê²Œ ë¶„ë¦¬í•  ìˆ˜ë„ ìˆë‹¤
- `ë‹¤í˜•ì„±`ì€ ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë¨ì˜ í•µì‹¬ì´ë‹¤
  - í•˜ì§€ë§Œ (ìœ ìš©í•œ ê¸°ëŠ¥ë“¤ì´ ëŠ˜ ê·¸ë ‡ë“¯) ë‚¨ìš©í•˜ê¸° ì‰½ë‹¤
- ì´ ë¦¬íŒ©í„°ë§ì˜ ë˜ ë‹¤ë¥¸ ì“°ì„ìƒˆë¡œ, ê±°ì˜ ë˜‘ê°™ì€ ê°ì²´ì§€ë§Œ ë‹¤ë¥¸ ë¶€ë¶„ë„ ìˆìŒì„ í‘œí˜„í•  ë•Œë„ ìƒì†ì„ ì“´ë‹¤
  - `ì˜ˆì‹œ2. ë³€í˜• ë™ì‘ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ í‘œí˜„í•˜ê¸°(í•­í•´ ë“±ê¸‰)`
  - <u>íŠ¹ìˆ˜í•œ ìƒí™©ì„ ë‹¤ë£¨ëŠ” ë¡œì§ë“¤ì„ ê¸°ë³¸ ë™ì‘ì—ì„œ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ìƒì†ê³¼ ë‹¤í˜•ì„±ì„ ì´ìš©í•œë‹¤</u>
<br/>

**ì ˆì°¨**
- ë‹¤í˜•ì  ë™ì‘ì„ í‘œí˜„í•˜ëŠ” í´ë˜ìŠ¤ë“¤ì´ ì•„ì§ ì—†ë‹¤ë©´ ë§Œë“¤ì–´ì¤€ë‹¤. 
  - ì´ì™•ì´ë©´ ì í•©í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì•Œì•„ì„œ ë§Œë“¤ì–´ ë°˜í™˜í•˜ëŠ” íŒ©í„°ë¦¬ í•¨ìˆ˜ë„ í•¨ê»˜ ë§Œë“ ë‹¤
- í˜¸ì¶œí•˜ëŠ” ì½”ë“œì—ì„œ íŒ©í„°ë¦¬ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê²Œ í•œë‹¤
- ì¡°ê±´ë¶€ ë¡œì§ í•¨ìˆ˜ë¥¼ ìŠˆí¼í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤
  - ì¡°ê±´ë¶€ ë¡œì§ì´ ì˜¨ì „í•œ í•¨ìˆ˜ë¡œ ë¶„ë¦¬ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ë¨¼ì € í•¨ìˆ˜ë¡œ ì¶”ì¶œí•œë‹¤
- ì„œë¸Œ í´ë˜ìŠ¤ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•œë‹¤
  - ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ ìŠˆí¼ í´ë˜ìŠ¤ì˜ ì¡°ê±´ë¶€ ë¡œì§ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•œë‹¤
  - ì¡°ê±´ë¶€ ë¬¸ì¥ ì¤‘ ì„ íƒëœ ì„œë¸Œ í´ë˜ìŠ¤ì— í•´ë‹¹í•˜ëŠ” ì¡°ê±´ì ˆì„ ì„œë¸Œ í´ë˜ìŠ¤ ë©”ì„œë“œë¡œ ë³µì‚¬í•œ ë‹¤ìŒ ì ì ˆíˆ ìˆ˜ì •í•œë‹¤
- ê°™ì€ ë°©ì‹ìœ¼ë¡œ ê° ì¡°ê±´ì ˆì„ í•´ë‹¹ ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ ë©”ì„œë“œë¡œ êµ¬í˜„í•œë‹¤
- ìŠˆí¼ í´ë˜ìŠ¤ ë©”ì„œë“œì—ëŠ” ê¸°ë³¸ ë™ì‘ ë¶€ë¶„ë§Œ ë‚¨ê¸´ë‹¤.
  - í˜¹ì€ ìŠˆí¼ í´ë˜ìŠ¤ê°€ ì¶”ìƒ í´ë˜ìŠ¤ì—¬ì•¼ í•œë‹¤ë©´, ì´ ë©”ì„œë“œë¥¼ ì¶”ìƒìœ¼ë¡œ ì„ ì–¸í•˜ê±°ë‚˜ ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨ì„ ì•Œë¦¬ëŠ” ì—ëŸ¬ë¥¼ ë˜ì§„ë‹¤.

<br/>


**ğŸ’©before**
```java
 private String plumage(Bird bird) {
    switch (bird.type()) {
      case "ìœ ëŸ½ ì œë¹„":
        return "ë³´í†µì´ë‹¤";
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„":
        return (bird.numberOfCoconuts() > 2) ? "ì§€ì³¤ë‹¤" : "ë³´í†µì´ë‹¤";
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´":
        return (bird.voltage() > 100) ? "ê·¸ì„ë ¸ë‹¤" : "ì˜ˆì˜ë‹¤";
      default:
        return "ì•Œ ìˆ˜ ì—†ë‹¤";
    }
  }
```

**âœ¨after. í–¥ìƒëœ switchë¬¸ì€ ìë°” 14ë¶€í„° ì§€ì›**
```java
private String plumage(Bird bird) {
      return switch (bird.type()) {
          case "ìœ ëŸ½ ì œë¹„" -> "ë³´í†µì´ë‹¤";
          case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> (bird.numberOfCoconuts() > 2) ? "ì§€ì³¤ë‹¤" : "ë³´í†µì´ë‹¤";
          case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> (bird.voltage() > 100) ? "ê·¸ì„ë ¸ë‹¤" : "ì˜ˆì˜ë‹¤";
          default -> "ì•Œ ìˆ˜ ì—†ë‹¤";
      };
  }
```
<br/>



**ğŸ’©before.** **ì˜ˆì‹œ1**
```java
public class BirdClassifier {

  private BirdClassifier() {}

  public static Map<String, String> plumages(List<Bird> birds) {
    return birds.stream()
            .collect(Collectors.toMap(Bird::name, BirdClassifier::plumage));
  }

  public static Map<String, Integer> speeds(List<Bird> birds) {
    return birds.stream()
            .collect(Collectors.toMap(Bird::name, BirdClassifier::airSpeedVelocity));
  }

  private static String plumage(Bird bird) {
    return switch (bird.type()) {
      case "ìœ ëŸ½ ì œë¹„" -> "ë³´í†µì´ë‹¤";
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> (bird.numberOfCoconuts() > 2) ? "ì§€ì³¤ë‹¤" : "ë³´í†µì´ë‹¤";
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> (bird.voltage() > 100) ? "ê·¸ì„ë ¸ë‹¤" : "ì˜ˆì˜ë‹¤";
      default -> "ì•Œ ìˆ˜ ì—†ë‹¤";
    };
  }

  private static Integer airSpeedVelocity(Bird bird) {
    return switch (bird.type()) {
      case "ìœ ëŸ½ ì œë¹„" -> 35;
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> 40 - 2 * bird.numberOfCoconuts();
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> bird.isNailed() ? 0 : 10 + bird.voltage() / 10;
      default -> 0;
    };
  }
}
```
<br/>

```java
public class BirdClassifier {
  private BirdClassifier() {}

  public static Map<String, String> plumages(List<Bird> birds) {
    return birds.stream().collect(Collectors.toMap(Bird::name, BirdClassifier::plumage));
  }

  public static Map<String, Integer> speeds(List<Bird> birds) {
    return birds.stream().collect(Collectors.toMap(Bird::name, BirdClassifier::airSpeedVelocity));
  }

  private static String plumage(Bird bird) {
    return new Bird(bird).plumage(); 
  }

  private static Integer airSpeedVelocity(Bird bird) {
    return new Bird(bird).airSpeedVelocity();
  }
}


public class Bird {
  private final String name;
  private final String type;
  private final int numberOfCoconuts;
  private final int voltage;
  private final boolean isNailed;

  public Bird(Bird bird) {
    this(bird.name, bird.type, bird.numberOfCoconuts, bird.voltage, bird.isNailed);
  }

  public Bird(String name, String type, int numberOfCoconuts, int voltage, boolean isNailed) {
    this.name = name;
    this.type = type;
    this.numberOfCoconuts = numberOfCoconuts;
    this.voltage = voltage;
    this.isNailed = isNailed;
  }

  public String plumage() { // ì±…ì„ ìœ„ì„
    return switch (type) {
      case "ìœ ëŸ½ ì œë¹„" -> "ë³´í†µì´ë‹¤";
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> (numberOfCoconuts > 2) ? "ì§€ì³¤ë‹¤" : "ë³´í†µì´ë‹¤";
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> (voltage > 100) ? "ê·¸ì„ë ¸ë‹¤" : "ì˜ˆì˜ë‹¤";
      default -> "ì•Œ ìˆ˜ ì—†ë‹¤";
    };
  }

  public Integer airSpeedVelocity() { // ì±…ì„ ìœ„ì„
    return switch (type) {
      case "ìœ ëŸ½ ì œë¹„" -> 35;
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> 40 - 2 * numberOfCoconuts;
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> isNailed ? 0 : 10 + voltage / 10;
      default -> 0;
    };
  }
  
  // getter
}
```
- `Bird` ìì‹ ì„ ìƒì„±ìë¡œ ë°›ëŠ” ë¦¬íŒ©í„°ë§ ì‹œì‘ì ì´ ì¸ìƒ ê¹Šë‹¤
- ì´í›„ ìì‹ í´ë˜ìŠ¤ ìƒì„±, ì˜¤ë²„ë¼ì´ë”© í†µí•´ switchë¬¸ ì¡°ê±´ì‹ ìœ„ì„
- ë§ˆì§€ë§‰ìœ¼ë¡œ ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œ ìƒì„±í•œë‹¤
<br/>

```java
public class Bird {
  public static Bird createBird(Bird bird) {
    return switch (bird.type) {
      case "ìœ ëŸ½ ì œë¹„" -> new EuropeanSwallow(bird);
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> new AfricanSwallow(bird);
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> new NorwegianBlueParrot(bird);
      default -> new Bird(bird);
    };
  }
}

public class AfricanSwallow extends Bird {
  public AfricanSwallow(Bird bird) {
    super(bird);
  }
}

public class EuropeanSwallow extends Bird {
  public EuropeanSwallow(Bird bird) {
    super(bird);
  }
}

public class NorwegianBlueParrot extends Bird {
  public NorwegianBlueParrot(Bird bird) {
    super(bird);
  }
}

```

<br/>

ë¨¼ì € `plumage()`ì— switchë¬¸ì˜ caseë¥¼ í•˜ë‚˜ì”© ì˜®ê¸´ë‹¤
- ì´ë•Œ ë¶€ëª¨ ì†ì„±ì— ì ‘ê·¼ê°€ëŠ¥í•˜ë„ë¡ `private`ë¥¼ `protected`ë¡œ ì ‘ê·¼ ì œì–´ì ìˆ˜ì •
- ë¶€ëª¨ í´ë˜ìŠ¤ì˜ `switch` ë¬¸ì— í•˜ë‚˜ì”© ì˜®ê¸°ë©´ `throw new RuntimeExecption("ì˜¤ë¥˜ë°œìƒ")` ë³€ê²½
- í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰ (ë°˜ë³µ)
- ë§ˆì°¬ê°€ì§€ë¡œ `airSpeedVelocity()`ë„ ìì‹ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë”© í•˜ë©° ì˜®ê¹€

```java
public class Bird {
  public String plumage() {
    return "ì•Œ ìˆ˜ ì—†ë‹¤";
  }
}

public class AfricanSwallow extends Bird {
  public AfricanSwallow(Bird bird) {
    super(bird);
  }

  @Override
  public String plumage() {
    return (numberOfCoconuts > 2) ? "ì§€ì³¤ë‹¤" : "ë³´í†µì´ë‹¤";
  }
}

public class EuropeanSwallow extends Bird {
  public EuropeanSwallow(Bird bird) {
    super(bird);
  }

  @Override
  public String plumage() {
    return "ë³´í†µì´ë‹¤";
  }
}

public class NorwegianBlueParrot extends Bird {
  public NorwegianBlueParrot(Bird bird) {
    super(bird);
  }

  @Override
  public String plumage() {
    return (voltage > 100) ? "ê·¸ì„ë ¸ë‹¤" : "ì˜ˆì˜ë‹¤";
  }
}

```
<br/>

**âœ¨after ìµœì¢… ì½”ë“œ**
```java
public class BirdClassifier { 

  private BirdClassifier() {}

  public static Map<String, String> plumages(List<Bird> birds) {
    return birds.stream().collect(Collectors.toMap(Bird::name, Bird::plumage));
  }

  public static Map<String, Integer> speeds(List<Bird> birds) {
    return birds.stream().collect(Collectors.toMap(Bird::name, Bird::airSpeedVelocity));
  }
}
```
- ë¦¬íŒ©í„°ë§ í•˜ê³ ë‚˜ë‹ˆ `ì¼ê¸‰ ì»¬ë ‰ì…˜`ìœ¼ë¡œ ë³€ê²½í•´ë„ ì¢‹ì„ ë“¯í•˜ë‹¤
- ë¶€ëª¨ í´ë˜ìŠ¤ ìˆëŠ” ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œì—ì„œ ìì‹ í´ë˜ìŠ¤ë¥´ ì•Œê³  ìˆë‹¤ê³  ì •ì  ì½”ë“œ ë¶„ì„ ë„êµ¬ í†µí•´ **ìˆœí™˜ ì°¸ì¡°** code smell í™•ì¸ 
  - íŒ©í† ë¦¬ í´ë˜ìŠ¤ ë½‘ì•„ì„œ ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œ ì´ë™
<br/>

**í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (10.4 - 1)**
<img src="https://github.com/ljw1126/user-content/blob/master/refactoring2/ch10/10.4%20-%201%20Bird%20%EC%98%88%EC%A0%9C.png?raw=true">

<br/>

**ğŸ’©before. ì˜ˆì‹œ2**
```java
public class RatingUtils {
  private RatingUtils() {}

  // íˆ¬ì ë“±ê¸‰
  public static String rating(Voyage voyage, History history) {
    int vpf = voyageProfitFactor(voyage, history);
    int vr = voyageRisk(voyage);
    int chr = captainHistoryRisk(voyage, history);

    if (vpf * 3 > (vr + chr * 2)) return "A";

    return "B";
  }

  // ìˆ˜ìµ ìš”ì¸
  private static int voyageProfitFactor(Voyage voyage, History history) {
    int result = 2;
    if (voyage.zone().equals("ì¤‘êµ­")) result += 1;
    if (voyage.zone().equals("ë™ì¸ë„")) result += 1;
    if (voyage.zone().equals("ì¤‘êµ­") && hasChina(history)) {
      result += 3;
      if (history.length() > 10) result += 1;
      if (voyage.length() > 12) result += 1;
      if (voyage.length() > 10) result -= 1;
    } else {
      if (history.length() > 8) result += 1;
      if (voyage.length() > 14) result -= 1;
    }

    return result;
  }

  // í•­í•´ ê²½ë¡œ ìœ„í—˜ìš”ì†Œ
  private static int voyageRisk(Voyage voyage) {
    int result = 1;
    if (voyage.length() > 4) result += 2;
    if (voyage.length() > 0) result += (voyage.length() - 8);

    final Set<String> riskZone = Set.of("ì¤‘êµ­", "ë™ì¸ë„");
    if (riskZone.contains(voyage.zone())) result += 4;

    return Math.max(result, 0);
  }

  // ì„ ì¥ì˜ í•­í•´ ì´ë ¥ ìœ„í—˜ìš”ì†Œ
  private static int captainHistoryRisk(Voyage voyage, History history) {
    int result = 1;
    if (history.length() < 5) result += 4;

    result += (int) history.getZoneProfits().stream().filter(v -> v.profit() < 0).count();

    if (voyage.zone().equals("ì¤‘êµ­") && hasChina(history)) result -= 2;

    return Math.max(result, 0);
  }

  private static boolean hasChina(History history) {
    return history.getZoneProfits().stream().anyMatch(v -> v.zone().equals("ì¤‘êµ­"));
  }
}


class RatingUtilsTest {

  @Test
  void ratingBTest() {
    Voyage voyage = new Voyage("ì„œì¸ë„", 10);
    List<ZoneProfit> zoneProfits =
            List.of(
                    new ZoneProfit("ë™ì¸ë„", 5),
                    new ZoneProfit("ì„œì¸ë„", 15),
                    new ZoneProfit("ì¤‘êµ­", -2),
                    new ZoneProfit("ì„œì•„í”„ë¦¬ì¹´", 7));
    History history = new History(zoneProfits);
    String actual = RatingUtils.rating(voyage, history);

    assertThat(actual).isEqualTo("B");
  }

  @Test
  void ratingATest() {
    Voyage voyage = new Voyage("ì¤‘êµ­", 10);
    List<ZoneProfit> zoneProfits =
            List.of(
                    new ZoneProfit("ì¤‘êµ­", 5),
                    new ZoneProfit("ë™ì¸ë„", 10),
                    new ZoneProfit("ì„œì¸ë„", 15),
                    new ZoneProfit("ì„œì•„í”„ë¦¬ì¹´", 7),
                    new ZoneProfit("ë™ì¸ë„", 10),
                    new ZoneProfit("ì¤‘êµ­", 20),
                    new ZoneProfit("ì¤‘êµ­", 30),
                    new ZoneProfit("ì¤‘êµ­", 10),
                    new ZoneProfit("ì¤‘êµ­", 5),
                    new ZoneProfit("ì¤‘êµ­", 25));
    History history = new History(zoneProfits); // ë°©ë¬¸ ê¸°ë¡ 10ê°œ ì´ìƒ
    String actual = RatingUtils.rating(voyage, history);

    assertThat(actual).isEqualTo("A");
  }
}
```
<br/>

Rating í´ë˜ìŠ¤ ìƒì„±í•´ì„œ ìœ„ì„í•œë‹¤
```java
public class RatingUtils {
  private RatingUtils() {}

  public static String rating(Voyage voyage, History history) {
    return new Rating(voyage, history).value();
  }
}
```

<br/>
ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œë¥¼ ìƒì„±í•˜ê³ , ì¤‘êµ­ì— ëŒ€í•œ ì¡°ê±´ì ˆì„ ì²˜ë¦¬í•˜ëŠ” ë‚´ìš©ì„ ìì‹ í´ë˜ìŠ¤ì— ìœ„ì„í•œë‹¤

```java
public class Rating {
  private final Voyage voyage;
  private final History history;

  public Rating(Voyage voyage, History history) {
    this.voyage = voyage;
    this.history = history;
  }

  public static Rating create(Voyage voyage, History history) {
    if (voyage.zone().equals("ì¤‘êµ­")
        && history.getZoneProfits().stream().anyMatch(p -> p.zone().equals("ì¤‘êµ­"))) {
      return new ExperienceChinaRating(voyage, history);
    }

    return new Rating(voyage, history);
  }
  // ..
}


public class ExperienceChinaRating extends Rating {
  public ExperienceChinaRating(Voyage voyage, History history) {
    super(voyage, history);
  }
}


public class RatingUtils {
  private RatingUtils() {}

  public static String rating(Voyage voyage, History history) {
    return Rating.create(voyage, history).value();
  }
}
```


```java
public class Rating {
    //..

    protected int voyageProfitFactor() {
      int result = 2;
      if (voyage.zone().equals("ì¤‘êµ­")) result += 1;
      if (voyage.zone().equals("ë™ì¸ë„")) result += 1;
  
      result += voyageAndHistoryLengthFactor();
  
      return result;
    }
  
    // ì¤‘êµ­ ê²€ì¦ ë¡œì§ì´ í•˜ìœ„ í´ë˜ìŠ¤ë¡œ ë‚´ë ¤ê°
    protected int voyageAndHistoryLengthFactor() {
      int result = 0;
  
      if (history.length() > 8) result += 1;
      if (voyage.length() > 14) result -= 1;
  
      return result;
    }
}


public class ExperienceChinaRating extends Rating {
  public ExperienceChinaRating(Voyage voyage, History history) {
    super(voyage, history);
  }

  @Override
  protected int captainHistoryRisk() {
    int result = super.captainHistoryRisk() - 2;
    return Math.max(result, 0);
  }

  @Override
  protected int voyageAndHistoryLengthFactor() {
    int result = 3;

    if (history.length() > 10) result += 1;
    if (voyage.length() > 12) result += 1;
    if (voyage.length() > 10) result -= 1;

    return result;
  }
}

```
<br/>

**âœ¨after ìµœì¢… ì½”ë“œ**
```java
public class Rating {
  protected final Voyage voyage;
  protected final History history;

  public Rating(Voyage voyage, History history) {
    this.voyage = voyage;
    this.history = history;
  }

  public static Rating create(Voyage voyage, History history) {
    if (voyage.zone().equals("ì¤‘êµ­")
        && history.getZoneProfits().stream().anyMatch(p -> p.zone().equals("ì¤‘êµ­"))) {
      return new ExperienceChinaRating(voyage, history);
    }

    return new Rating(voyage, history);
  }

  public String value() {
    int vpf = voyageProfitFactor();
    int vr = voyageRisk();
    int chr = captainHistoryRisk();

    if (vpf * 3 > (vr + chr * 2)) return "A";

    return "B";
  }

  protected int voyageProfitFactor() {
    int result = 2;
    if (voyage.zone().equals("ì¤‘êµ­")) result += 1;
    if (voyage.zone().equals("ë™ì¸ë„")) result += 1;

    result += this.historyLengthFactor();
    result += this.voyageLengthFactor();

    return result;
  }

  protected int voyageLengthFactor() {
    return voyage.length() > 14 ? -1 : 0;
  }

  protected int historyLengthFactor() {
    return (history.length()) > 8 ? 1 : 0;
  }

  private int voyageRisk() {
    int result = 1;
    if (voyage.length() > 4) result += 2;
    if (voyage.length() > 0) result += (voyage.length() - 8);

    final Set<String> riskZone = Set.of("ì¤‘êµ­", "ë™ì¸ë„");
    if (riskZone.contains(voyage.zone())) result += 4;

    return Math.max(result, 0);
  }

  protected int captainHistoryRisk() {
    int result = 1;
    if (history.length() < 5) result += 4;

    result += (int) history.getZoneProfits().stream().filter(v -> v.profit() < 0).count();

    return Math.max(result, 0);
  }
}


public class ExperienceChinaRating extends Rating {
  public ExperienceChinaRating(Voyage voyage, History history) {
    super(voyage, history);
  }

  @Override
  protected int captainHistoryRisk() {
    int result = super.captainHistoryRisk() - 2;
    return Math.max(result, 0);
  }

  @Override
  protected int voyageProfitFactor() {
    return super.voyageProfitFactor() + 3;
  }

  @Override
  protected int voyageLengthFactor() {
    int result = 0;

    if (voyage.length() > 12) result += 1;
    if (voyage.length() > 10) result -= 1;

    return result;
  }

  @Override
  protected int historyLengthFactor() {
    return (history.length() > 10) ? 1 : 0;
  }
}
```
- ì¶”ê°€ì ìœ¼ë¡œ `voyageAndHistoryLengthFactor()`ë¥¼ ë¶„ë¦¬í•˜ëŠ” ë¦¬íŒ©í„°ë§ ê³¼ì •ë„ ì¸ìƒ ê¹Šë‹¤
- ì´ë ¥ ê¸¸ì´ì— ëŒ€í•œ ì¡°ê±´ë¬¸ì„ í•¨ìˆ˜ ì¶”ì¶œí• ë•Œ ìŠˆí¼í´ë˜ìŠ¤ì™€ ì„œë¸Œ í´ë˜ìŠ¤ ëª¨ë‘ì— ì ìš©í•œë‹¤
- ìì‹ í´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë”©í•˜ê±°ë‚˜ ë¶€ëª¨ ì†ì„±ì— ì ‘ê·¼í•˜ë ¤ë©´ `protected` ì ‘ê·¼ ì œì–´ìë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ìˆ˜ì •í•˜ê²Œ ëœë‹¤

<br/>

### 10.5 íŠ¹ì´ ì¼€ì´ìŠ¤ ì¶”ê°€í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Introduce Special Case](https://refactoring.com/catalog/introduceSpecialCase.html)
- 1íŒì—ì„œ ì´ë¦„ : Null ê²€ì‚¬ë¥¼ ë„ ê°ì²´ì— ìœ„ì„
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch10/ex5)


<br/>

**ë°°ê²½**
- ì½”ë“œë² ì´ìŠ¤ì—ì„œ íŠ¹ì • ê°’ì— ëŒ€í•´ ë˜‘ê°™ì´ ë°˜ì‘í•˜ëŠ” ì½”ë“œê°€ ì—¬ëŸ¬ ê³³ì´ë¼ë©´ ê·¸ ë°˜ì‘ë“¤ì„ í•œ ë°ë¡œ ëª¨ìœ¼ëŠ” ê²Œ íš¨ìœ¨ì ì´ë‹¤
- `íŠ¹ì´ ì¼€ì´ìŠ¤ íŒ¨í„´(special case pattern)` ?
  - íŠ¹ìˆ˜í•œ ê²½ìš°ì˜ ê³µí†µ ë™ì‘ì„ ìš”ì†Œ í•˜ë‚˜ì— ëª¨ì•„ì„œ ì‚¬ìš©
  - ì´ íŒ¨í„´ì„ í™œìš©í•˜ë©´ íŠ¹ì´ ì¼€ì´ìŠ¤ë¥¼ í™•ì¸í•˜ëŠ” ì½”ë“œ ëŒ€ë¶€ë¶„ì„ í•¨ìˆ˜ í˜¸ì¶œë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤
  - ë˜í•œ, ê·¸ ì´ìƒì˜ ì–´ë–¤ ë™ì‘ì„ ìˆ˜í–‰í•´ì•¼ í•œë‹¤ë©´ í•„ìš”í•œ ë©”ì„œë“œë¥¼ ë‹´ì€ ê°ì²´ë¥¼ ìƒì„±í•˜ë©´ ëœë‹¤
  - `ë„(null)`ì„ íŠ¹ì´ ì¼€ì´ìŠ¤ë¡œ ì²˜ë¦¬í•´ì•¼ í•  ë•Œê°€ ë§ì€ë°, ì´ë¥¼ `ë„ ê°ì²´ íŒ¨í„´(null object pattern)`ì´ë¼ê³ ë„ í•œë‹¤


<br/>

**ì ˆì°¨** <br/>
ëŒ€ìƒ ê°ì²´ê°€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê°’ ì¤‘ íŠ¹ë³„í•˜ê²Œ ë‹¤ë¤„ì•¼ í•  ê°’ì„ `íŠ¹ì´ ì¼€ì´ìŠ¤ í´ë˜ìŠ¤(í˜¹ì€ ë°ì´í„° êµ¬ì¡°)`ë¡œ ëŒ€ì²´í•˜ê³ ì í•œë‹¤
- ì»¨í…Œì´ë„ˆì— íŠ¹ì´ ì¼€ì´ìŠ¤ì¸ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ” ì†ì„±ì„ ì¶”ê°€í•˜ê³ , falseë¥¼ ë°˜í™˜í•˜ê²Œ í•œë‹¤
- íŠ¹ì´ ì¼€ì´ìŠ¤ ê°ì²´ë¥¼ ë§Œë“ ë‹¤ 
  - <u>ì´ ê°ì²´ëŠ” íŠ¹ì´ ì¼€ì´ìŠ¤ì¸ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ” ì†ì„±ë§Œ í¬í•¨í•˜ë©°, ì´ ì†ì„±ì€ trueë¥¼ ë°˜í™˜í•˜ê²Œ í•œë‹¤</u>
- í´ë¼ì´ì–¸íŠ¸ì—ì„œ íŠ¹ì´ ì¼€ì´ìŠ¤ì¸ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ” ì½”ë“œë¥¼ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•œë‹¤
  - ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ê°’ì„ ì§ì ‘ ë¹„êµí•˜ëŠ” ëŒ€ì‹  ë°©ê¸ˆ ì¶”ì¶œí•œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ê³ ì¹œë‹¤
- ì½”ë“œì— ìƒˆë¡œìš´ íŠ¹ì´ ì¼€ì´ìŠ¤ ëŒ€ìƒì„ ì¶”ê°€í•œë‹¤
  - í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ìœ¼ë¡œ ë°›ê±°ë‚˜ ë³€í™˜ í•¨ìˆ˜ë¥¼ ì ìš©í•˜ë©´ ëœë‹¤
- íŠ¹ì´ ì¼€ì´ìŠ¤ë¥¼ ê²€ì‚¬í•˜ëŠ” í•¨ìˆ˜ ë³¸ë¬¸ì„ ìˆ˜ì •í•˜ì—¬ íŠ¹ì´ ì¼€ì´ìŠ¤ ê°ì²´ì˜ ì†ì„±ì„ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤ 
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ì—¬ëŸ¬ `í•¨ìˆ˜ë¥¼ í´ë˜ìŠ¤ë¡œ ë¬¶ê¸°(6.9)`ë‚˜ `ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ë³€í™˜ í•¨ìˆ˜ë¡œ ë¬¶ê¸°(6.10)`ë¥¼ ì ìš©í•˜ì—¬ íŠ¹ì´ ì¼€ì´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê³µí†µ ë™ì‘ì„ ìƒˆë¡œìš´ ìš”ì†Œë¡œ ì˜®ê¸´ë‹¤
  - íŠ¹ì´ ì¼€ì´ìŠ¤ í´ë˜ìŠ¤ëŠ” ê°„ë‹¨í•œ ìš”ì²­ì—ëŠ” í•­ìƒ ê°™ì€ ê°’ì„ ë°˜í™˜í•˜ëŠ” ê²Œ ë³´í†µì´ë¯€ë¡œ, í•´ë‹¹ íŠ¹ì´ ì¼€ì´ìŠ¤ì˜ ë¦¬í„°ëŸ´ ë ˆì½”ë“œë¥¼ ë§Œë“¤ì–´ í™œìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤ (`JS`)
- ì•„ì§ë„ íŠ¹ì´ ì¼€ì´ìŠ¤ ê²€ì‚¬ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ëŠ” ê³³ì´ ìˆã……ë‹¤ë©´ ê²€ì‚¬ í•¨ìˆ˜ë¥¼ `ì¸ë¼ì¸(6.2)`í•œë‹¤

 
<br/>

> **NOTE**  (p391) ì˜ë„ì¹˜ ì•Šì€ ê°’ì´ ì…ë ¥ë˜ë©´ ì—ëŸ¬ë¥¼ ë˜ì§€ë„ë¡ í•¨ìˆ˜ ì¶”ì¶œí–ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë¦¬íŒ©í„°ë§ ë„ì¤‘ ì‹¤ìˆ˜ë¥¼ ì €ì§€ë¥´ê±°ë‚˜, í˜¹ì€ ì´ìƒí•˜ê²Œ ë™ì‘í•˜ëŠ” ìœ„ì¹˜ë¥¼ ì°¾ëŠ”ë° ë„ì›€ì´ ëœë‹¤

> **TIP** ì €ìëŠ” ë³¸ì§ˆì€ ê°™ê³  ë¶€ê°€ ì •ë³´ë§Œ ë«ë¶™ì´ëŠ” ë³€í™˜ í•¨ìˆ˜ì˜ ì´ë¦„ì„ `enrich`ë¼ í•˜ê³ , í˜•íƒœê°€ ë³€í•  ë•Œë§Œ `transform`ì´ë¼ ëª…ëª…í•œë‹¤

<br/>

**ì˜ˆì‹œ**
- ìƒí™©: `ë¯¸í™•ì¸ ê³ ê°` ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ì²˜ë¦¬í•˜ëŠ” ì½”ë“œê°€ Site í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ë¿Œë ¤ì ¸ ìˆë‹¤ê³  ê°€ì •
- `ë¯¸í™•ì¸ ê³ ê°`ì¸ ê²½ìš° 
  - ê³ ê° ì´ë¦„ì„ "ê±°ì£¼ì"ë¥¼ ì‚¬ìš©
  - ê¸°ë³¸ ìš”ê¸ˆì œ(billingPlans)ë¥¼ ì²­êµ¬
  - ì—°ì²´ (delinquent) ê¸°ê°„ì€ 0ì£¼(week)ë¡œ ë¶„ë¥˜

<br/>

ìë°” ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©ì‹œ ë¦¬í„°ëŸ´ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ê°€ëŠ¥í•˜ë‹¤ëŠ”ë“¯
```javascript
function createUnknownCustomer() {
    return {
        isUnknown: true,
        name: "ê±°ì£¼ì",
        billingPlan: registry.billingPlans.basic,
        paymentHistory: {
            weeksDelinquentInLastYear : 0
        }
    };
}
```

<br/>

```text
{
    name: "ì—í¬ë¯¸ ë³´ìŠ¤í„´",
    location: "Malden MA",
    // ë” ë§ì€ í˜„ì¥ (Site) ì •ë³´
    customer: {
       name: "ì• í¬ë¯¸ ì‚°ì—…",
       billingPlan: "plan-451",
       paymentHistory: {
            weeksDelinquentInLastYear: 7
            // ì¤‘ëµ
       },
       // ì¤‘ëµ
    }
}

// ê³ ê°ì´ ì•Œë ¤ì§€ì§€ ì•ŠëŠ” ê²½ìš°, ë˜‘ê°™ì´ "ë¯¸í™•ì¸ ê³ ê°"ìœ¼ë¡œ í‘œì‹œí•˜ì (ê°ì²´ì—ì„œ ë¬¸ìì—´ì´ ë˜ë„¤)
{
    name: "ì—í¬ë¯¸ ë³´ìŠ¤í„´",
    location: "Malden MA",
    // ë” ë§ì€ í˜„ì¥ (Site) ì •ë³´
    customer: "ë¯¸í™•ì¸ ê³ ê°"
}
```
<br/>

```javascript
function isUnknown(aCustomer) {
    return aCustomer === "ë¯¸í™•ì¸ ê³ ê°";
}

function enrichSite(aSite) {
    const result = _.cloneDeep(aSite);
    
    // íŠ¹ì´ ì¼€ì´ìŠ¤ì— ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ë³€í™˜ í•¨ìˆ˜ë¡œ ë¬¶ê¸° ì ìš©(p401)
    const unknowneCustomer = {
        isUnknown: true,
        name: "ê±°ì£¼ì",
        billingPlan: registry.billingPlans.basic,
        paymentHistory: {
            weeksDeliquentInLastYear: 0
        }
    }
    
    if(isUnknown(result.customer)) result.customer = unknowneCustomer;
    else result.customer.isUnknown = false;
    
    return result
}
```
<br/>

### 10.6 ì–´ì„œì…˜ ì¶”ê°€í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Introduce Assertion](https://refactoring.com/catalog/introduceAssertion.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch10/ex6)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch10/ex6)

<br/>

**ë°°ê²½**
- íŠ¹ì • ì¡°ê±´ì´ ì°¸ì¼ ë•Œë§Œ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ” ì½”ë“œ ì˜ì—­ì´ ìˆì„ ìˆ˜ ìˆë‹¤
- <u>ì–´ì„œì…˜ì€ í•­ìƒ ì°¸ì´ë¼ê³  ê°€ì •í•˜ëŠ” ì¡°ê±´ë¬¸ ë¬¸ì¥ìœ¼ë¡œ, ì–´ì„œì…˜ì´ ì‹¤íŒ¨í–ˆë‹¤ëŠ” ê²ƒì€ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì˜ëª»í–ˆë‹¤ëŠ” ëœ»ì´ë‹¤</u>
  - ì–´ì„œì…˜ì„ ì»´íŒŒì¼ íƒ€ì„ì— ì¼œê³  ëŒ ìˆ˜ ìˆëŠ” ìŠ¤ìœ„ì¹˜ë¥¼ ì œê³µí•˜ëŠ” í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë„ ìˆë‹¤
  - **ì–´ì„œì…˜ì€ í”„ë¡œê·¸ë¨ì´ ì–´ë–¤ ìƒíƒœì„ì„ ê°€ì •í•œ ì±„ ì‹¤í–‰ë˜ëŠ”ì§€ë¥¼ ë‹¤ë¥¸ ê°œë°œìì—ê²Œ ì•Œë ¤ì£¼ëŠ” í›Œë¥­í•œ ì†Œí†µ ë„êµ¬ì¸ ê²ƒì´ë‹¤**
- í•œí¸, í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ìˆë‹¤ë©´ ì–´ì…”ì…˜ì˜ ë””ë²„ê¹… ìš©ë„ë¡œì„œì˜ íš¨ìš©ì€ ì¤„ì–´ë“ ë‹¤
  - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ê¾¸ì¤€íˆ ì¶”ê°€í•˜ì—¬ ì‚¬ê°ì„ ì¢íˆë©´ ì–´ì„œì…˜ë³´ë‹¤ ë‚˜ì„ ë•Œê°€ ë§ë‹¤

<br/>

**ì ˆì°¨**
- ì°¸ì´ë¼ê³  ê°€ì •í•˜ëŠ” ì¡°ê±´ì´ ë³´ì´ë©´ ê·¸ ì¡°ê±´ì„ ëª…ì‹œí•˜ëŠ” ì–´ì„œì…˜ì„ ì¶”ê°€í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Customer {
  private final double discountRate;

  public Customer(double discountRate) {
    this.discountRate = discountRate;
  }

  public double applyDiscount(int aNumber) {
    return (this.discountRate > 0.0) 
            ? aNumber - (this.discountRate * aNumber) 
            : aNumber;
  }
}
```

**âœ¨after**
```java
public class Customer {
  private final double discountRate;

  public Customer(double discountRate) {
    if (discountRate < 0.0) {
      throw new IllegalArgumentException("Discount rate must be greater than or equal to 0.");
    }

    this.discountRate = discountRate;
  }

  public double applyDiscount(int aNumber) {
    if (this.discountRate < 0.0) return aNumber;

    return aNumber - (this.discountRate * aNumber);
  }
}
```

> **NOTE** (p406)
> - í•œí¸ ì–´ì„œì…˜ì„ ë‚¨ë°œí•˜ëŠ” ê²ƒ ì—­ì‹œ ìœ„í—˜í•˜ë‹¤. ì°¸ì´ë¼ê³  ìƒê°í•˜ëŠ” ê°€ì • ëª¨ë‘ì— ì–´ì„œì…˜ì„ ë‹¬ì§€ ì•ŠëŠ”ë‹¤. `ë°˜ë“œì‹œ ì°¸ì´ì–´ì•¼ í•˜ëŠ”`ê²ƒë§Œ ê²€ì‚¬í•œë‹¤
> - í”„ë¡œê·¸ë˜ë¨¸ê°€ ì¼ìœ¼í‚¬ë§Œí•œ ì˜¤ë¥˜ì—ë§Œ ì–´ì„œì…˜ì„ ì‚¬ìš©í•œë‹¤. ì–´ì„œì…˜ì€ ë²„ê·¸ ì¶”ì ì„ ë•ëŠ” ìµœí›„ì˜ ìˆ˜ë‹¨ì´ë‹¤. í•˜ì§€ë§Œ ëª¨ìˆœë˜ê²Œë„ ì €ìëŠ” ì ˆëŒ€ ì‹¤íŒ¨í•˜ì§€ ì•Šìœ¼ë¦¬ë¼ ë¯¿ëŠ” ê³³ì—ë§Œ ì‚¬ìš©í•œë‹¤ê³  ë§í•œë‹¤

<br/>

**ì°¸ê³ . assertë¬¸ ë¶€ìˆ˜íš¨ê³¼ (ì¶œì²˜. ìë°” ì½”ë“œì˜ í’ˆì§ˆì„ ë†’ì´ëŠ” 100ê°€ì§€ ë°©ë²•)**
<img src="https://github.com/ljw1126/user-content/blob/master/refactoring2/ch10/%EB%8F%84%EC%84%9C%20-%20%EC%9E%90%EB%B0%94%20%EC%BD%94%EB%93%9C%EC%9D%98%20%ED%92%88%EC%A7%88%EC%9D%84%20%EB%86%92%EC%9D%B4%EB%8A%94%20100%EA%B0%80%EC%A7%80%20%EB%B0%A9%EB%B2%95.png?raw=true">


<br/>


### 10.7 ì œì–´ í”Œë˜ê·¸ë¥¼ íƒˆì¶œë¬¸ìœ¼ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Control Flag with Break](https://refactoring.com/catalog/replaceControlFlagWithBreak.html)
- ë°”ë¡œê°€ê¸°:
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch10/ex7)

<br/>

**ë°°ê²½**
- `ì œì–´ í”Œë˜ê·¸ == ì•…ì·¨`
- í•¨ìˆ˜ì—ì„œ í•  ì¼ì„ ë‹¤ ë§ˆì³¤ë‹¤ë©´ ê·¸ ì‚¬ì‹¤ì„ return ë¬¸ìœ¼ë¡œ ëª…í™•íˆ ì•Œë¦¬ëŠ” í¸ì´ ë‚«ë‹¤
<br/>


**ì ˆì°¨**
- ì œì–´ í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ í•¨ìˆ˜ë¡œ ì¶”ì¶œí• ì§€ ê³ ë ¤í•œë‹¤
- ì œì–´ í”Œë˜ê·¸ë¥¼ ê°±ì‹ í•˜ëŠ” ì½”ë“œ ê°ê°ì„ ì ì ˆí•œ ì œì–´ë¬¸ìœ¼ë¡œ ë°”ê¾¼ë‹¤ 
  - í•˜ë‚˜ ë°”ê¿€ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤
  - ì œì–´ë¬¸ìœ¼ë¡œ ì£¼ë¡œ `return`, `break`, `continue`ê°€ ì“°ì¸ë‹¤
- ëª¨ë‘ ìˆ˜ì •í–ˆë‹¤ë©´ ì œì–´ í”Œë˜ê·¸ë¥¼ ì œê±°í•œë‹¤
<br/>

**ğŸ’©before**
```java
public boolean existMiscreant(String[] people) {
    boolean found = false;

    for (String p : people) {
      if (!found) {
        if (p.equals("ì¡°ì»¤")) {
          // do something
          found = true;
        }

        if (p.equals("ì‚¬ë£¨ë§Œ")) {
          // do something
          found = true;
        }
      }
    }

    return found;
  }
```
<br/>

**âœ¨after**
```java
public boolean existMiscreant(String[] people) {
  return Stream.of(people)
          .anyMatch(p -> p.equals("ì¡°ì»¤") || p.equals("ì‚¬ë£¨ë§Œ"));
}

// ë˜ëŠ” Set ì‚¬ìš©í•´ì„œ O(1) ì¡°íšŒ ê°€ëŠ¥
public boolean existMiscreant(String[] people) {
  Set<String> miscreant = Set.of("ì¡°ì»¤", "ì‚¬ë£¨ë§Œ");
  return Stream.of(people).anyMatch(miscreant::contains);
}
```
<br/>


---

### Reference.
- [ê¸°ìˆ  ë¸”ë¡œê·¸ - Null Object Pattern](https://johngrib.github.io/wiki/pattern/null-object/)
- [Baeldung - java assert](https://www.baeldung.com/java-assert)
- [ê¸°ìˆ  ë¸”ë¡œê·¸ - java assert ì˜ í™œìš©í•˜ê¸°](https://hojun-dev.tistory.com/entry/JAVA-assert-%EC%9E%98-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-with-Spring-Assert#Java%EC%9D%98%20assert%20vs%20Spring%EC%9D%98%20Assert-1)
