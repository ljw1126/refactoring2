# Chapter12. ìƒì† ë‹¤ë£¨ê¸°
## í›„ê¸°

ì´ë²ˆ ì±•í„° í•™ìŠµì„ í†µí•´ ìƒì†ì„ ë¦¬íŒ©í„°ë§ í•˜ëŠ” ê³¼ì •ì— ìµìˆ™í•´ì§ˆ ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ë‹¤. 
ìƒì†ì„ ì´ë¡ ìœ¼ë¡œ ë°°ìš´ ì´í›„ë¡œëŠ” ì‹¤ë¬´ì—ì„œ ì§ì ‘ êµ¬í˜„í•´ ë³¸ ì ì´ ê±°ì˜ ì—†ì—ˆë‹¤.
ê·¸ëŸ¬ë‹¤ ë³´ë‹ˆ `íƒ¬í”Œë¦¿ ë©”ì„œë“œ íŒ¨í„´ì´ ìƒì†ì˜ ì´ìƒì ì¸ í˜•íƒœ`ë¼ê±°ë‚˜ `ìƒì†ë³´ë‹¤ëŠ” ìœ„ì„(Composition)ì„ ì‚¬ìš©í•´ë¼` ë“±ì˜ ì–¸ê¸‰ì„ ì—¬ëŸ¬ ë²ˆ ì ‘í–ˆì§€ë§Œ ì™€ë‹¿ì§€ ì•Šì•„ ìƒì†ì„ ë©€ë¦¬í–ˆì—ˆë‹¤.
í•˜ì§€ë§Œ ë§ˆì§€ë§‰ ì˜ˆì‹œì—ì„œ ìŠˆí¼ í´ë˜ìŠ¤ë‚˜ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë¦¬íŒ©í„°ë§ í•˜ëŠ” ê³¼ì •ì„ í†µí•´ `ìƒì†ë³´ë‹¤ëŠ” ìœ„ì„(Composition)ì„ ì‚¬ìš©í•´ë¼`ëŠ” ë§ì´ ë¬´ì—‡ì¸ì§€ ì´ì œì„œì•¼ ì´í•´í•  ìˆ˜ ìˆì—ˆë‹¤.
ê·¸ë¦¬ê³  ìœ„ì„ ê°ì²´ì˜ íƒ€ì…ì„ ì¸í„°í˜ì´ìŠ¤ë¿ë§Œ ì•„ë‹ˆë¼ ìƒì†ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤ëŠ” ê±¸ ì²˜ìŒ ì•Œê²Œ ë˜ì–´ ì¸ìƒì ì´ì—ˆë‹¤.

<br/>

ìƒì†ì„ ìœ„ì„ìœ¼ë¡œ ë¦¬íŒ©í„°ë§í•˜ë©´ì„œ ìˆœí™˜ ì°¸ì¡° ì´ìŠˆê°€ ë§ì´ ë°œìƒí–ˆë‹¤. 
ê·¸ ì¤‘ ê¸°ì–µë‚¨ëŠ” ê²ƒì€ 12.10 ë‘ë²ˆì§¸ ì˜ˆì‹œì˜€ë‹¤.

<br/>

**ğŸ’©before** <br/>
`Bird` â¡ï¸ `SpeciesDelegate` â¡ï¸ `Bird` ìˆœí™˜ì°¸ì¡° ë°œìƒ
```java
public class Bird {
    private final String name;
    private final String plumage;
    private final SpeciesDelegate speciesDelegate; 

    private Bird(BirdDto birdDto) {
        this.name = birdDto.name();
        this.plumage = birdDto.plumage();
        this.speciesDelegate = selectSpeciesDelegate(birdDto);
    }

    private SpeciesDelegate selectSpeciesDelegate(BirdDto birdDto) {
        return switch (birdDto.type()) {
            case "ìœ ëŸ½ ì œë¹„" -> new EuropeanSwallowDelegate(this);
            case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> new AfricanSwallowDelegate(birdDto, this);
            case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> new NorwegianBlueParrotDelegate(birdDto, this);
            default -> new SpeciesDelegate(this);
        };
    }

    public static Bird from(BirdDto data) {
        return new Bird(data);
    }

    public String name() {
        return name;
    }

    public String plumage() {
        return this.speciesDelegate.plumage();
    }

    public Integer airSpeedVelocity() {
        return this.speciesDelegate.airSpeedVelocity();
    }

}


public class SpeciesDelegate {
  protected final Bird bird; // ğŸ’©

  protected SpeciesDelegate(Bird bird) {
    this.bird = bird;
  }

  public String plumage() {
    String plumage = this.bird.plumage();
    return plumage.isBlank() ? "ë³´í†µì´ë‹¤" : plumage;
  }

  public Integer airSpeedVelocity() {
    return null;
  }
}

public class NorwegianBlueParrotDelegate extends SpeciesDelegate { // ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´
  private final int voltage;
  private final boolean isNailed;

  public NorwegianBlueParrotDelegate(BirdDto data, Bird bird) {
    super(bird);
    this.voltage = data.voltage();
    this.isNailed = data.isNailed();
  }

  @Override
  public String plumage() {
    if (voltage > 100) return "ê·¸ì„ë ¸ë‹¤";

    return this.bird.plumage().isBlank() ? "ì˜ˆì˜ë‹¤" : this.bird.plumage(); // ğŸ’©
  }

  @Override
  public Integer airSpeedVelocity() {
    return isNailed ? 0 : 10 + voltage / 10;
  }
}
```

**ì°¸ê³ .**
<img src="https://github.com/ljw1126/user-content/blob/master/refactoring2/ch12/12.10-1.png?raw=true"/>

<br/>

**âœ¨after**
```java
public class Bird {
  private final String name;
  private final String plumage;
  private final SpeciesDelegate speciesDelegate;

  private Bird(BirdDto birdDto) {
    this.name = birdDto.name();
    this.plumage = birdDto.plumage();
    this.speciesDelegate = selectSpeciesDelegate(birdDto);
  }

  private SpeciesDelegate selectSpeciesDelegate(BirdDto birdDto) {
    return switch (birdDto.type()) {
      case "ìœ ëŸ½ ì œë¹„" -> new EuropeanSwallowDelegate();
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> new AfricanSwallowDelegate(birdDto);
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> new NorwegianBlueParrotDelegate(birdDto);
      default -> new SpeciesDelegate();
    };
  }

  public static Bird from(BirdDto data) {
    return new Bird(data);
  }

  public String name() {
    return name;
  }

  public String plumage() {
    return this.speciesDelegate.plumage(this.plumage); // âœ¨
  }

  public Integer airSpeedVelocity() {
    return this.speciesDelegate.airSpeedVelocity();
  }
}
```
<img src="https://github.com/ljw1126/user-content/blob/master/refactoring2/ch12/12.10-3.png?raw=true"/>

- Birdì—ì„œ `plumage()` í˜¸ì¶œì‹œ íŒŒë¼ë¯¸í„° ì£¼ì…ì„ í•˜ëŠ” í˜•íƒœë¡œ í•˜ì—¬ ìˆœí™˜ì°¸ì¡° ì´ìŠˆë¥¼ í•´ê²°í–ˆë‹¤.
- ì´ì™¸ì—ë„ í•„ìš”í•œ í•„ë“œë§Œ ìƒì„±ì ì´ˆê¸°í™”ì‹œ ë„˜ê¸°ê±°ë‚˜, í•„ìš”í•œ ê¸°ëŠ¥ì„ ë”°ë¼ ë½‘ì•„ ì¸í„°í˜ì´ìŠ¤ë¡œ ì¶”ìƒí™”í•˜ì—¬ ì£¼ì… ë°›ëŠ” ë°©ë²•ë„ ê³ ë ¤í•  ìˆ˜ ìˆë‹¤.
- ìì‹ì´ ë¶€ëª¨ ì°¸ì¡°í•˜ì—¬ í¸í•œ ê²ƒë„ ìˆì—ˆëŠ”ë°, ê°œì¸ì ìœ¼ë¡œ ì§€ê¸ˆê³¼ ê°™ì€ ì•ˆì „í•œ ìƒí™©ì—ì„œëŠ” í—ˆìš©í•´ë„ ê´œì°®ì§€ ì•Šì•˜ì„ê¹Œ ë¼ëŠ” ìƒê°ë„ ë“¤ì—ˆë‹¤. (ğŸ¤”)

<br/>


**ì°¸ê³ .** [ì¸í”„ëŸ° - ìƒíƒœíŒ¨í„´ì˜ ìˆœí™˜ì°¸ì¡°ëŠ” ì‚¬ìš©í•´ë„ ì¢‹ì€ ê²ƒì¸ê°€ìš”?](https://www.inflearn.com/community/questions/391143?focusComment=158969)
> ìˆœí™˜ ì°¸ì¡°ëŠ” ê°€ê¸‰ì ì´ë©´ í”¼í•˜ëŠ”ê²Œ ì¢‹ì€ë°ìš” (..)
> State ìª½ì—ì„œ Contextë¥¼ í•„ë“œë¡œ ê°€ì ¸ë„ ë˜ì§€ë§Œ Stateì— ìˆëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ Contextë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì¤„ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. 
> ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê¸°ë”ë¼ë„ Stateì™€ ContextëŠ” ìƒí˜¸ê°„ì— ì°¸ì¡°ë¥¼ í•˜ê¸´í•˜ì§€ë§Œ í•„ë“œë¥¼ ê°€ì§€ê³  ìƒì„±ìë¡œ ë„˜ê²¨ì¤˜ì•¼ í•  ë•Œ ë³´ë‹¤ëŠ” ê°ì²´ ìƒì„±ì´ë‚˜ ìˆœí™˜ ì°¸ì¡°ë¡œ ì¸í•œ ì´ìŠˆê°€ ì¤„ì–´ë“¤ê¸´ í•  ê²ë‹ˆë‹¤. (..)

<br/>

**ğŸ¤–Chat-GPT**
- âœ… ì™œ ìˆœí™˜ ì°¸ì¡°ë¥¼ í”¼í•˜ë ¤ê³  í• ê¹Œ?
  - í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€: Delegateë¥¼ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ Birdë¥¼ ë¨¼ì € ë§Œë“¤ì–´ì•¼ í•˜ê³  â†’ ë³µì¡í•¨.
  - ê²°í•©ë„ ì¦ê°€: Delegateê°€ Bird ë‚´ë¶€ êµ¬ì¡°ì— ì˜ì¡´ â†’ Bird ë°”ë€Œë©´ Delegate ê¹¨ì§ˆ ìˆ˜ ìˆìŒ.
  - ìˆœí™˜ ì˜ì¡´ì— ë”°ë¥¸ ì½”ë“œ ëƒ„ìƒˆ: ë””ë²„ê¹… ì–´ë ¤ì›Œì§€ê³ , ì„¤ê³„ê°€ ê¼¬ì´ê¸° ì‰¬ì›€.
  - ê°ì²´ ìˆ˜ëª… ê´€ë¦¬ ë³µì¡: thisë¥¼ ìƒì„±ìì— ë„˜ê¸°ëŠ” ìˆœê°„ "ì•„ì§ ì´ˆê¸°í™” ì¤‘ì¸ ê°ì²´"ë¥¼ ë„˜ê¸°ëŠ” ê²ƒì´ë¯€ë¡œ, NullPointerException ìœ„í—˜ë„.
- â˜ï¸ì‹¤ë¬´ íŒ
  - ìƒì†ì€ ë¦¬íŒ©í„°ë§ í›„ë°˜ì— ê³ ë ¤, ì´ˆë°˜ì—ëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ìœ ì—°í•˜ê²Œ ì‹œì‘
  - "ì´ê²Œ ìƒì†(`is-a`)ì´ì•¼? ì•„ë‹ˆë©´ ë‹¨ìˆœ ìœ„ì„(`has-a`)ì´ë©´ ë˜ë‚˜?" ìŠ¤ìŠ¤ë¡œ ì§ˆë¬¸í•´ë³´ê¸°
  - ê°€ëŠ¥í•˜ë©´ ìƒì†ë³´ë‹¤ êµ¬ì„±(composition) â†’ `has-a` ê´€ê³„ ê¶Œì¥

**ğŸ’¡í”„ë¡œê·¸ë˜ë°ì—ì„œ Context ì˜ë¯¸**
- íŠ¹ì • ì‘ì—…ì´ë‚˜ ìƒíƒœ, í™˜ê²½ì— ëŒ€í•œ ì •ë³´ë¥¼ ìº¡ìŠí™”í•˜ëŠ” ê²ƒì„ ì˜ë¯¸ 
  - 1. ìƒíƒœ ë° í™˜ê²½ ì •ë³´ ìº¡ìŠí™”: íŠ¹ì • ì‘ì—…ì´ë‚˜ ì•Œê³ ë¦¬ì¦˜ì„ ìˆ˜í–‰í•˜ëŠ”ë° í•„ìš”í•œ ìƒíƒœë‚˜ í™˜ê²½ ì •ë³´ë¥¼ ìº¡ìŠí™”í•˜ì—¬ ì „ë‹¬í•˜ê±°ë‚˜ ê´€ë¦¬í•¨
  - 2. ì‘ì—… ì „í™˜ ê´€ë¦¬: ì‘ì—…ì´ ì¤‘ë‹¨ë˜ê±°ë‚˜ ë‚˜ì¤‘ì— ê°™ì€ ì§€ì ì—ì„œ ê³„ì†ë  ìˆ˜ ìˆë„ë¡ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ë³µêµ¬í•¨
- ì˜ˆì‹œ.
  - **ë°ì´í„°ë² ì´ìŠ¤ ì»¨í…ìŠ¤íŠ¸** : DB ì—°ê²° ë° íŠ¸ëœì­ì…˜ ìƒíƒœë¥¼ ê´€ë¦¬
  - **ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸** : ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì„± ë° ìƒíƒœ ì •ë³´ë¥¼ ê´€ë¦¬ (ë˜ëŠ” ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸)
  - **ë©€í‹°ìŠ¤ë ˆë”©ê³¼ í”„ë¡œì„¸ìŠ¤ ì»¨í…ìŠ¤íŠ¸** : í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ìŠ¤ë ˆë“œ ë˜ëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ë³µêµ¬í•˜ëŠ” ì—­í•  


```text
12.10 ë°°ê²½ ä¸­
- ìœ ëª…í•œ ì›ì¹™ ì¤‘ í•˜ë‚˜ê°€ ìˆë‹¤
  - '(í´ë˜ìŠ¤) ìƒì† ë³´ë‹¤ëŠ” (ê°ì²´) ì»´í¬ì§€ì…˜ì„ ì‚¬ìš©í•˜ë¼'
  - ì—¬ê¸°ì„œ ì»´í¬ì§€ì…˜(composition)ì€ ì‚¬ì‹¤ìƒ ìœ„ì„ê³¼ ê°™ì€ ë§ì´ë‹¤
  - ìœ„ì„ì„ ì•Œê³  ìˆë‹¤ë©´ ì²˜ìŒì— ìƒì†ìœ¼ë¡œ ì ‘ê·¼í•œ ë‹¤ìŒ, ë¬¸ì œê°€ ìƒê¸°ë©´ ìœ„ì„ìœ¼ë¡œ ê°ˆì•„íƒ„ë‹¤
- ë””ìì¸íŒ¨í„´ ì±…ì€ ìƒì†ê³¼ ì»´í¬ì§€ì…˜ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•´ì¤€ë‹¤
  - ì´ ì›ì¹™ì€ ìƒì†ì„ ì“°ì§€ ë§ë¼ëŠ” ê²Œ ì•„ë‹ˆë¼, ê³¼ìš©í•˜ëŠ” ë° ë”°ë¥¸ ë°˜ì‘ìš©ìœ¼ë¡œ ë‚˜ì˜¨ ê²ƒì´ë‹¤
  - ë””ìì¸íŒ¨í„´ì— ìµìˆ™í•˜ë‹¤ë©´ ì´ ë¦¬íŒ©í„°ë§ì„ 'ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìƒíƒœ íŒ¨í„´'ì´ë‚˜ 'ì „ëµ íŒ¨í„´'ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤ê³  ìƒê°í•˜ë©´ ë„ì›€ì´ ëœë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ëŠ” ëª¨ë“  ê²½ìš°ì—ì„œ ìœ„ì„ì„ ê³„ì¸µêµ¬ì¡°ë¡œ ì„¤ê³„í•´ì•¼ í•˜ëŠ” ê±´ ì•„ë‹ˆë‹¤
  - í•˜ì§€ë§Œ ìƒíƒœë‚˜ ì „ëµì— ê³„ì¸µêµ¬ì¡°ë¥¼ ì ìš©í•˜ë©´ ìœ ìš©í•  ë•Œê°€ ë§ë‹¤ (ğŸ¤”)
```
<br/>


---
## ëª©ì°¨
- [12.1 ë©”ì„œë“œ ì˜¬ë¦¬ê¸°](#121-ë©”ì„œë“œ-ì˜¬ë¦¬ê¸°)
- [12.2 í•„ë“œ ì˜¬ë¦¬ê¸°](#122-í•„ë“œ-ì˜¬ë¦¬ê¸°)
- [12.3 ìƒì„±ì ë³¸ë¬¸ ì˜¬ë¦¬ê¸°](#123-ìƒì„±ì-ë³¸ë¬¸-ì˜¬ë¦¬ê¸°)
- [12.4 ë©”ì„œë“œ ë‚´ë¦¬ê¸°](#124-ë©”ì„œë“œ-ë‚´ë¦¬ê¸°)
- [12.5 í•„ë“œ ë‚´ë¦¬ê¸°](#125-í•„ë“œ-ë‚´ë¦¬ê¸°)
- [12.6 íƒ€ì… ì½”ë“œë¥¼ ì„œë¸Œí´ë˜ìŠ¤ë¡œ ë°”ê¾¸ê¸°](#126-íƒ€ì…-ì½”ë“œë¥¼-ì„œë¸Œí´ë˜ìŠ¤ë¡œ-ë°”ê¾¸ê¸°)
- [12.7 ì„œë¸Œ í´ë˜ìŠ¤ ì œê±°í•˜ê¸°](#127-ì„œë¸Œí´ë˜ìŠ¤-ì œê±°í•˜ê¸°)
- [12.8 ìŠˆí¼ í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°](#128-ìŠˆí¼í´ë˜ìŠ¤-ì¶”ì¶œí•˜ê¸°)
- [12.9 ê³„ì¸µ í•©ì¹˜ê¸°](#129-ê³„ì¸µ-í•©ì¹˜ê¸°)
- [12.10 ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ê¸°](#1210-ì„œë¸Œ-í´ë˜ìŠ¤ë¥¼-ìœ„ì„ìœ¼ë¡œ-ë°”ê¾¸ê¸°)
- [12.11 ìŠˆí¼ í´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ê¸°](#1211-ìŠˆí¼-í´ë˜ìŠ¤ë¥¼-ìœ„ì„ìœ¼ë¡œ-ë°”ê¾¸ê¸°)

<br/>

### 12.1 ë©”ì„œë“œ ì˜¬ë¦¬ê¸°
- ì¹´íƒˆë¡œê·¸: [Pull Up Method](https://refactoring.com/catalog/pullUpMethod.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§: [ë©”ì„œë“œ ë‚´ë¦¬ê¸°](#124-ë©”ì„œë“œ-ë‚´ë¦¬ê¸°)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex1)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex1)

<br/>

**ë°°ê²½**
- ì¤‘ë³µ ì½”ë“œ ì œê±°ëŠ” ì¤‘ìš”í•˜ë‹¤
- ë¬´ì–¸ê°€ ì¤‘ë³µë˜ì—ˆë‹¤ëŠ” ê²ƒì€ í•œìª½ì˜ ë³€ê²½ì´ ë‹¤ë¥¸ ìª½ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ìœ„í—˜ì„ í•­ìƒ ìˆ˜ë ¨í•œë‹¤
- ë©”ì„œë“œ ì˜¬ë¦¬ê¸°ë¥¼ ì ìš©í•˜ê¸° ê°€ì¥ ì‰¬ìš´ ìƒí™©ì€ ë©”ì„œë“œë“¤ì˜ ë³¸ë¬¸ ì½”ë“œê°€ ë˜‘ê°™ì„ ë•Œë‹¤
<br/>

**ì ˆì°¨**
- ë˜‘ê°™ì´ ë™ì‘í•˜ëŠ” ë©”ì„œë“œì¸ì§€ ë©´ë°€íˆ ì‚´í´ë³¸ë‹¤
  - ì‹¤ì§ˆì ìœ¼ë¡œ í•˜ëŠ” ì¼ì€ ê°™ì§€ë§Œ ì½”ë“œê°€ ë‹¤ë¥´ë‹¤ë©´ ë³¸ë¬¸ ì½”ë“œê°€ ë˜‘ê°™ì•„ì§ˆ ë•Œê¹Œì§€ ë¦¬íŒ©í„°ë§í•œë‹¤
- ë©”ì„œë“œ ì•ˆì—ì„œ í˜¸ì¶œí•˜ëŠ” ë‹¤ë¥¸ ë©”ì„œë“œì™€ ì°¸ì¡°í•˜ëŠ” í•„ë“œë“¤ì„ ìŠˆí¼í´ë˜ìŠ¤ì—ì„œë„ í˜¸ì¶œí•˜ê³  ì°¸í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤
- ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ê°€ ë‹¤ë¥´ë‹¤ë©´ í•¨ìˆ˜ ì„ ì–¸ ë°”ê¾¸ê¸°ë¡œ ìŠˆí¼í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ í˜•íƒœë¡œ í†µì¼í•œë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ì— ìƒˆë¡œìš´ ë©”ì„œë“œë¥¼ ìƒì„±í•˜ê³ , ëŒ€ìƒ ë©”ì„œë“œì˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ë„£ëŠ”ë‹¤
- ì •ì  ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ ì¤‘ í•˜ë‚˜ì˜ ë©”ì„œë“œë¥¼ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì˜ ë©”ì„œë“œê°€ ì—†ì–´ì§ˆ ë•Œê¹Œì§€ ë‹¤ë¥¸ ì„œë¸Œí´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ í•˜ë‚˜ì”© ì œê±°í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Party {
}

public class Department extends Party {

    private final int monthlyCost;

    public Department(int monthlyCost) {
        this.monthlyCost = monthlyCost;
    }

    public int getTotalAnnualCost() {
        return this.monthlyCost * 12;
    }
}

public class Employee extends Party {
  private final int monthlyCost;

  public Employee(int monthlyCost) {
    this.monthlyCost = monthlyCost;
  }

  public int annualCost() {
    return this.monthlyCost * 12;
  }
}
```
<br/>

**âœ¨after**
```java
public abstract class Party {
  public int annualCost() {
    throw new IllegalStateException();
  }
}

public class Employee extends Party {
    private final int monthlyCost;

    public Employee(int monthlyCost) {
        this.monthlyCost = monthlyCost;
    }

    @Override
    public int annualCost() {
        return this.monthlyCost * 12;
    }
}

public class Department extends Party {

  private final int monthlyCost;

  public Department(int monthlyCost) {
    this.monthlyCost = monthlyCost;
  }

  @Override
  public int annualCost() {
    return this.monthlyCost * 12;
  }
}
```
<br/>


### 12.2 í•„ë“œ ì˜¬ë¦¬ê¸°
- ì¹´íƒˆë¡œê·¸: [Pull Up Field](https://refactoring.com/catalog/pullUpField.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§: [í•„ë“œ ë‚´ë¦¬ê¸°](#125-í•„ë“œ-ë‚´ë¦¬ê¸°)
- ì˜ˆì‹œ âŒ

<br/>

**ë°°ê²½**
- íŠ¹íˆ í•„ë“œê°€ ì¤‘ë³µë˜ê¸° ì‰½ë‹¤
- ê·¸ë˜ì„œ ì–´ë–¤ ì¼ì´ ë²Œì–´ì§€ëŠ”ì§€ë¥¼ ì•Œì•„ë‚´ë ¤ë©´ í•„ë“œë“¤ì´ ì–´ë–»ê²Œ ì´ìš©ë˜ëŠ” ë¶„ì„í•´ë´ì•¼ í•œë‹¤
<br/>

**ì ˆì°¨**
- í›„ë³´ í•„ë“œë“¤ì„ ì‚¬ìš©í•˜ëŠ” ê³³ ëª¨ë‘ê°€ ê·¸ í•„ë“œë“¤ì„ ë˜‘ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ì§€ ë©´ë°€íˆ ì‚´í•€ë‹¤
- í•„ë“œë“¤ì˜ ì´ë¦„ì´ ê°ê¸° ë‹¤ë¥´ë‹¤ë©´ ë˜‘ê°™ì€ ì´ë¦„ìœ¼ë¡œ ë°”ê¾¼ë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ì— ìƒˆë¡œìš´ í•„ë“œë¥¼ ìƒì„±í•œë‹¤
  - ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì´ í•„ë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ì˜ í•„ë“œë“¤ì„ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
<br/>


**ğŸ’©before**
```java
class Employee {..}

class Salesperson extends Employee {
    private String name;
}

class Engineer extends Employee {
  private String name;
}
```
<br/>

**âœ¨after**
```java
class Employee {
  private String name;
}

class Salesperson extends Employee {
}

class Engineer extends Employee {
}
```
<br/>


### 12.3 ìƒì„±ì ë³¸ë¬¸ ì˜¬ë¦¬ê¸°
- ì¹´íƒˆë¡œê·¸: [Pull Up Constructor Body](https://refactoring.com/catalog/pullUpConstructorBody.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex3)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex3)

<br/>

**ë°°ê²½**
- ì„œë¸Œí´ë˜ìŠ¤ë“¤ì—ì„œ ê¸°ëŠ¥ì´ ê°™ì€ ë©”ì„œë“œë“¤ì„ ë°œê²¬í•˜ë©´ í•¨ìˆ˜ ì¶”ì¶œí•˜ê¸°ì™€ ë©”ì„œë“œ ì˜¬ë¦¬ê¸°ë¥¼ ì°¨ë¡€ë¡œ ì ìš©í•˜ì—¬ ë§ë”íˆ ìŠˆí¼í´ë˜ìŠ¤ë¡œ ì˜®ê¸°ê³¤í•œë‹¤
<br/>

> **NOTE** ì´ë²ˆ ë¦¬íŒ©í„°ë§ì´ ê°„ë‹¨íˆ ëë‚  ê²ƒ ê°™ì§€ ì•Šë‹¤ë©´ ìƒì„±ìë¥¼ íŒ©í„°ë¦¬ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°ë¥¼ ê³ ë ¤í•œë‹¤

**ì ˆì°¨**
- ìŠˆí¼í´ë˜ìŠ¤ì— ìƒì„±ìê°€ ì—†ë‹¤ë©´ í•˜ë‚˜ ì •ì˜í•œë‹¤. ì„œë¸Œí´ë˜ìŠ¤ì˜ ìƒì„±ìë“¤ì—ì„œ ì´ ìƒì„±ìê°€ í˜¸ì¶œë˜ëŠ”ì§€ í˜¹ì¸í•œë‹¤
- ë¬¸ì¥ ìŠ¬ë¼ì´ë“œí•˜ê¸°ë¡œ ê³µí†µ ë¬¸ì¥ ëª¨ë‘ë¥¼ super() í˜¸ì¶œ ì§í›„ë¡œ ì˜®ê¸´ë‹¤
- ê³µí†µ ì½”ë“œë¥¼ ìŠˆí¼í´ë˜ìŠ¤ì— ì¶”ê°€í•˜ê³  ì„œë¸Œí´ë˜ìŠ¤ë“¤ì—ì„œëŠ” ì œê±°í•œë‹¤
  - ìƒì„±ì ë§¤ê°œë³€ìˆ˜ ì¤‘ ê³µí†µ ì½”ë“œì—ì„œ ì°¸ì¡°í•˜ëŠ” ê°’ë“¤ì„ ëª¨ë‘ super()ë¡œ ê±´ë„¨ë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ìƒì„±ì ì‹œì‘ ë¶€ë¶„ìœ¼ë¡œ ì˜®ê¸¸ ìˆ˜ ì—†ëŠ” ê³µí†µ ì½”ë“œì—ëŠ” í•¨ìˆ˜ ì¶”ì¶œí•˜ê¸°ì™€ ë©”ì„œë“œ ì˜¬ë¦¬ê¸°ë¥¼ ì°¨ë¡€ë¡œ ì ìš©í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Party {
}

public class Employee extends Party {
  private final Long id;
  private final String name;
  private final int monthlyCost;

  public Employee(Long id, String name, int monthlyCost) {
    super();
    this.id = id;
    this.name = name;
    this.monthlyCost = monthlyCost;
  }
}

public class Department extends Party {
    private final String name;
    private final String staff;

    public Department(String name, String staff) {
        super();
        this.name = name;
        this.staff = staff;
    }
}


```
<br/>

**âœ¨after**
```java
public class Party {
    private final String name;

    protected Party(String name) {
        this.name = name;
    }
}

public class Employee extends Party {
  private final Long id;
  private final int monthlyCost;

  public Employee(Long id, String name, int monthlyCost) {
    super(name);
    this.id = id;
    this.monthlyCost = monthlyCost;
  }
  
  // ..
}

public class Department extends Party {
  private final String staff;

  public Department(String name, String staff) {
    super(name);
    this.staff = staff;
  }
    
  //.. 
}
```
- (ë‘ ë²ˆì§¸ ì˜ˆì‹œëŠ” ìƒëµ) ìƒì„±ìì—ì„œ ì¶”ê°€ ì‘ì—…í•˜ëŠ” ë‚´ìš©ì´ ì„œë¸Œ í´ë˜ìŠ¤ ê³µí†µìœ¼ë¡œ ìˆìœ¼ë©´ ìŠˆí¼ í´ë˜ìŠ¤ì— ì˜®ê¸¸ ìˆ˜ ìˆë‹¤ëŠ” ë‚´ìš©
<br/>


### 12.4 ë©”ì„œë“œ ë‚´ë¦¬ê¸°
- ì¹´íƒˆë¡œê·¸: [Push Down Method](https://refactoring.com/catalog/pushDownMethod.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§: [ë©”ì„œë“œ ì˜¬ë¦¬ê¸°](#121-ë©”ì„œë“œ-ì˜¬ë¦¬ê¸°)
- ì˜ˆì‹œ âŒ

<br/>

**ë°°ê²½**
- íŠ¹ì • ì„œë¸Œí´ë˜ìŠ¤ í•˜ë‚˜(í˜¹ì€ ì†Œìˆ˜)ì™€ë§Œ ê´€ë ¨ëœ ë©”ì„œë“œëŠ” ìŠˆí¼í´ë˜ìŠ¤ì—ì„œ ì œê±°í•˜ê³  í•´ë‹¹ ì„œë¸Œí´ë˜ìŠ¤(ë“¤)ì— ì¶”ê°€í•˜ëŠ” í¸ì´ ê¹”ë”í•˜ë‹¤
<br/>

**ì ˆì°¨**
- ëŒ€ìƒ ë©”ì„œë“œë¥¼ ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì— ë³µì‚¬í•œë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ì—ì„œ ê·¸ ë©”ì„œë“œë¥¼ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ì´ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Employee {
    public int quota { //.. }
}

class Engineer extends Employee {
  //..
}

class Salesperson extends Employee {
  //..
}
```
<br/>

**âœ¨after**
```java
public class Employee {
    //.. 
}

class Engineer extends Employee {
  //..
}

class Salesperson extends Employee {
  public int quota { //.. }
}
```
<br/>


### 12.5 í•„ë“œ ë‚´ë¦¬ê¸°
- ì¹´íƒˆë¡œê·¸: [Push Down Field](https://refactoring.com/catalog/pushDownField.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§: [í•„ë“œ ì˜¬ë¦¬ê¸°](#122-í•„ë“œ-ì˜¬ë¦¬ê¸°)
- ì˜ˆì‹œ âŒ

<br/>

**ë°°ê²½**
- ì„œë¸Œí´ë˜ìŠ¤ í•˜ë‚˜(í˜¹ì€ ì†Œìˆ˜)ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” í•„ë“œëŠ” í•´ë‹¹ ì„œë¸Œí´ë˜ìŠ¤(ë“¤)ë¡œ ì˜®ê¸´ë‹¤
<br/>

**ì ˆì°¨**
- ëŒ€ìƒ í•„ë“œë¥¼ ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì— ì •ì˜í•œë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ì—ì„œ ê·¸ í•„ë“œë¥¼ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ì´ í•„ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Employee {
    private String quota;
}

class Engineer extends Employee {
  //..
}

class Salesperson extends Employee { 
  //..
}
```
<br/>

**âœ¨after**
```java
public class Employee {
    
}

class Engineer extends Employee {
  //..
}

class Salesperson extends Employee {
  protected String quota;
}
```
<br/>


### 12.6 íƒ€ì… ì½”ë“œë¥¼ ì„œë¸Œí´ë˜ìŠ¤ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Type Code with Subclasses](https://refactoring.com/catalog/replaceTypeCodeWithSubclasses.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§: [ì„œë¸Œ í´ë˜ìŠ¤ ì œê±°í•˜ê¸°](#127-ì„œë¸Œí´ë˜ìŠ¤-ì œê±°í•˜ê¸°)
- í•˜ìœ„ ë¦¬íŒ©í„°ë§: íƒ€ì… ì½”ë“œë¥¼ ìƒíƒœ/ì „ëµ íŒ¨í„´ìœ¼ë¡œ ë°”ê¾¸ê¸°, ì„œë¸Œ í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex6)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex6)

<br/>

**ë°°ê²½**
- ì†Œí”„íŠ¸ì›¨ì–´ ì‹œìŠ¤í…œì—ì„œëŠ” ë¹„ìŠ·í•œ ëŒ€ìƒë“¤ì„ íŠ¹ì • íŠ¹ì„±ì— ë”°ë¼ êµ¬ë¶„í•´ì•¼ í•  ë•Œê°€ ìì£¼ ìˆë‹¤
  - ì˜ˆì»¨ëŒ€ ì§ì›ì„ `ë‹´ë‹¹ ì—…ë¬´(ì—”ì§€ë‹ˆì–´, ê´€ë¦¬ì, ì˜ì—…ì ë“±)`ë¡œ êµ¬ë¶„í•˜ê±°ë‚˜ ì£¼ë¬¸ì„ `ì‹œê¸‰ì„±(ê¸‰í•¨, ë³´í†µ ë“±)`ìœ¼ë¡œ êµ¬ë¶„í•˜ê¸°ë„ í•œë‹¤
- ì´ëŸ° ì¼ì„ ë‹¤ë£¨ëŠ” ìˆ˜ë‹¨ìœ¼ë¡œëŠ” **íƒ€ì… ì½”ë“œ í•„ë“œ**ê°€ ìˆë‹¤
  - í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì— ë”°ë¼ ì—´ê±°í˜•ì´ë‚˜ ì‹¬ë³¼, ë¬¸ìì—´, ìˆ«ì ë“±ìœ¼ë¡œ í‘œí˜„í•˜ë©°, ì™¸ë¶€ ì„œë¹„ìŠ¤ê°€ ì œê³µí•˜ëŠ” ë°ì´í„°ë¥¼ ë‹¤ë£¨ë ¤ í•  ë•Œ ë”¸ë ¤ì˜¤ëŠ” ì¼ì´ í”í•˜ë‹¤
- íƒ€ì… ì½”ë“œë§Œìœ¼ë¡œ ë¶€ì¡±í•´ ë¬´ì–¸ê°€ í•„ìš”í•  ë•Œ **ì„œë¸Œí´ë˜ìŠ¤**ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ëŠ” ë‘ ê°€ì§€ ë©´ì—ì„œ íŠ¹íˆ ë§¤ë ¥ì ì´ë‹¤
  - ì²«ì§¸, ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ë„ë¡ í•´ì£¼ëŠ” ë‹¤í˜•ì„±ì„ ì œê³µí•œë‹¤
  - ë‘˜ì§¸, íŠ¹ì • íƒ€ì…ì—ì„œë§Œ ì˜ë¯¸ê°€ ìˆëŠ” ê°’ì„ ì‚¬ìš©í•˜ëŠ” í•„ë“œë‚˜ ë©”ì„œë“œê°€ ìˆì„ ë•Œ ë°œí˜„ëœë‹¤
<br/>

**ì ˆì°¨**
- íƒ€ì… ì½”ë“œ í•„ë“œë¥¼ ìê°€ ìº¡ìŠí™”í•œë‹¤
- íƒ€ì… ì½”ë“œ ê°’ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ ê·¸ ê°’ì— í•´ë‹¹í•˜ëŠ” ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤
  - íƒ€ì… ì½”ë“œ ê²Œí„° ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ í•´ë‹¹ íƒ€ì… ì½”ë“œì˜ ë¦¬í„°ëŸ´ ê°’ì„ ë°˜í™˜í•˜ê²Œ í•œë‹¤
- ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ì€ íƒ€ì… ì½”ë“œì™€ ë°©ê¸ˆ ë§Œë“  ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ë§¤í•‘í•˜ëŠ” ì„ íƒ ë¡œì§ì„ ë§Œë“ ë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- íƒ€ì… ì½”ë“œ ê°’ ê°ê°ì— ëŒ€í•´ ì„œë¸Œí´ë˜ìŠ¤ ìƒì„±ê³¼ ì„ íƒ ë¡œì§ ì¶”ê°€ë¥¼ ë°˜ë³µí•œë‹¤
  - í´ë˜ìŠ¤ í•˜ë‚˜ê°€ ì™„ì„±ë ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤
- íƒ€ì… ì½”ë“œ í•„ë“œë¥¼ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- íƒ€ì… ì½”ë“œ ì ‘ê·¼ìë¥¼ ì´ìš©í•˜ëŠ” ë©”ì„œë“œ ëª¨ë‘ì— ë©”ì„œë“œ ë‚´ë¦¬ê¸°ì™€ ì¡°ê±´ë¶€ ë¡œì§ì„ ë‹¤í˜•ì„±ìœ¼ë¡œ ë°”ê¾¸ê¸°ë¥¼ ì ìš©í•œë‹¤ 
<br/>

**ğŸ’©before**
```java
public class Employee {
  private static final Set<String> types = Set.of("engineer", "manager", "salesperson");

  private final String name;
  private final String type;

  public Employee(String name, String type) {
    validateType(type);
    this.name = name;
    this.type = type;
  }

  public void validateType(String type) {
    if (!types.contains(type)) {
      throw new IllegalArgumentException(type + "ë¼ëŠ” ì§ì› ìœ í˜•ì€ ì—†ìŠµë‹ˆë‹¤.");
    }
  }
}
```
<br/>

**âœ¨after**
```java
public class Employee {
  private final String name;

  public Employee(String name) {
    this.name = name;
  }

  public static Employee of(String name, String type) {
    return switch (type) {
      case "engineer" -> new Engineer(name);
      case "manager" -> new Manager(name);
      case "salesperson" -> new Salesperson(name);
      default -> throw new IllegalArgumentException(type + "ë¼ëŠ” ì§ì› ìœ í˜•ì€ ì—†ìŠµë‹ˆë‹¤");
    };
  }
  
  // .. 
}

public class Salesperson extends Employee {
  public Salesperson(String name) {
    super(name);
  }
}

// ì´í•˜ ìƒëµ
```
<br/>

ë‘ë²ˆì§¸ ì˜ˆì‹œ
```java
public class Employee2 {
  private static final Set<String> types = Set.of("engineer", "manager", "salesperson");

  private final String name;
  private final String type;

  public Employee2(String name, String type) {
    validateType(type);
    this.name = name;
    this.type = type;
  }

  public void validateType(String type) {
    if (!types.contains(type)) {
      throw new IllegalArgumentException(type + "ë¼ëŠ” ì§ì› ìœ í˜•ì€ ì—†ìŠµë‹ˆë‹¤.");
    }
  }

  public String capitalizedType() {
    char first = type.charAt(0);
    return Character.toUpperCase(first) + type.substring(1).toLowerCase();
  }

  public String toString() {
    return String.format("%s (%s)", this.name, this.type);
  }
}
```

ìƒì„±ìì—ì„œëŠ” `this.type = type` ì„ ì–¸í•˜ê³  getter/setter ì—ì„œëŠ” `this._type`ì„ ì‚¬ìš©í•´ì„œ í˜¼ë€ì´ ì™”ëŠ”ë° 
- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ `this.type = type`ë¥¼ ì„ ì–¸í•˜ë©´ `set type(...)` í˜¸ì¶œë˜ëŠ” ê²ƒê³¼ ê°™ë‹¤í•¨
- `this._type`ì€ ë‚´ë¶€ í•„ë“œì´ê³ , `this.type`ì€ getter í˜¸ì¶œë˜ëŠ” ê²ƒê³¼ ê°™ë‹¤í•¨

ê²°êµ­ ê°’ ê°ì²´ë¡œ í¬ì¥í•´ì„œ ê°€ì§€ë‚˜ë³´ë‹¤

```java
public class Employee2 {
  private final String name;
  private final EmployeeType employeeType;

  public Employee2(String name, String type) {
    this(name, createEmployeeType(type));
  }

  public Employee2(String name, EmployeeType employeeType) {
    this.name = name;
    this.employeeType = employeeType;
  }

  public static EmployeeType createEmployeeType(String type) {
    return switch (type) {
      case "engineer" -> new Engineer();
      case "manager" -> new Manager();
      case "salesperson" -> new Salesperson();
      default -> throw new IllegalArgumentException("Invalid type " + type);
    };
  }

  public String capitalizedType() {
    char first = this.typeString().charAt(0);
    return Character.toUpperCase(first) + this.typeString().substring(1).toLowerCase();
  }

  public String toString() {
    return String.format("%s (%s)", this.name, this.typeString());
  }

  public EmployeeType getType() {
    return employeeType;
  }

  public String typeString() {
    return employeeType.toString();
  }
  
  // equals, hashCode
}


public abstract class EmployeeType {
  @Override
  public boolean equals(Object obj) {
    return obj != null && this.getClass() == obj.getClass();
  }

  @Override
  public int hashCode() {
    return getClass().hashCode();
  }
}


public class Manager extends EmployeeType {
  @Override
  public String toString() {
    return "manager";
  }
}

// ì´í•˜ ìƒëµ
```


### 12.7 ì„œë¸Œí´ë˜ìŠ¤ ì œê±°í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Remove Subclass](https://refactoring.com/catalog/removeSubclass.html)
- ë°˜ëŒ€ ë¦¬íŒ©í„°ë§: [íƒ€ì… ì½”ë“œë¥¼ ì„œë¸Œ í´ë˜ìŠ¤ë¡œ ë°”ê¾¸ê¸°](#126-íƒ€ì…-ì½”ë“œë¥¼-ì„œë¸Œí´ë˜ìŠ¤ë¡œ-ë°”ê¾¸ê¸°)
- 1íŒì—ì„œì˜ ì´ë¦„: í•˜ìœ„í´ë˜ìŠ¤ë¥¼ í•„ë“œë¡œ ì „í™˜
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex7)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex7)

<br/>

**ë°°ê²½**
- ì„œë¸Œí´ë˜ì‹±ì€ ì›ë˜ ë°ì´í„° êµ¬ì¡°ì™€ëŠ” ë‹¤ë¥¸ ë³€ì¢…ì„ ë§Œë“¤ê±°ë‚˜ ì¢…ë¥˜ì— ë”°ë¼ ë™ì‘ì´ ë‹¬ë¼ì§€ê²Œ í•  ìˆ˜ ìˆëŠ” ìœ ìš©í•œ ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤
- í•˜ì§€ë§Œ ì†Œí”„íŠ¸ì›¨ì–´ ì‹œìŠ¤í…œì´ ì„±ì¥í•¨ì— ë”°ë¼ ì„œë¸Œí´ë˜ìŠ¤ë¡œ ë§Œë“  ë³€ì¢…ì´ ë‹¤ë¥¸ ëª¨ë“ˆë¡œ ì´ë™í•˜ê±°ë‚˜ ì™„ì „íˆ ì‚¬ë¼ì§€ê¸°ë„ í•˜ë©´ì„œ ê°€ì¹˜ê°€ ë°”ë˜ê¸°ë„ í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ëŠ” ê²°êµ­ í•œ ë²ˆë„ í™œìš©ë˜ì§€ ì•Šê¸°ë„ í•˜ë©°, ë•Œë¡  ì„œë¸Œí´ë˜ìŠ¤ë¥¼ í•„ìš”ë¡œ í•˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê¸°ëŠ¥ì—ì„œë§Œ ì“°ì´ê¸°ë„ í•œë‹¤
<br/>

**ì ˆì°¨**
- ì„œë¸Œí´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ íŒ©í„°ë¦¬ í•¨ìˆ˜ë¡œ ë°”ê¾¼ë‹¤
  - ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ëŠ” ì¸¡ì—ì„œ ë°ì´í„° í•„ë“œë¥¼ ì´ìš©í•´ ì–´ë–¤ ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìƒì„±í• ì§€ ê²°ì •í•œë‹¤ë©´ ë¡œì§ì„ ìŠˆí¼í´ë˜ìŠ¤ì˜ íŒ©í„°ë¦¬ ë©”ì„œë“œì— ë„£ëŠ”ë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ê²€ì‚¬í•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ ê·¸ ê²€ì‚¬ ì½”ë“œì— í•¨ìˆ˜ ì¶”ì¶œí•˜ê¸°ì™€ í•¨ìˆ˜ ì˜®ê¸°ê¸°ë¥¼ ì°¨ë¡€ë¡œ ì ìš©í•˜ì—¬ ìŠˆí¼í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤
  - í•˜ë‚˜ ë³€ê²½í•  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ì˜ íƒ€ì…ì„ ë‚˜íƒ€ë‚´ëŠ” í•„ë“œë¥¼ ìŠˆí¼í´ë˜ìŠ¤ì— ë§Œë“ ë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” ë©”ì„œë“œê°€ ë°©ê¸ˆ ë§Œë“  íƒ€ì… í•„ë“œë¥¼ ì´ìš©í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ì§€ìš´ë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Person {
  private final String name;

  public Person(String name) {
    this.name = name;
  }

  public String genderCode() {
    return "X";
  }
}


public class Male extends Person {
  public Male(String name) {
    super(name);
  }

  @Override
  public String genderCode() {
    return "M";
  }
}

public class Female extends Person {
  public Female(String name) {
    super(name);
  }

  @Override
  public String genderCode() {
    return "F";
  }
}

```
<br/>

ë¬´ì–¸ê°€ì˜ í‘œí˜„ ë°©ë²•ì„ ë°”ê¾¸ë ¤ í•  ë•Œë©´ ë¨¼ì € í˜„ì¬ì˜ í‘œí˜„ì„ ìº¡ìŠí™”í•˜ì—¬ ì´ ë³€í™”ê°€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ì£¼ëŠ” ì˜í–¥ì„ ìµœì†Œí™”í•œë‹¤


**âœ¨after**
```java
public class Person {
  private final String name;
  private final String genderCode;

  public Person(String name, String genderCode) {
    this.name = name;
    this.genderCode = StringUtils.hasLength(genderCode) ? genderCode : "X";
  }

  public static Person from(String name, String gender) {
    return switch (gender) {
      case "M" -> new Male(name, "M");
      case "F" -> new Female(name, "F");
      default -> new Person(name, "X");
    };
  }

  public static List<Person> loadFromInput(String[][] data) {
    return Stream.of(data).map(aRecord -> from(aRecord[0], aRecord[1])).toList();
  }

  public String genderCode() {
    return this.genderCode;
  }

  public boolean isMale() {
    return this.genderCode.equals("M");
  }
  
  // equals, hashCode
}

public class Male extends Person {
  public Male(String name, String genderCode) {
    super(name, genderCode);
  }
}
```
<br/>


### 12.8 ìŠˆí¼í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Extract Superclass](https://refactoring.com/catalog/extractSuperclass.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex8)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex8)

<br/>

**ë°°ê²½**
- ë¹„ìŠ·í•œ ì¼ì„ ìˆ˜í–‰í•˜ëŠ” ë‘ í´ë˜ìŠ¤ê°€ ë³´ì´ë©´ ìƒì† ë§¤ì»¤ë‹ˆì¦˜ì„ ì´ìš©í•´ì„œ ë¹„ìŠ·í•œ ë¶€ë¶„ì„ ê³µí†µì˜ ìŠˆí¼í´ë˜ìŠ¤ë¡œ ì˜®ê²¨ ë‹´ì„ ìˆ˜ ìˆë‹¤
- ê³µí†µëœ ë¶€ë¶„ì´ ë°ì´í„°ë¼ë©´ í•„ë“œ ì˜¬ë¦¬ê¸°ë¥¼ í™œìš©í•˜ê³  ë™ì‘ì´ë¼ë©´ ë©”ì„œë“œ ì˜¬ë¦¬ê¸°ë¥¼ í™œìš©í•˜ë©´ ëœë‹¤
- ì €ìëŠ” `ìƒì†ì€ í”„ë¡œê·¸ë¨ì´ ì„±ì¥í•˜ë©´ì„œ ê¹¨ìš°ì³ê°€ê²Œ ë˜ë©°, ìŠˆí¼í´ë˜ìŠ¤ë¡œ ëŒì–´ì˜¬ë¦¬ê³  ì‹¶ì€ ê³µí†µ ìš”ì†Œë¥¼ ì°¾ì•˜ì„ ë•Œ ìˆ˜í–‰í•˜ëŠ” ì‚¬ë¡€ê°€ ì¦ì•˜ë‹¤`ê³  ë§í•œë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸° ëŒ€ì•ˆìœ¼ë¡œëŠ” í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°ê°€ ìˆë‹¤
- ì–´ëŠ ê²ƒì„ ì„ íƒí•˜ëŠëƒëŠ” ì¤‘ë³µ ë™ì‘ì„ ìƒì†ìœ¼ë¡œ í•´ê²°í•˜ëŠëƒ ìœ„ì„ìœ¼ë¡œ í•´ê²°í•˜ëŠëƒì— ë‹¬ë ¸ë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸° ë°©ë²•ì´ ë” ê°„ë‹¨í•  ê²½ìš°ê°€ ë§ìœ¼ë‹ˆ ì´ ë¦¬íŒ©í„°ë§ì„ ë¨¼ì € ì‹œë„í•´ë³´ê¸¸ ê¶Œí•œë‹¤
  - ë‚˜ì¤‘ì—ë¼ë„ í•„ìš”í•´ì§€ë©´ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ê¸°(12.11)ëŠ” ì–´ë µì§€ ì•Šë‹¤
<br/>

**ì ˆì°¨**
- ë¹ˆ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤. ì›ë˜ì˜ í´ë˜ìŠ¤ë“¤ì´ ìƒˆ í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ë„ë¡ í•œë‹¤
  - í•„ìš”í•˜ë‹¤ë©´ ìƒì„±ìì— í•¨ìˆ˜ ì„ ì–¸ ë°”ê¾¸ê¸°ë¥¼ ì ìš©í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤ 
- ìƒì„±ì ë³¸ë¬¸ ì˜¬ë¦¬ê¸°, ë©”ì„œë“œ ì˜¬ë¦¬ê¸°, í•„ë“œ ì˜¬ë¦¬ê¸°ë¥¼ ì°¨ë¡€ë¡œ ì ìš©í•˜ì—¬ ê³µí†µ ì›ì†Œë¥¼ í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ì— ë‚¨ì€ ë©”ì„œë“œë“¤ì„ ê²€í† í•œë‹¤. ê³µí†µë˜ëŠ” ë¶€ë¶„ì´ ìˆë‹¤ë©´ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•œ ë‹¤ìŒ ë©”ì„œë“œ ì˜¬ë¦¬ê¸°ë¥¼ ì ìš©í•œë‹¤
- ì›ë˜ í´ë˜ìŠ¤ë“¤ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ê²€í† í•˜ì—¬ ìŠˆí¼í´ë˜ìŠ¤ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ í• ì§€ ê³ ë¯¼í•´ë³¸ë‹¤
<br/>

**ğŸ’©before**
```java
public class Employee {
  private final Long id;
  private final String name;
  private final int monthlyCost;

  public Employee(Long id, String name, int monthlyCost) {
    this.id = id;
    this.name = name;
    this.monthlyCost = monthlyCost; // ì›”ê°„ ë¹„ìš©
  }

  public long annualCost() { // ì—°ê°„ë¹„ìš©
    return this.monthlyCost * 12L;
  }

  public Long getId() {
    return id;
  }

  public String getName() {
    return name;
  }

  public int getMonthlyCost() {
    return monthlyCost;
  }
}


public class Department {
  private final String name;
  private final List<Integer> staff;

  public Department(String name, List<Integer> staff) {
    this.name = name;
    this.staff = new ArrayList<>(staff);
  }

  public long totalMonthlyCost() {
    return this.staff.stream().reduce(0, (sum, cost) -> sum + cost);
  }

  public int headCount() {
    return this.staff.size();
  }

  public long totalAnnualCost() {
    return this.totalMonthlyCost() * 12;
  }

  public String getName() {
    return name;
  }

  public List<Integer> getStaff() {
    return Collections.unmodifiableList(staff);
  }
}
```
<br/>

**âœ¨after**
```java
public abstract class Party {
  protected final String name;

  protected Party(String name) {
    this.name = name;
  }

  public String getName() {
    return name;
  }

  public long annualCost() {
    return monthlyCost() * 12L;
  }

  abstract long monthlyCost();
}


public class Employee extends Party {
  private final Long id;
  private final int monthlyCost;

  public Employee(Long id, String name, int monthlyCost) {
    super(name);
    this.id = id;
    this.monthlyCost = monthlyCost;
  }

  @Override
  public long monthlyCost() {
    return monthlyCost;
  }
}


public class Department extends Party {
  private final List<Integer> staff;

  public Department(String name, List<Integer> staff) {
    super(name);
    this.staff = new ArrayList<>(staff);
  }

  @Override
  public long monthlyCost() {
    return this.staff.stream().reduce(0, (sum, cost) -> sum + cost);
  }

  public int headCount() {
    return this.staff.size();
  }

  public List<Integer> getStaff() {
    return Collections.unmodifiableList(staff);
  }
}
```
<br/>


### 12.9 ê³„ì¸µ í•©ì¹˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Collapse Hierarchy](https://refactoring.com/catalog/collapseHierarchy.html)
- ì˜ˆì‹œ âŒ

<br/>

**ë°°ê²½**
- ì˜ˆì»¨ëŒ€ ê³„ì¸µêµ¬ì¡°ë„ ì§„í™”í•˜ë©´ì„œ ì–´ë–¤ í´ë˜ìŠ¤ì™€ ê·¸ ë¶€ëª¨ê°€ ë„ˆë¬´ ë¹„ìŠ·í•´ì ¸ì„œ ë”ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì¡´ì¬í•´ì•¼ í•  ì´ìœ ê°€ ì‚¬ë¼ì§€ëŠ” ê²½ìš°ê°€ ìƒê¸°ê¸°ë„ í•œë‹¤
<br/>

**ì ˆì°¨**
- ë‘ í´ë˜ìŠ¤ ì¤‘ ì œê±°í•  ê²ƒì„ ê³ ë¥¸ë‹¤
  - ë¯¸ë˜ë¥¼ ìƒê°í•˜ì—¬ ë” ì í•©í•œ ì´ë¦„ì˜ í´ë˜ìŠ¤ë¥¼ ë‚¨ê¸°ì
  - ë‘˜ ë‹¤ ì ì ˆíˆ ì•Šë‹¤ë©´ ì„ì˜ë¡œ í•˜ë‚˜ë¥¼ ê³ ë¥¸ë‹¤
- í•„ë“œ ì˜¬ë¦¬ê¸°ì™€ ë©”ì„œë“œ ì˜¬ë¦¬ê¸° í˜¹ì€ í•„ë“œ ë‚´ë¦¬ê¸°ì™€ ë©”ì„œë“œ ë‚´ë¦¬ê¸°ë¥¼ ì ìš©í•˜ì—¬ ëª¨ë“  ìš”ì†Œë¥¼ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤
- ì œê±°í•  í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ë˜ ëª¨ë“  ì½”ë“œê°€ ë‚¨ê²¨ì§ˆ í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ë„ë¡ ê³ ì¹œë‹¤
- ë¹ˆ í´ë˜ìŠ¤ë¥¼ ì œê±°í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
<br/>

**ğŸ’©before**
```java
class Employee {...}

class Salesperson extends Employee {..}
```
<br/>

**âœ¨after**
```java
class Employee {...}
```
<br/>


### 12.10 ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Subclass with Delegate](https://refactoring.com/catalog/replaceSubclassWithDelegate.html)
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex10)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex10)

<br/>

**ë°°ê²½**
- ì†í•œ ê°ˆë˜ì— ë”°ë¼ ë™ì‘ì´ ë‹¬ë¼ì§€ëŠ” ê°ì²´ë“¤ì„ **ìƒì†**ìœ¼ë¡œ í‘œí˜„í•˜ëŠ” ê²Œ ìì—°ìŠ¤ëŸ½ë‹¤
- ê³µí†µ ë°ì´í„°ì™€ ë™ì‘ì€ ëª¨ë‘ ìŠˆí¼í´ë˜ìŠ¤ì— ë‘ê³  ì„œë¸Œí´ë˜ìŠ¤ëŠ” ìì‹ ì— ë§ê²Œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì˜¤ë²„ë¼ì´ë“œí•˜ë©´ ëœë‹¤
- í•˜ì§€ë§Œ ìƒì†ì—ëŠ” ë‹¨ì ì´ ìˆë‹¤
  - ê°€ì¥ ëª…í™•í•œ ë‹¨ì ì€ í•œ ë²ˆë§Œ ì“¸ ìˆ˜ ìˆëŠ” ì¹´ë“œë¼ëŠ” ê²ƒì´ë‹¤
  - ë˜ ë‹¤ë¥¸ ë¬¸ì œëŠ” ìƒì†ì€ í´ë˜ìŠ¤ë“¤ì˜ ê´€ê³„ë¥¼ ì•„ì£¼ ê¸´ë°€í•˜ê²Œ ê²°í•©í•œë‹¤ (ì»¤í”Œë§, ë¶€ëª¨ ë©”ì„œë“œë¥¼ ìì‹ì´ ë‹¤ ì•„ë‹ˆ ìº¡ìŠí™”ë¥¼ ê¹¨ë²„ë¦¬ê¸°ë„ ì‰½ë‹¤)
    - ë¶€ëª¨ë¥¼ ìˆ˜ì •í•˜ë©´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ìì‹ë“¤ì˜ ê¸°ëŠ¥ì„ í•´ì¹˜ê¸°ê°€ ì‰½ê¸° ë•Œë¬¸ì— ê°ë³„íˆ ì£¼ì˜í•´ì•¼ í•œë‹¤
    - ê·¸ë˜ì„œ ìì‹ë“¤ì´ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ì–´ë–»ê²Œ ìƒì†í•´ ì“°ëŠ”ì§€ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤
- `ìœ„ì„(delegate)`ì€ ì´ìƒì˜ ë‘ ë¬¸ì œë¥¼ ëª¨ë‘ í•´ê²°í•´ì¤€ë‹¤ 
  - ì¦‰, ìƒì†ë³´ë‹¤ ê²°í•©ë„ê°€ í›¨ì”¬ ì•½í•œë‹¤
- ìœ ëª…í•œ ì›ì¹™ ì¤‘ í•˜ë‚˜ê°€ ìˆë‹¤
  - `'(í´ë˜ìŠ¤) ìƒì† ë³´ë‹¤ëŠ” (ê°ì²´) ì»´í¬ì§€ì…˜ì„ ì‚¬ìš©í•˜ë¼'`
  - ì—¬ê¸°ì„œ ì»´í¬ì§€ì…˜(composition)ì€ ì‚¬ì‹¤ìƒ ìœ„ì„ê³¼ ê°™ì€ ë§ì´ë‹¤
  - ìœ„ì„ì„ ì•Œê³  ìˆë‹¤ë©´ ì²˜ìŒì— ìƒì†ìœ¼ë¡œ ì ‘ê·¼í•œ ë‹¤ìŒ, ë¬¸ì œê°€ ìƒê¸°ë©´ ìœ„ì„ìœ¼ë¡œ ê°ˆì•„íƒ„ë‹¤
- ë””ìì¸íŒ¨í„´ ì±…ì€ ìƒì†ê³¼ ì»´í¬ì§€ì…˜ì„ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•´ì¤€ë‹¤
  - ì´ ì›ì¹™ì€ ìƒì†ì„ ì“°ì§€ ë§ë¼ëŠ” ê²Œ ì•„ë‹ˆë¼, ê³¼ìš©í•˜ëŠ” ë° ë”°ë¥¸ ë°˜ì‘ìš©ìœ¼ë¡œ ë‚˜ì˜¨ ê²ƒì´ë‹¤
  - ë””ìì¸íŒ¨í„´ì— ìµìˆ™í•˜ë‹¤ë©´ ì´ ë¦¬íŒ©í„°ë§ì„ 'ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìƒíƒœ íŒ¨í„´'ì´ë‚˜ 'ì „ëµ íŒ¨í„´'ìœ¼ë¡œ ëŒ€ì²´í•œë‹¤ê³  ìƒê°í•˜ë©´ ë„ì›€ì´ ëœë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ëŠ” ëª¨ë“  ê²½ìš°ì—ì„œ ìœ„ì„ì„ ê³„ì¸µêµ¬ì¡°ë¡œ ì„¤ê³„í•´ì•¼ í•˜ëŠ” ê±´ ì•„ë‹ˆë‹¤
  - í•˜ì§€ë§Œ ìƒíƒœë‚˜ ì „ëµì— ê³„ì¸µêµ¬ì¡°ë¥¼ ì ìš©í•˜ë©´ ìœ ìš©í•  ë•Œê°€ ë§ë‹¤
<br/>

**ì ˆì°¨**
- ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ëŠ” ê³³ì´ ë§ë‹¤ë©´ ìƒì„±ìë¥¼ íŒ©í„°ë¦¬ í•¨ìˆ˜ë¡œ ë°”ê¾¼ë‹¤
- ìœ„ì„ìœ¼ë¡œ í™œìš©í•  ë¹ˆ í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤
  - ì´ í´ë˜ìŠ¤ì˜ ìƒì„±ìëŠ” ì„œë¸Œí´ë˜ìŠ¤ì— íŠ¹í™”ëœ ë°ì´í„°ë¥¼ ì „ë¶€ ë°›ì•„ì•¼ í•˜ë©°, ë³´í†µì€ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì—­ì°¸ì¡°ë„ í•„ìš”í•˜ë‹¤
- ìœ„ì„ì„ ì €ì¥í•  í•„ë“œë¥¼ ìŠˆí¼í´ë˜ìŠ¤ì— ì¶”ê°€í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ ìƒì„± ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ìœ„ì„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìœ„ì„ í•„ë“œì— ëŒ€ì…í•´ ì´ˆê¸°í™”í•œë‹¤
  - ì´ ì‘ì—…ì€ íŒ©í„°ë¦¬ í•¨ìˆ˜ê°€ ìˆ˜í–‰í•œë‹¤
  - í˜¹ì€ ìƒì„±ìê°€ ì •í™•í•œ ìœ„ì„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ”ê²Œ í™•ì‹¤í•˜ë‹¤ë©´ ìƒì„±ìì—ì„œ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ì˜ ë©”ì„œë“œ ì¤‘ ìœ„ì„ í´ë˜ìŠ¤ë¡œ ì´ë™í•  ê²ƒì„ ê³ ë¥¸ë‹¤
- í•¨ìˆ˜ ì˜®ê¸°ê¸°ë¥¼ ì ìš©í•´ ìœ„ì„ í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤
  - ì›ë˜ ë©”ì„œë“œì—ì„œ ìœ„ì„í•˜ëŠ” ì½”ë“œëŠ” ì§€ìš°ì§€ ì•ŠëŠ”ë‹¤
  - ì´ ë©”ì„œë“œê°€ ì‚¬ìš©í•˜ëŠ” ì›ì†Œ ì¤‘ ìœ„ì„ìœ¼ë¡œ ì˜®ê²¨ì•¼ í•˜ëŠ”ê²Œ ìˆë‹¤ë©´ í•¨ê»˜ ì˜®ê¸´ë‹¤
  - ìŠˆí¼í´ë˜ìŠ¤ì— ìœ ì§€í•´ì•¼ í•  ì›ì†Œë¥¼ ì°¸ì¡°í•œë‹¤ë©´ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” í•„ë“œë¥¼ ìœ„ì„ì— ì¶”ê°€í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ ì™¸ë¶€ì—ë„ ì›ë˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ ì„œë¸Œí´ë˜ìŠ¤ì˜ ìœ„ì„ ì½”ë“œë¥¼ ìŠˆí¼í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤
  - ì´ë•Œ ìœ„ì„ì´ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë³´í˜¸ ì½”ë“œë¡œ ê°ì‹¸ì•¼ í•œë‹¤
  - í˜¸ì¶œí•˜ëŠ” ì™¸ë¶€ ì½”ë“œê°€ ì—†ë‹¤ë©´ ì›ë˜ ë©”ì„œë“œëŠ” ì£½ì€ ì½”ë“œê°€ ë˜ë¯€ë¡œ ì œê±°í•œë‹¤ 
  - ì„œë¸Œí´ë˜ìŠ¤ê°€ ë‘˜ ì´ìƒì´ê³  ì„œë¸Œí´ë˜ìŠ¤ë“¤ì—ì„œ ì¤‘ë³µì´ ìƒê²¨ë‚˜ê¸° ì‹œì‘í–ˆë”°ë©´ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ì¶”ì¶œí•œë‹¤
  - ì´ë ‡ê²Œ í•˜ì—¬ ê¸°ë³¸ ë™ì‘ì´ ìœ„ì„ ìŠˆí¼í´ë˜ìŠ¤ë¡œ ì˜®ê²¨ì¡Œë‹¤ë©´ ìŠˆí¼í´ë˜ìŠ¤ì˜ ìœ„ì„ ë©”ì„œë“œë“¤ì—ëŠ” ë³´í˜¸ì½”ë“œê°€ í•„ìš”ì—†ë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ì˜ ëª¨ë“  ë©”ì„œë“œê°€ ì˜®ê²¨ì§ˆ ë•Œê¹Œì§€ (5~8) ê³¼ì •ì„ ë°˜ë³µí•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ë“¤ì˜ ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œë¥¼ ì°¾ì•„ì„œ ìŠˆí¼í´ë˜ìŠ¤ì˜ ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤
- í…ŒìŠ¤íŠ¸í•œë‹¤
- ì„œë¸Œí´ë˜ìŠ¤ë¥´ ì‚­ì œí•œë‹¤ (ì£½ì€ ì½”ë“œ ì œê±°í•˜ê¸°)
<br/>

**ğŸ’©before** <br/>
ì˜ˆì‹œ1. ì„œë¸Œí´ë˜ìŠ¤ê°€ í•˜ë‚˜ ì¼ë•Œ
```java
public class Booking {
    protected final Show show;
    protected final LocalDate date;
    protected final boolean peakDay; // í•¨ìˆ˜ ë‚´ìš©ì—†ì–´ì„œ ìƒì„±ì ì£¼ì… ë°›ë„ë¡ ë³€ê²½, ìº¡ìŠí™”ê°€ í•„ìš”í•˜ë©´ ì „ëµ íŒ¨í„´ ê³ ë ¤ê°€ëŠ¥

    protected Booking(Show show, LocalDate date, boolean peakDay) {
        this.show = show;
        this.date = date;
        this.peakDay = peakDay;
    }

    // ì¼ë°˜ ì˜ˆì•½ì€ ê³µì—° í›„ ê´€ê°ê³¼ì˜ ëŒ€í™”ì‹œê°„(talkback)ì„ ì„±ìˆ˜ê¸°ê°€ ì•„ë‹ ë•Œë§Œ ì œê³µí•œë‹¤
    public boolean hasTalkback() {
        return this.show.isTalkback() && !peakDay;
    }

    public long basePrice() {
        long result = this.show.price();
        if (peakDay) {
            result += Math.round(result * 0.15);
        }
        return result;
    }
}


public class Show {
  private final long price;
  private final boolean talkback; // ë§ˆì°¬ê°€ì§€ hasOwnPropertyëŠ” JSì—ì„œë§Œ ì§€ì›í•´ì„œ ë©¤ë²„ í•„ë“œ ì„ ì–¸

  public Show(long price, boolean talkback) {
    this.price = price;
    this.talkback = talkback;
  }

  public long price() {
    return this.price;
  }

  public boolean isTalkback() {
    return this.talkback;
  }
}


public class PremiumBooking extends Booking {
  private final Extras extras; // ì¶”ê°€ ë¹„ìš©

  public PremiumBooking(Show show, LocalDate date, boolean peakDay, Extras extras) {
    super(show, date, peakDay);
    this.extras = extras;
  }

  // í”„ë¦¬ë¯¸ì—„ ì˜ˆì•½ì€ í•­ìƒ ê´€ê°ê³¼ì˜ ëŒ€í™” ì‹œê°„ì„ ë§ˆë ¨í•œë‹¤
  @Override
  public boolean hasTalkback() {
    return this.show.isTalkback();
  }

  @Override
  public long basePrice() {
    return Math.round(super.basePrice() + this.extras.premiumFee());
  }
}


public class Extras {

  private final long premiumFee;
  private final boolean dinner; // ë§ˆì°¬ê°€ì§€ë¡œ ë©¤ë²„ í•„ë“œ ì„ ì–¸

  public Extras(long premiumFee, boolean dinner) {
    this.premiumFee = premiumFee;
    this.dinner = dinner;
  }

  public long premiumFee() {
    return this.premiumFee;
  }

  public boolean hasDinner() {
    return this.dinner;
  }
}
```
<br/>

ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ë ¤í• ê¹Œ?
- **ìƒì†ì€ í•œ ë²ˆë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë„êµ¬ë‹¤**
- ë”°ë¼ì„œ ìƒì†ì„ ì‚¬ìš©í•´ì•¼ í•  ë‹¤ë¥¸ ì´ìœ ê°€ ìƒê¸´ë‹¤ë©´, ê·¸ë¦¬ê³  ê·¸ ì´ìœ ê°€ í”„ë¦¬ë¯¸ì—„ ì˜ˆì•½ ì„œë¸Œí´ë˜ìŠ¤ë³´ë‹¤ ê°€ì¹˜ê°€ í¬ë‹¤ê³  ìƒê°ëœë‹¤ë©´ í”„ë¦¬ë¯¸ì—„ ì˜ˆì•½ì„ (ìƒì†ì´ ì•„ë‹Œ) ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ í‘œí˜„í•´ì•¼ í•  ê²ƒì´ë‹¤.
- ë˜í•œ, ê¸°ë³¸ ì˜ˆì•½ì—ì„œ í”„ë¦¬ë¯¸ì—„ ì˜ˆì•½ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ì „í™˜í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤.


```java
public class PremiumDelegate {
  private final Booking host;
  private final Extras extras;

  public premiumDelegate(Booking host, Extras extras) {
    this.host = host;
    this.extras = extras;
  }
}

```
<br/>

 
```javascript
_bePremium(extras) {
  this._premiumDelegate = new premiumDelegate(this, extras);
}
```
- ì—¬ê¸°ì„œ `_bePremium`ì€ ê³µê°œ(public) ë©”ì„œë“œì§€ë§Œ, ì•ì— ì–¸ë”ë°” `_` ë¥¼ ë¶™ì—¬ì„œ "ì´ê±´ ë‚´ë¶€ì—ì„œë§Œ ì¨ì•¼ í•´ìš”!"ë¼ëŠ” ê´€ë¡€ì ì¸ ì‹ í˜¸ë¥¼ ì£¼ëŠ” ê±°ì˜ˆìš”.
- ì¦‰, í”„ë¼ì´ë¹—ì€ ì•„ë‹ˆì§€ë§Œ, í”„ë¼ì´ë¹—ì²˜ëŸ¼ ì¨ì£¼ì„¸ìš”~ ë¼ëŠ” ëœ»ì´ì—ìš”.
- ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ì§„ì§œ private í‚¤ì›Œë“œê°€ ì—†ë˜ ì‹œì ˆì´ ê¸¸ì—ˆê¸° ë•Œë¬¸ì— `_`ë¡œ êµ¬ë¶„í•˜ëŠ” ê´€ë¡€ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ <u>ìë°”ì—ì„œëŠ” ì ‘ê·¼ ì œì–´ìê°€ ëª…ì‹œì ì´ê¸° ë•Œë¬¸ì— ë” ëª…í™•í•˜ê²Œ í•´ì•¼ í•´ìš”.</u>


PremiumBookingì˜ hasTalkback()ë¥¼ ìœ„ì„í•œë‹¤
```java
public class Booking {
  protected final Show show;
  protected final LocalDate date;
  protected final boolean peakDay;

  protected PremiumDelegate premiumDelegate; // ì ‘ê·¼ ì œì–´ìë¥¼ protectedë¡œ ë³€ê²½

  protected Booking(Show show, LocalDate date, boolean peakDay) {
    this.show = show;
    this.date = date;
    this.peakDay = peakDay;
  }


  public static Booking createBooking(Show show, LocalDate date, boolean peakDay) {
    return new Booking(show, date, peakDay);
  }

  public static PremiumBooking createPremiumBooking(Show show, LocalDate date, boolean peakDay, Extras extras) {
    PremiumBooking result = new PremiumBooking(show, date, peakDay, extras);
    result.bePremium(extras);
    return result;
  }

  protected void bePremium(Extras extras) { // ë§ˆì°¬ê°€ì§€ë¡œ ì ‘ê·¼ ì œì–´ìë¥¼ protectedë¡œ ë³€ê²½
    this.premiumDelegate = new PremiumDelegate(this, extras);
  }
  
  // ì´í•˜ ìƒëµ
}


public class PremiumDelegate {
  private final Booking host;
  private final Extras extras;

  public PremiumDelegate(Booking host, Extras extras) {
    this.host = host;
    this.extras = extras;
  }

  public boolean hasTalkback() {
    Show show = this.host.getShow();
    return show.isTalkback();
  }
}


public class PremiumBooking extends Booking {
  private final Extras extras; // ì¶”ê°€ ë¹„ìš©

  public PremiumBooking(Show show, LocalDate date, boolean peakDay, Extras extras) {
    super(show, date, peakDay);
    this.extras = extras;
  }

  @Override
  public boolean hasTalkback() {
    return this.premiumDelegate.hasTalkback(); // í…ŒìŠ¤íŠ¸ í›„ ì‚­ì œí•œë‹¤ (ğŸ—‘)ï¸
  }

  @Override
  public long basePrice() {
    return Math.round(super.basePrice() + this.extras.premiumFee());
  }
}


public class Booking {
    
  //.. 

  public boolean hasTalkback() {
    return (this.premiumDelegate != null)
            ? this.premiumDelegate.hasTalkback()
            : this.show.isTalkback() && !peakDay;
  }
    
}
```

basePrice()ë¥¼ ìœ„ì„í•œë‹¤. ê·¸ëŸ°ë° PrimiumBookingì— basePrice()ë¥¼ ê·¸ëŒ€ë¡œ ì˜®ê¸°ê³ , Bookì˜ basePrice()ë¥¼ í˜¸ì¶œí•˜ë©´ ë¬´í•œ ì¬ê·€ì— ë¹ ì§„ë‹¤
```java
public class Book {
  public long basePrice() {
    return (this.premiumDelegate != null)
            ? this.premiumDelegate.basePrice()
            : this.privateBasePrice();
  }
}


public class PremiumDelegate {
  private final Booking host;
  private final Extras extras;

  public PremiumDelegate(Booking host, Extras extras) {
    this.host = host;
    this.extras = extras;
  }

  public boolean hasTalkback() {
    Show show = this.host.getShow();
    return show.isTalkback();
  }

  public long basePrice() {
    return Math.round(this.host.basePrice() + this.extras.premiumFee()); // super ëŒ€ì‹ , this.host í˜¸ì¶œ
  }
}

```
<br/>

ë°©ë²•ì€ ë‘ ê°€ì§€ì´ë‹¤. ì²« ë²ˆì§¸ëŠ” ìŠˆí¼í´ë˜ìŠ¤ì˜ ê³„ì‚° ë¡œì§ì„ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•˜ì—¬ ê°€ê²© ê³„ì‚°ê³¼ ë¶„ë°° ë¡œì§ì„ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤.
```java
public class Booking {
  public long basePrice() {
    return (this.premiumDelegate != null)
            ? this.premiumDelegate.basePrice()
            : this.privateBasePrice();
  }

  protected long privateBasePrice() {
    long result = this.show.price();
    if (peakDay) {
      result += Math.round(result * 0.15);
    }
    return result;
  }
}


public class PremiumDelegate {
  public long basePrice() {
    return Math.round(this.host.privateBasePrice() + this.extras.premiumFee());
  }
}
```

ë‘˜ì§¸, ìœ„ì„ ë©”ì„œë“œë¥¼ ê¸°ë°˜ ë©”ì„œë“œì˜ í™•ì¥ í˜•íƒœë¡œ ì¬í˜¸ì¶œí•œë‹¤ 
- ê°œì¸ì ìœ¼ë¡œë„ ë‘ ë²ˆì§¸ê°€ ì„ í˜¸ëœë‹¤
- ì™œëƒí•˜ë©´ ìŠˆí¼í´ë˜ìŠ¤ì— ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒë³´ë‹¤ ìœ„ì„ í´ë˜ìŠ¤ì— basePrice ì „ë‹¬í•˜ëŠ”ê²Œ í…ŒìŠ¤íŠ¸í•˜ê¸°ë„ ì‰¬ìš´ê±° ê°™ë‹¤

```java

public class Book {
  public long basePrice() {
    long result = this.show.price();
    if (peakDay) {
      result += Math.round(result * 0.15);
    }
    return (this.premiumDelegate != null)
            ? this.premiumDelegate.extendBasePrice(result)
            : result;
  }
}

public class PremiumDelegate {
  public long extendBasePrice(long basePrice) {
    return basePrice + this.extras.premiumFee();
  }
}
```
<br/>

ë§ˆì§€ë§‰ìœ¼ë¡œ ì„œë¸Œí´ë˜ìŠ¤ì—ë§Œ ì¡´ì¬í•˜ëŠ” ë©”ì„œë“œë„ ìˆì„ ê²ƒì´ë‹¤
```java
public class PremiumBooking {
  public boolean hasDinner() {
    return this.extras.hasDinner() && !this.peakDay;
  }
}

public class PremiumDelegate {
  public boolean hasDinner() {
    return this.extras.hasDinner() && !this.host.peakDay;
  }
}

public class Booking {
  public boolean hasDinner() {
    return (this.premiumDelegate != null)
            && this.premiumDelegate.hasDinner();
  }
}
```
<br/>

ì„œë¸Œí´ë˜ìŠ¤ì˜ ë™ì‘ì„ ëª¨ë‘ ì˜®ê²¼ë‹¤ë©´ íŒ©í„°ë¦¬ ë©”ì„œë“œê°€ ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤. 
í…ŒìŠ¤íŠ¸ í›„ í•„ìš”ì—†ì–´ì§„ ì„œë¸Œí´ë˜ìŠ¤(`PremiumBooking`)ë¥¼ ì§€ìš´ë‹¤
```java
public class Booking {
  public static Booking createPremiumBooking(Show show, LocalDate date, boolean peakDay, Extras extras) {
    Booking result = new Booking(show, date, peakDay);
    result.bePremium(extras);
    return result;
  }

  protected void bePremium(Extras extras) {
    this.premiumDelegate = new PremiumDelegate(this, extras);
  }
}
```

> ì•„! ìƒì†í•˜ëŠ” ì„œë¸Œí´ë˜ìŠ¤ê°€ í•˜ë‚˜ ì¼ë•Œ ìœ„ì„ìœ¼ë¡œ ì˜®ê²¨ì„œ ìƒì†ì„ ë‹¤ë¥¸ ìœ ìš©í•œ ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê³¼ì •ì´ì—ˆêµ¬ë‚˜.
> PremiumDelegate í´ë˜ìŠ¤ì— PremiumBookdì—ì„œ í•„ìš”í•œ ì†ì„±ê³¼ í–‰ìœ„ë¥¼ ì˜®ê¸´ë‹¤. 
> Bookingì—ì„œëŠ” PremiumDelegate != null ì¸ ê²½ìš° ì¡°ê±´ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì„œë¸Œí´ë˜ìŠ¤ ì œê±° ê°€ëŠ¥í–ˆë‹¤.

**âœ¨after**
```java
public class Booking {
    protected final Show show;
    protected final LocalDate date;
    protected final boolean peakDay;

    protected PremiumDelegate premiumDelegate;

    protected Booking(Show show, LocalDate date, boolean peakDay) {
        this.show = show;
        this.date = date;
        this.peakDay = peakDay;
    }

    public static Booking createBooking(Show show, LocalDate date, boolean peakDay) {
        return new Booking(show, date, peakDay);
    }

    public static Booking createPremiumBooking(Show show, LocalDate date, boolean peakDay, Extras extras) {
        Booking result = new Booking(show, date, peakDay);
        result.bePremium(extras);
        return result;
    }

    protected void bePremium(Extras extras) {
        this.premiumDelegate = new PremiumDelegate(this, extras);
    }

    public boolean hasTalkback() {
        return (this.premiumDelegate != null)
                ? this.premiumDelegate.hasTalkback()
                : this.show.isTalkback() && !peakDay;
    }

    public long basePrice() {
        long result = this.show.price();
        if (peakDay) result += Math.round(result * 0.15);

        return (this.premiumDelegate != null)
                ? this.premiumDelegate.extendBasePrice(result)
                : result;
    }

    public boolean hasDinner() {
        return (this.premiumDelegate != null)
                && this.premiumDelegate.hasDinner();
    }

    public Show getShow() {
        return show;
    }
}


public class Extras {

  private final long premiumFee;
  private final boolean dinner;

  public Extras(long premiumFee, boolean dinner) {
    this.premiumFee = premiumFee;
    this.dinner = dinner;
  }

  public long premiumFee() {
    return this.premiumFee;
  }

  public boolean hasDinner() {
    return this.dinner;
  }
}


public class Show {
  private final long price;
  private final boolean talkback;

  public Show(long price, boolean talkback) {
    this.price = price;
    this.talkback = talkback;
  }

  public long price() {
    return this.price;
  }

  public boolean isTalkback() {
    return this.talkback;
  }
}


public class PremiumDelegate {
  private final Booking host;
  private final Extras extras;

  public PremiumDelegate(Booking host, Extras extras) {
    this.host = host;
    this.extras = extras;
  }

  public boolean hasTalkback() {
    Show show = this.host.getShow();
    return show.isTalkback();
  }

  public long extendBasePrice(long basePrice) {
    return basePrice + this.extras.premiumFee();
  }

  public boolean hasDinner() {
    return this.extras.hasDinner() && !this.host.peakDay;
  }
}

```
<br/>

**ğŸ’©before**
ë‘ë²ˆì§¸ ì˜ˆì‹œ
- ì´ ì½”ë“œëŠ” ì•¼ìƒ ì¡°ë¥˜ì™€ ì‚¬ìœ¡ ì¡°ë¥˜ë¥¼ êµ¬ë¶„ ì§“ê¸° ìœ„í•´ í¬ê²Œ ìˆ˜ì •í•  ì˜ˆì •ì´ë‹¤
- ì´ ì°¨ì´ëŠ” WildBirdì™€ CaptiveBirdë¼ëŠ” ë‘ ì„œë¸Œí´ë˜ìŠ¤ë¡œ ëª¨ë¸ë§í•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤
- <u>í•˜ì§€ë§Œ ìƒì†ì€ í•œë²ˆë§Œ ì“¸ ìˆ˜ ìˆìœ¼ë‹ˆ ì•¼ìƒê³¼ ì‚¬ìœ¡ì˜ ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ„ë ¤ë©´ ì¢…ì— ë”°ë¥¸ ë¶„ë¥˜ë¥¼ í¬ê¸°í•´ì•¼ í•œë‹¤</u>
```java
public class Bird {
  protected final String name;
  protected final String plumage;

  public Bird(String name, String plumage) {
    this.name = name;
    this.plumage = plumage;
  }

  public static Bird from(BirdDto birdDto) {
    return switch (birdDto.type()) {
      case "ìœ ëŸ½ ì œë¹„" -> new EuropeanSwallow(birdDto);
      case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> new AfricanSwallow(birdDto);
      case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> new NorwegianBlueParrot(birdDto);
      default -> throw new IllegalArgumentException(birdDto.type());
    };
  }

  public String name() {
    return name;
  }

  public String plumage() {
    return this.plumage.isBlank() ? "ë³´í†µì´ë‹¤" : this.plumage;
  }

  public Integer airSpeedVelocity() {
    return null;
  }

}


public class AfricanSwallow extends Bird {
  private final int numberOfCoconuts;

  public AfricanSwallow(BirdDto data) {
    this(data.name(), data.plumage(), data.numberOfCoconuts());
  }

  public AfricanSwallow(String name, String plumage, int numberOfCoconuts) {
    super(name, plumage);
    this.numberOfCoconuts = numberOfCoconuts;
  }

  @Override
  public Integer airSpeedVelocity() {
    return 40 - 2 * numberOfCoconuts;
  }
}


public class EuropeanSwallow extends Bird {

  public EuropeanSwallow(BirdDto data) {
    this(data.name(), data.plumage());
  }

  public EuropeanSwallow(String name, String plumage) {
    super(name, plumage);
  }

  @Override
  public Integer airSpeedVelocity() {
    return 35;
  }
}


public class NorwegianBlueParrot extends Bird {
  private final int voltage;
  private final boolean isNailed;

  public NorwegianBlueParrot(BirdDto data) {
    this(data.name(), data.plumage(), data.voltage(), data.isNailed());
  }

  public NorwegianBlueParrot(String name, String plumage, int voltage, boolean isNailed) {
    super(name, plumage);
    this.voltage = voltage;
    this.isNailed = isNailed;
  }

  @Override
  public String plumage() {
    if (voltage > 100) return "ê·¸ì„ë ¸ë‹¤";

    return this.plumage.isBlank() ? "ì˜ˆì˜ë‹¤" : this.plumage;
  }

  @Override
  public Integer airSpeedVelocity() {
    return isNailed ? 0 : 10 + voltage / 10;
  }
}

```
<br/>

```java
public class Bird {
  protected final String name;
  protected final String plumage;
  protected EuropeanSwallowDelegate speciesDelegate;

  public Bird(String name, String plumage) {
    this.name = name;
    this.plumage = plumage;
  }

  public Bird(BirdDto birdDto) {
    this.name = birdDto.name();
    this.plumage = birdDto.plumage();
    this.speciesDelegate = selectSpeciesDelegate(birdDto);
  }

  private static EuropeanSwallowDelegate selectSpeciesDelegate(BirdDto birdDto) {
    if (birdDto.type().equals("ìœ ëŸ½ ì œë¹„")) {
      return new EuropeanSwallowDelegate();
    }

    return null;
  }
  
  //.. 
}
```
- EuropeanSwallow í´ë˜ìŠ¤ì— ìˆë˜ `airSpeedVelocity()`ë¥¼ EuropeanSwallowDelegate ì˜®ê¸´ë‹¤
- EuropeanSwallow í´ë˜ìŠ¤ì˜ `airSpeedVelocity()`ì—ì„œëŠ” `speciesDelegate.airSpeedVelocity()` í˜¸ì¶œí•œë‹¤
- Birdì˜ `airSpeedVelocity()` ì¡°ê±´ë¬¸ì„ ì¶”ê°€í•œë‹¤
- ì •ì  íŒ©í„°ë¦¬ ë©”ì„œë“œì—ì„œ EuropeanSwallow ì¡°ê±´ì ˆì„ ì§€ìš°ê³  EuropeanSwallow í´ë˜ìŠ¤ë¥¼ ì‚­ì œí•œë‹¤
  - í¬ê²Œ ë³´ë©´ ìœ„ì„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ , ìœ„ì„ í´ë˜ìŠ¤ì— í•„ìš”í•œ ë©”ì„œë“œë‚˜ í•„ë“œë¥¼ ë„˜ê¸°ê³ , í¬ì›Œë”© í˜¸ì¶œ, ê·¸ë¦¬ê³  ì œê±° ìˆœì´ë„¤

<br/>

```java
public class Bird {
    protected final String name;
    protected final String plumage;
    protected Object speciesDelegate;

    public Bird(String name, String plumage) {
        this.name = name;
        this.plumage = plumage;
    }

    public Bird(BirdDto birdDto) {
        this.name = birdDto.name();
        this.plumage = birdDto.plumage();
        this.speciesDelegate = selectSpeciesDelegate(birdDto);
    }

    private Object selectSpeciesDelegate(BirdDto birdDto) {
        return switch (birdDto.type()) {
            case "ìœ ëŸ½ ì œë¹„" -> new EuropeanSwallowDelegate();
            case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> new AfricanSwallowDelegate(birdDto);
            case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> new NorwegianBlueParrotDelegate(birdDto, this);
            default -> throw new IllegalArgumentException(birdDto.type());
        };
    }

    public String name() {
        return name;
    }

    public String plumage() {
        if (this.speciesDelegate instanceof NorwegianBlueParrotDelegate) {
            return ((NorwegianBlueParrotDelegate) this.speciesDelegate).plumage();
        }

        return this.plumage.isBlank() ? "ë³´í†µì´ë‹¤" : this.plumage;
    }

    public Integer airSpeedVelocity() {
        if (this.speciesDelegate instanceof EuropeanSwallowDelegate) {
            return ((EuropeanSwallowDelegate) this.speciesDelegate).airSpeedVelocity();
        }

        if (this.speciesDelegate instanceof AfricanSwallowDelegate) {
            return ((AfricanSwallowDelegate) this.speciesDelegate).airSpeedVelocity();
        }

        if (this.speciesDelegate instanceof NorwegianBlueParrotDelegate) {
            return ((NorwegianBlueParrotDelegate) this.speciesDelegate).airSpeedVelocity();
        }

        return null;
    }

}


public class AfricanSwallowDelegate {
  private final int numberOfCoconuts;

  public AfricanSwallowDelegate(BirdDto data) {
    this.numberOfCoconuts = data.numberOfCoconuts();
  }

  public Integer airSpeedVelocity() {
    return 40 - 2 * numberOfCoconuts;
  }
}


public class EuropeanSwallowDelegate {
  public Integer airSpeedVelocity() {
    return 35;
  }
}


public class NorwegianBlueParrotDelegate {
  private final int voltage;
  private final boolean isNailed;
  private final Bird bird;

  public NorwegianBlueParrotDelegate(BirdDto data, Bird bird) {
    this.voltage = data.voltage();
    this.isNailed = data.isNailed();
    this.bird = bird;
  }

  public String plumage() {
    if (voltage > 100) return "ê·¸ì„ë ¸ë‹¤";

    return this.bird.plumage().isBlank() ? "ì˜ˆì˜ë‹¤" : this.bird.plumage();
  }

  public Integer airSpeedVelocity() {
    return isNailed ? 0 : 10 + voltage / 10;
  }
}

```
- `instanceof`ë¡œ íƒ€ì… ì²´í¬ë¥¼ í•œë‹¤ê±°ë‚˜, íŠ¹ìˆ˜í•œ `plumage()`ë¥¼ ê°€ì§€ê³  ìˆë‹¤ë³´ë‹ˆ íƒ€ì…ì²´í¬ê°€ ë” ì–´ë ¤ì›Œì§„ë‹¤ 
- `SpeciesDelegate` ìŠˆí¼í´ë˜ìŠ¤ë¥¼ ì¶”ì¶œí•œë‹¤
<br/>

**âœ¨after**
```java
public class Bird {
    protected final String name;
    protected final String plumage;
    protected SpeciesDelegate speciesDelegate;

    public Bird(String name, String plumage) {
        this.name = name;
        this.plumage = plumage;
    }

    public Bird(BirdDto birdDto) {
        this.name = birdDto.name();
        this.plumage = birdDto.plumage();
        this.speciesDelegate = selectSpeciesDelegate(birdDto);
    }

    private SpeciesDelegate selectSpeciesDelegate(BirdDto birdDto) {
        return switch (birdDto.type()) {
            case "ìœ ëŸ½ ì œë¹„" -> new EuropeanSwallowDelegate(this);
            case "ì•„í”„ë¦¬ì¹´ ì œë¹„" -> new AfricanSwallowDelegate(birdDto, this);
            case "ë…¸ë¥´ì›¨ì´ íŒŒë‘ ì•µë¬´" -> new NorwegianBlueParrotDelegate(birdDto, this);
            default -> new SpeciesDelegate(this);
        };
    }

    public static Bird from(BirdDto data) {
        return new Bird(data);
    }

    public String name() {
        return name;
    }

    public String plumage() {
        return this.speciesDelegate.plumage();
    }

    public Integer airSpeedVelocity() {
        return this.speciesDelegate.airSpeedVelocity();
    }

}


public class SpeciesDelegate {
  protected final Bird bird;

  protected SpeciesDelegate(Bird bird) {
    this.bird = bird;
  }

  public String plumage() {
    String plumage = this.bird.plumage();
    return plumage.isBlank() ? "ë³´í†µì´ë‹¤" : plumage;
  }

  public Integer airSpeedVelocity() {
    return null;
  }
}


public class AfricanSwallowDelegate extends SpeciesDelegate {
  private final int numberOfCoconuts;

  public AfricanSwallowDelegate(BirdDto data, Bird bird) {
    super(bird);
    this.numberOfCoconuts = data.numberOfCoconuts();
  }

  @Override
  public Integer airSpeedVelocity() {
    return 40 - 2 * numberOfCoconuts;
  }
}


public class EuropeanSwallowDelegate extends SpeciesDelegate {

  public EuropeanSwallowDelegate(Bird bird) {
    super(bird);
  }

  @Override
  public Integer airSpeedVelocity() {
    return 35;
  }
}


public class NorwegianBlueParrotDelegate extends SpeciesDelegate {
  private final int voltage;
  private final boolean isNailed;

  public NorwegianBlueParrotDelegate(BirdDto data, Bird bird) {
    super(bird);
    this.voltage = data.voltage();
    this.isNailed = data.isNailed();
  }

  @Override
  public String plumage() {
    if (voltage > 100) return "ê·¸ì„ë ¸ë‹¤";

    return this.bird.plumage().isBlank() ? "ì˜ˆì˜ë‹¤" : this.bird.plumage();
  }

  @Override
  public Integer airSpeedVelocity() {
    return isNailed ? 0 : 10 + voltage / 10;
  }
}
```

### 12.11 ìŠˆí¼ í´ë˜ìŠ¤ë¥¼ ìœ„ì„ìœ¼ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Superclass with Delegate](https://refactoring.com/catalog/replaceSuperclassWithDelegate.html)
- 1íŒì—ì„œì˜ ì´ë¦„: ìƒì†ì„ ìœ„ì„ìœ¼ë¡œ ì „í™˜
- ë°”ë¡œê°€ê¸°:
  - [ì˜ˆì‹œ](../src/main/java/com/example/refactoring2/ch12/ex11)
  - [í…ŒìŠ¤íŠ¸](../src/test/java/com/example/refactoring2/ch12/ex11)

<br/>

**ë°°ê²½**
- ìƒì†ì„ ì˜ëª» ì ìš©í•œ ì˜ˆë¡œëŠ” ìë°”ì˜ ìŠ¤íƒ í´ë˜ìŠ¤ê°€ ìœ ëª…í•˜ë‹¤
  - ìë°”ì˜ ìŠ¤íƒì€ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì†í•˜ê³  ìˆëŠ”ë°, ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì¡°ì‘í•˜ëŠ” ë¦¬ìŠ¤íŠ¸ì˜ ê¸°ëŠ¥ì„ ì¬í™œìš©í•˜ê² ë‹¤ëŠ” ìƒê°ì´ ì´ˆë˜í•œ ê²°ê³¼ë‹¤
- ì¬í™œìš©ì´ë€ ê´€ì ì—ì„œëŠ” ì¢‹ì•˜ì§€ë§Œ ì´ ìƒì†ì—ëŠ” ë¬¸ì œê°€ ìˆë‹¤
- ë¦¬ìŠ¤íŠ¸ì˜ ì—°ì‚° ì¤‘ ìŠ¤íƒì—ëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ” ê²Œ ë§ìŒì—ë„ ê·¸ ëª¨ë“  ì—°ì‚°ì´ ìŠ¤íƒ ì¸í„°í˜ì´ìŠ¤ì— ê·¸ëŒ€ë¡œ ë…¸ì¶œë˜ëŠ” ê²Œ ì•„ë‹Œê°€! 
- ì´ë³´ë‹¤ëŠ” ìŠ¤íƒì—ì„œ ë¦¬ìŠ¤íŠ¸ ê°ì²´ë¥¼ í•„ë“œì— ì €ì¥í•´ë‘ê³  í•„ìš”í•œ ê¸°ëŠ¥ë§Œ ìœ„ì„í–ˆë‹¤ë©´ ë” ë©‹ì¡Œì„ ê²ƒì´ë‹¤
- (..) ì´ìƒì˜ ì´ìœ ë¡œ "ìƒì†ì€ ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ë¼"ê³  ì¡°ì–¸í•˜ëŠ” ì‚¬ëŒë„ ìˆë‹¤. ë‚˜ëŠ” ë™ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤
- **ì˜ë¯¸ìƒ ì í•©í•œ ì¡°ê±´ì´ë¼ë©´ ìƒì†ì€ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ì¸ ë§¤ì»¤ë‹ˆì¦˜ì´ë‹¤**
<br/>

**ì ˆì°¨**
- ìŠˆí¼í´ë˜ìŠ¤ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” í•„ë“œë¥¼ ì„œë¸Œí´ë˜ìŠ¤ì— ë§Œë“ ë‹¤
  - ì´ë²ˆ ë¦¬íŒ©í„°ë§ì„ ë§ˆì¹˜ë©´ ìŠˆí¼í´ë˜ìŠ¤ê°€ ìœ„ì„ ê°ì²´ê°€ ë  ê²ƒì´ë¯€ë¡œ ì´ í•„ë“œë¥¼ 'ìœ„ì„ ì°¸ì¡°'ë¼ ë¶€ë¥´ì
  - ìœ„ì„ ì°¸ì¡°ë¥¼ ìƒˆë¡œìš´ ìŠˆí¼í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì´ˆê¸°í™”í•œë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ì˜ ë™ì‘ ê°ê°ì— ëŒ€ì‘í•˜ëŠ” ì „ë‹¬ í•¨ìˆ˜ë¥¼ ì„œë¸Œí´ë˜ìŠ¤ì— ë§Œë“ ë‹¤ (ë¬¼ë¡  ìœ„ì„ ì°¸ì¡°ë¡œ ì „ë‹¬í•œë‹¤)
  - ì„œë¡œ ê´€ë ¨ëœ í•¨ìˆ˜ë¼ë¦¬ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ ì§„í–‰í•˜ë©°, ê·¸ë£¹ì„ í•˜ë‚˜ì”© ë§Œë“¤ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤
  - ëŒ€ë¶€ë¶„ì€ ì „ë‹¬ í•¨ìˆ˜ ê°ê°ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤
  - í•˜ì§€ë§Œ ì˜ˆì»¨ëŒ€ ê²Œí„°ì™€ ì„¸í„° ìŒì€ ë‘˜ ë‹¤ ì˜®ê¸´ í›„ì—ì•¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤
- ìŠˆí¼í´ë˜ìŠ¤ì˜ ë™ì‘ ëª¨ë‘ê°€ ì „ë‹¬ í•¨ìˆ˜ë¡œ ì˜¤ë²„ë¼ì´ë“œ ë˜ì—ˆë‹¤ë©´ ìƒì† ê´€ê³„ë¥¼ ëŠëŠ”ë‹¤
<br/>

**ğŸ’©before**
```java
public class CatalogItem {
  protected final Long id;
  protected final String title;
  protected final Set<String> tags;

  public CatalogItem(Long id, String title, Set<String> tags) {
    this.id = id;
    this.title = title;
    this.tags = tags;
  }

  public Long getId() {
    return id;
  }

  public String getTitle() {
    return title;
  }

  public boolean hasTag(String tag) {
    return this.tags.contains(tag);
  }
}


public class Scroll extends CatalogItem {
    private final LocalDate lastCleaned;

    public Scroll(Long id, String title, Set<String> tags, LocalDate lastCleaned) {
        super(id, title, tags);
        this.lastCleaned = lastCleaned;
    }

    public boolean needsCleaning(LocalDate targetDate) {
        int threshold = this.hasTag("revered") ? 700 : 1500;
        return this.daysSinceLastCleaning(targetDate) > threshold;
    }

    // lastCleaned ë¶€í„° targetDate ê¹Œì§€ ì¼ ìˆ˜ ë°˜í™˜
    private long daysSinceLastCleaning(LocalDate targetDate) {
        return this.lastCleaned.until(targetDate, ChronoUnit.DAYS);
    }
}
```
<br/>

**âœ¨after**
```java
public class CatalogItem {
  protected final Long id;
  protected final String title;
  protected final Set<String> tags;

  public CatalogItem(Long id, String title, Set<String> tags) {
    this.id = id;
    this.title = title;
    this.tags = tags;
  }

  public Long getId() {
    return id;
  }

  public String getTitle() {
    return title;
  }

  public boolean hasTag(String tag) {
    return this.tags.contains(tag);
  }
}

public class Scroll {
    private final LocalDate lastCleaned;
    private final CatalogItem catalogItem;

    public Scroll(Long id, String title, Set<String> tags, LocalDate lastCleaned) {
        this.catalogItem = new CatalogItem(id, title, tags);
        this.lastCleaned = lastCleaned;
    }

    public boolean needsCleaning(LocalDate targetDate) {
        int threshold = this.hasTag("revered") ? 700 : 1500;
        return this.daysSinceLastCleaning(targetDate) > threshold;
    }

    private long daysSinceLastCleaning(LocalDate targetDate) {
        return this.lastCleaned.until(targetDate, ChronoUnit.DAYS);
    }

    public Long id() {
        return this.catalogItem.id;
    }

    public String title() {
        return this.catalogItem.title;
    }

    public boolean hasTag(String tag) {
        return this.catalogItem.hasTag(tag);
    }
}
```
<br/>


---
### Reference.
