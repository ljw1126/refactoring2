# Chapter7. ìº¡ìŠí™”

## í›„ê¸° 
ì´ë²ˆ ì¥ì„ í•™ìŠµí•˜ë©´ì„œ ìº¡ìŠí™”ì˜ ì˜ë¯¸ë¥¼ ë‹¤ì‹œ í•œë²ˆ ìƒê°í•  ìˆ˜ ìˆì—ˆë‹¤. 
- ë‹¨ìˆœíˆ ê´€ë ¨ ìˆëŠ” ì†ì„±ê³¼ í–‰ìœ„ë¥¼ ë¬¶ëŠ” ê²ƒì„ ë„˜ì–´, ë³€ê²½ ì§€ì ì„ íš¨ê³¼ì ìœ¼ë¡œ ì œì–´í•˜ì—¬ ì•ˆì •ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì¸ìƒì ì´ì—ˆë‹¤.
- ë˜í•œ, ìº¡ìŠí™”ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ë‚˜ ë‹¤ë¥¸ ëª¨ë“ˆì´ ì‹œìŠ¤í…œ ë‚´ë¶€ êµ¬í˜„ì„ ì•Œ í•„ìš” ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„±ì„ ì¤„ì¼ ìˆ˜ ìˆìŒì„ ë°°ì› ë‹¤. 
- ê²°ê³¼ì ìœ¼ë¡œ, ì‹œìŠ¤í…œì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ ê¹Šì´ ì•Œì§€ ì•Šì•„ë„, í´ë¼ì´ì–¸íŠ¸ê°€ ì¸í„°í˜ì´ìŠ¤ë§Œìœ¼ë¡œ ì‰½ê²Œ í™œìš© ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“œëŠ” ê²ƒì´ ìº¡ìŠí™”ì˜ í•µì‹¬ ê°€ì¹˜ë¼ëŠ” ì ì„ ê¹¨ë‹¬ì„ ìˆ˜ ìˆì—ˆë‹¤.
<br/>

## í•™ìŠµ ê¸°ë¡ 

**ëª©ì°¨**
- [7.1 ë ˆì½”ë“œ ìº¡ìŠí™”í•˜ê¸°](#71-ë ˆì½”ë“œ-ìº¡ìŠí™”í•˜ê¸°)
- [7.2 ì»¬ë ‰ì…˜ ìº¡ìŠí™”í•˜ê¸°](#72-ì»¬ë ‰ì…˜-ìº¡ìŠí™”í•˜ê¸°)
- [7.3 ê¸°ë³¸í˜•ì„ ê°ì²´ë¡œ ë°”ê¾¸ê¸°](#73-ê¸°ë³¸í˜•ì„-ê°ì²´ë¡œ-ë°”ê¾¸ê¸°)
- [7.4 ì„ì‹œ ë³€ìˆ˜ë¥¼ ì§ˆì˜ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°](#74-ì„ì‹œ-ë³€ìˆ˜ë¥¼-ì§ˆì˜-í•¨ìˆ˜ë¡œ-ë°”ê¾¸ê¸°)
- [7.5 í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°](#75-í´ë˜ìŠ¤-ì¶”ì¶œí•˜ê¸°)
- [7.6 í´ë˜ìŠ¤ ì¸ë¼ì¸í•˜ê¸°](#76-í´ë˜ìŠ¤-ì¸ë¼ì¸í•˜ê¸°)
- [7.7 ìœ„ì„ ìˆ¨ê¸°ê¸°](#77-ìœ„ì„-ìˆ¨ê¸°ê¸°)
- [7.8 ì¤‘ê°œì ì œê±°í•˜ê¸°](#78-ì¤‘ê°œì-ì œê±°í•˜ê¸°)
- [7.9 ì•Œê³ ë¦¬ì¦˜ êµì²´í•˜ê¸°](#79-ì•Œê³ ë¦¬ì¦˜-êµì²´í•˜ê¸°)


<br/>

### 7.1 ë ˆì½”ë“œ ìº¡ìŠí™”í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Encapsulate Record](https://refactoring.com/catalog/encapsulateRecord.html)
- ì˜ˆì‹œ
  - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex1)
  - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex1)
<br/>


**ë°°ê²½**
- **ë ˆì½”ë“œ**ëŠ” ì—°ê´€ëœ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì§ê´€ì ì¸ ë°©ì‹ìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆì–´ì„œ ê°ê°ì„ ë”°ë¡œ ì·¨ê¸‰í•  ë•Œë³´ë‹¤ í›¨ì”¬ ì˜ë¯¸ìˆëŠ” ë‹¨ìœ„ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
- ì €ìëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ìš©ë„ë¡œëŠ” ë ˆì½”ë“œë³´ë‹¤ ê°ì²´ë¥¼ ì„ í˜¸í•˜ëŠ” í¸ì´ë‹¤.
  - ğŸ‘¨ğŸ»â€ğŸ’»ìë°”ì˜ recordëŠ” ë¶ˆë³€ì´ë‹¤, getter/setterë¥¼ ì§€ì›í•˜ëŠ” dtoë¥¼ ì˜ë¯¸í•˜ëŠ” ë“¯í•˜ë‹¤.
- ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©´ ì–´ë–»ê²Œ ì €ì¥í–ˆëŠ”ì§€ë¥¼ ìˆ¨ê¸´ ì±„ ì„¸ ê°€ì§€ ê°’ì„ ê°ê°ì˜ ë©”ì„œë“œë¡œ ì œê³µí•  ìˆ˜ ìˆë‹¤.
- ì‚¬ìš©ìëŠ” ë¬´ì—‡ì´ ì €ì¥ëœ ê°’ì´ê³  ë¬´ì—‡ì´ ê³„ì‚°ëœ ê°’ì¸ì§€ ì•Œ í•„ìš”ê°€ ì—†ë‹¤.
- ìº¡ìŠí™”í•˜ë©´ ì´ë¦„ì„ ë°”ê¿€ ë•Œë„ ì¢‹ë‹¤.
- ì €ìëŠ” `ê°€ë³€` ë°ì´í„°ì¼ ë•Œ ê°ì²´ë¥¼ ì„ í˜¸í•œë‹¤ê³  í–ˆë‹¤.
- ê°’ì´ ë¶ˆë³€ì´ë©´ ë‹¨ìˆœíˆ 'ì‹œì‘'ê³¼ 'ë'ê³¼ 'ê¸¸ì´'ë¥¼ ëª¨ë‘ êµ¬í•´ì„œ `ë ˆì½”ë“œ`ì— ì €ì¥í•œë‹¤
- ë ˆì½”ë“œ êµ¬ì¡°ëŠ” ë‘ ê°€ì§€ë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.
  - í•˜ë‚˜ëŠ” í•„ë“œ ì´ë¦„ì„ ë…¸ì¶œí•˜ëŠ” í˜•íƒœ
  - ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ë‚´ê°€ ì›í•˜ëŠ” ì´ë¦„ì„ ì“¸ ìˆ˜ ìˆëŠ” í˜•íƒœë‹¤
    - í›„ìëŠ” ì£¼ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ `í•´ì‹œ`, `ë§µ`, `í•´ì‹œë§µ`, `ë”•ì…”ë„ˆë¦¬`, `ì—°ê´€ ë°°ì—´` ë“±ì˜ ì´ë¦¼ìœ¼ë¡œ ì œê³µí•œë‹¤.
- JSON ì´ë‚˜ XML ê°™ì€ í¬ë§·ì€ ì§ë ¬í™”(serialize) í•  ë•Œê°€ ë§ë‹¤.
  - ì´ ê²½ìš° ì—­ì‹œ ìº¡ìŠí™”í•  ìˆ˜ ìˆë‹¤.
  - ê·¸ëŸ¬ë©´ ë‚˜ì¤‘ì— í¬ë§·ì„ ë°”ê¾¸ê±°ë‚˜ ì¶”ì í•˜ê¸° ì–´ë ¤ìš´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ê¸°ê°€ ìˆ˜ì›”í•´ì§„ë‹¤.
<br/>

**ì ˆì°¨**
- ë ˆì½”ë“œë¥¼ ë‹´ì€ ë³€ìˆ˜ë¥¼ `ìº¡ìŠí™”`í•œë‹¤
- ë ˆì½”ë“œë¥¼ ê°ì‹¼ ë‹¨ìˆœí•œ í´ë˜ìŠ¤ë¡œ í•´ë‹¹ ë³€ìˆ˜ì˜ ë‚´ìš©ì„ êµì²´í•œë‹¤.
  - ì´ í´ë˜ìŠ¤ì— ì›ë³¸ ë ˆì½”ë“œë¥¼ ë°˜í™˜í•˜ëŠ” ì ‘ê·¼ìë„ ì •ì˜í•˜ê³ , ë³€ìˆ˜ë¥¼ ìº¡ìŠí™”í•˜ëŠ” í•¨ìˆ˜ë“¤ì´ì´ ì ‘ê·¼ìë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •í•œë‹¤.
- í…ŒìŠ¤íŠ¸í•œë‹¤. 
- ì›ë³¸ ë ˆì½”ë“œ ëŒ€ì‹  ìƒˆë¡œ ì •ì˜í•œ í´ë˜ìŠ¤ íƒ€ì…ì˜ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë“¤ì„ ìƒˆë¡œ ë§Œë“ ë‹¤.
- ë ˆì½”ë“œë¥¼ ë°˜í™˜í•˜ëŠ” ì˜ˆì „ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ `ë„¤ë²ˆì§¸`ì—ì„œ ë§Œë“  ìƒˆ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë°”ê¾¼ë‹¤.
  - í•„ë“œì— ì ‘ê·¼í•  ë•ŒëŠ” ê°ì²´ì˜ ì ‘ê·¼ìë¥¼ ì‚¬ìš©í•œë‹¤. 
  - ì ì ˆí•œ ì ‘ê·¼ìê°€ ì—†ë‹¤ë©´ ì¶”ê°€í•œë‹¤.
  - í•œ ë¶€ë¶„ì„ ë°”ê¿€ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- í´ë˜ìŠ¤ì—ì„œ ì›ë³¸ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” ì ‘ê·¼ìì™€ ì›ë³¸ ë ˆì½”ë“œë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì œê±°í•œë‹¤.
- í…ŒìŠ¤íŠ¸í•œë‹¤.
- ë ˆì½”ë“œì˜ í•„ë“œë„ ë°ì´í„° êµ¬ì¡°ì¸ ì¤‘ì²© êµ¬ì¡°ë¼ë©´ ë ˆì½”ë“œ ìº¡ìŠí™”í•˜ê¸°ì™€ ì»¬ë ‰ì…˜ ìº¡ìŠí™”í•˜ê¸°ë¥¼ ì¬ê·€ì ìœ¼ë¡œ ì ìš©í•œë‹¤.
<br/>

**Sample ë°ì´í„°** <br/>
```json
"1920" : {
   name : "ë§ˆí‹´íŒŒìš¸ëŸ¬",
   id: "1920",
   usages : {
        "2016": {
              "1" : 50,
              "2" : 55, // ë‚˜ë¨¸ì§€ë‹¬ ìƒëµ
         },
        "2015": {
              "1" : 70,
              "2" : 63, // ë‚˜ë¨¸ì§€ë‹¬ ìƒëµ
         }   
   }
}, // ì´í•˜ ìƒëµ
```
<br/>

**í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨** <br/>
<img src="https://github.com/ljw1126/user-content/blob/master/refactoring2/ch07/7-1.jpg?raw=true">
<br/>

**âœ¨after**
```java
public class CustomerData {
  private Map<String, Customer> data;

  public CustomerData(Map<String, Customer> data) {
    this.data = new HashMap<>();

    for (Map.Entry<String, Customer> entry : data.entrySet()) {
      this.data.put(entry.getKey(), new Customer(entry.getValue()));
    }
  }

  public int usage(String customerId, String year, String month) {
    CustomerData copied = rawData();
    Customer customer = copied.getCustomer(customerId);
    return customer.usages(year, month);
  }

  public Result compareUsage(String customerId, String laterYear, String month) {
    CustomerData copied = rawData();
    Customer customer = copied.getCustomer(customerId);

    int later = customer.usages(laterYear, month);
    int earlier = customer.usages(String.valueOf(Integer.parseInt(laterYear) - 1), month);

    return new Result(later, later - earlier);
  }

  public void setUsage(String customerId, String year, String month, int amount) {
    Customer customer = getCustomer(customerId);
    customer.setUsage(year, month, amount);
  }

  public CustomerData rawData() {
    return new CustomerData(this.data);
  }

  private Customer getCustomer(String customerId) {
    return Optional.ofNullable(this.data.get(customerId))
            .orElseThrow(() -> new IllegalArgumentException("Customer not found:" + customerId));
  }
}


public class Customer {
  private final String id;
  private final String name;
  private final Map<String, MonthlyUsage> usages;

  public Customer(Customer customer) {
    this(customer.id, customer.name, customer.usages);
  }

  public Customer(String id, String name, Map<String, MonthlyUsage> usages) {
    this.id = id;
    this.name = name;
    this.usages = new HashMap<>();

    for (Map.Entry<String, MonthlyUsage> entry : usages.entrySet()) {
      this.usages.put(entry.getKey(), new MonthlyUsage(entry.getValue()));
    }
  }

  public int usages(String year, String month) {
    MonthlyUsage monthlyUsage = getMonthlyUsage(year);
    return monthlyUsage.getAmount(month);
  }

  public void setUsage(String year, String month, int amount) {
    MonthlyUsage monthlyUsage = getMonthlyUsage(year);
    monthlyUsage.setUsage(month, amount);
  }

  private MonthlyUsage getMonthlyUsage(String year) {
    return  Optional.ofNullable(this.usages.get(year))
            .orElseThrow(() -> new IllegalArgumentException("MonthlyUsage not found:" + year));
  }
}



public class MonthlyUsage {
  private final Map<String, Integer> usageByMonth;

  public MonthlyUsage(MonthlyUsage monthlyUsage) {
    this(new HashMap<>(monthlyUsage.usageByMonth));
  }

  public MonthlyUsage(Map<String, Integer> usageByMonth) {
    this.usageByMonth = usageByMonth;
  }

  public int getAmount(String month) {
    return usageByMonth.getOrDefault(month, 0);
  }

  public void setUsage(String month, int amount) {
    usageByMonth.put(month, amount);
  }
}
```
1. ê¹Šì€ ë³µì‚¬ (Deep Copy) ì ìš©
- Copy Constructorë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒˆë¡œ ë³µì‚¬í•¨ìœ¼ë¡œì¨, ì›ë³¸ ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ ë³´í˜¸í•¨. (ì™¸ë¶€ ì°¸ì¡° ëŠìŒ)
- rawData()ì—ì„œë„ ìƒˆë¡œìš´ CustomerData ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë°˜í™˜í•˜ì—¬, ì™¸ë¶€ì—ì„œ ê°€ì ¸ê°„ ë°ì´í„°ê°€ ì›ë³¸ì„ ë³€ê²½í•  ìˆ˜ ì—†ë„ë¡ ë°©ì§€í•¨.

2. setUsage(..) í†µí•œ ë³€ê²½ ì œì–´
- ì§ì ‘ ë°ì´í„°ë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê³ , setUsage()ë¥¼ í†µí•´ ë°ì´í„° ë³€ê²½ì„ ìœ ë„í•˜ì—¬ ì¼ê´€ëœ ë°ì´í„° ìˆ˜ì • ë°©ì‹ì„ ìœ ì§€.
- í´ë¼ì´ì–¸íŠ¸ê°€ ì›ë³¸ ë°ì´í„°ë¥¼ ì§ì ‘ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë³µì‚¬ë³¸ì„ ê°€ì ¸ê°€ ì‚¬ìš©í•˜ë¯€ë¡œ ì•ˆì •ì ì„.

3. ê°ì²´ ê°„ ì±…ì„ ë¶„ë¦¬
- CustomerData â†’ ì „ì²´ ê³ ê° ê´€ë¦¬
- Customer â†’ ê°œë³„ ê³ ê° ê´€ë¦¬
- MonthlyUsage â†’ ì—°ë„ë³„ ì›”ê°„ ì‚¬ìš©ëŸ‰ ê´€ë¦¬
- ê°ê°ì˜ ì±…ì„ì´ ëª…í™•í•˜ê²Œ ë¶„ë¦¬ë˜ì–´ ìˆìŒ
<br/>

### 7.2 ì»¬ë ‰ì…˜ ìº¡ìŠí™”í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Encapsulate Collection](https://refactoring.com/catalog/encapsulateCollection.html)
- ì˜ˆì‹œ
  - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex2)
  - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex2)

<br/>

**ë°°ê²½**
- ì €ìëŠ” ê°€ë³€ ë°ì´í„°ë¥¼ ëª¨ë‘ ìº¡ìŠí™”í•˜ëŠ” í¸ì´ë¼ ë§í•œë‹¤.
  - ë°ì´í„° êµ¬ì¡°ê°€ ì–¸ì œ ì–´ë–»ê²Œ ìˆ˜ì •ë˜ëŠ”ì§€ íŒŒì•…í•˜ê¸° ì‰¬ì›Œì„œ í•„ìš”í•œ ì‹œì ì— ë°ì´í„° êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ê¸°ë„ ì‰¬ì›Œì§€ê¸° ë•Œë¬¸ì´ë‹¤.
- ë‚´ë¶€ ì»¬ë ‰ì…˜ì„ ì§ì ‘ ìˆ˜ì •í•˜ì§€ ëª»í•˜ê²Œ í•˜ëŠ” ë°©ë²™ ì¤‘ í•˜ë‚˜ë¡œ
  - ì ˆëŒ€ë¡œ ì»¬ë ‰ì…˜ ê°’ì„ ë°˜í™˜í•˜ì§€ ì•Šê²Œ í•  ìˆ˜ ìˆë‹¤.
  - **ì»¬ë ‰ì…˜ì´ ì†Œì†ëœ í´ë˜ìŠ¤ì˜ ì ì ˆí•œ ë©”ì„œë“œë¥¼ ë°˜ë“œì‹œ ê±°ì¹˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.**
  - ì°¸ê³ . [ì»¬ë ‰ì…˜ íŒŒì´í”„ë¼ì¸ íŒ¨í„´](https://martinfowler.com/articles/collection-pipeline/)
- ì»¬ë ‰ì…˜ì„ ì½ê¸° ì „ìš©ìœ¼ë¡œ ì œê³µí•  ìˆ˜ ìˆë‹¤.
- ì„±ëŠ¥ì— ì§€ì¥ì„ ì¤„ ë§Œí¼ ì»¬ë ‰ì…˜ì´ í° ê²½ìš°ëŠ” ë³„ë¡œ ì—†ìœ¼ë‹ˆ ì„±ëŠ¥ì— ëŒ€í•œ **ì¼ë°˜ ê·œì¹™**ì„ ë”°ë¥´ë„ë¡ í•˜ì.
  - `ì°¸ê³ . ë§í¬ ì ‘ì† ë¶ˆê°€`
- ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ì ì€ ì½”ë“œë² ì´ìŠ¤ì— ì¼ê´€ì„±ì„ ì£¼ëŠ” ê²ƒì´ë‹¤.
- ì•ì— ë‚˜ì˜¨ ë°©ì‹ ì¤‘ì—ì„œ í•œ ê°€ì§€ë§Œ ì ìš©í•´ì„œ ì»¬ë ‰ì…˜ ì ‘ê·¼ í•¨ìˆ˜ì˜ ë™ì‘ ë°©ì‹ì„ í†µì¼í•´ì•¼ í•œë‹¤.
<br/>



**ì ˆì°¨**
- ì•„ì§ ì»¬ë ‰ì…˜ì„ ìº¡ìŠí™”í•˜ì§€ ì•Šì•˜ë‹¤ë©´ 'ë³€ìˆ˜ ìº¡ìŠí™”í•˜ê¸°'ë¶€í„° í•œë‹¤.
- ì»¬ë ‰ì…˜ì— ì›ì†Œë¥¼ ì¶”ê°€/ì œê±°í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì¶”ê°€í•œë‹¤.
- ì •ì  ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤. 
  - ë‚´ ìƒê°ì— `SonarQube`ì™€ ê°™ì€ ì •ì  ì½”ë“œ ë¶„ì„ ë„êµ¬ë¥¼ ëœ»í•˜ëŠ” ê±° ê°™ë‹¤
- ì»¬ë ‰ì…˜ì„ ì°¸ì¡°í•˜ëŠ” ë¶€ë¶„ì„ ëª¨ë‘ ì°¾ëŠ”ë‹¤.
  - ì»¬ë ‰ì…˜ì˜ ë³€ê²½ìë¥¼ í˜¸ì¶œí•˜ëŠ” ì½”ë“œê°€ ëª¨ë‘ ì•ì—ì„œ ì¶”ê°€í•œ ì¶”ê°€/ì œê±° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•œë‹¤.
  - í•˜ë‚˜ì”© ìˆ˜ì •í•  ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- ì»¬ë ‰ì…˜ ê²Œí„°ë¥¼ ìˆ˜ì •í•´ì„œ ì›ë³¸ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ëŠ” ì½ê¸° ì „ìš© í”„ë½ì‹œë‚˜ ë³µì œë³µì„ ë°˜í™˜í•˜ê²Œ í•œë‹¤.
- í…ŒìŠ¤íŠ¸í•œë‹¤.
<br/>

**ğŸ’©before**
```java
@DisplayName("ì™¸ë¶€ ì°¸ì¡°ë¥¼ ëŠì§€ ì•ŠëŠ” ê²½ìš°")  
@Test  
void addCourse1() {  
    List<Course> courses = new ArrayList<>();  
    courses.add(new Course("ì½”ìŠ¤1"));  
    courses.add(new Course("ì½”ìŠ¤2"));  
    Person person = new Person("name", courses);  
  
    courses.add(new Course("ì¶”ê°€ ì½”ë“œ", false)); // ğŸ’©
  
    assertThat(person.getCourses()).hasSize(3);  
}  
  
@DisplayName("ê°ì²´ ë‚´ë¶€ ì»¬ë ‰ì…˜ì„ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ëŠ” ê²½ìš°")  
@Test  
void addCourse2() {  
    List<Course> courses = new ArrayList<>();  
    courses.add(new Course("ì½”ìŠ¤1"));  
    courses.add(new Course("ì½”ìŠ¤2"));  
    Person person = new Person("name", courses);  
  
    person.getCourses().add(new Course("ì¶”ê°€ ì½”ë“œ", false));  // ğŸ’©
  
    assertThat(person.getCourses()).hasSize(3);  
}
```
<br/>

**âœ¨after**
```java
public class Person {  
    private final String name;  
    private final List<Course> courses;  
  
    public Person(String name, List<Course> courses) {  
        this.name = name;  
        this.courses = new ArrayList<>(courses);
    }  

    public void addCourse(Course aCourse) {  
        this.courses.add(aCourse);  
    }
    
	public boolean removeCourse(Course aCourse) {  
	    return this.courses.remove(aCourse);  
	}

	public int numAdvancedCourses() {  
	    return (int) this.courses.stream()  
	            .filter(Course::isAdvanced)  
	            .count();  
	}

    public String getName() {
        return this.name;
    }
}
```

> **NOTE** <br/>
> **ì €ìì˜ ê²½í—˜ì— ë”°ë¥´ë©´ ì»¬ë ‰ì…˜ì— ëŒ€í•´ì„œëŠ” ì–´ëŠ ì •ë³´ ê°•ë°•ì¦ì„ ê°–ê³  ë¶ˆí•„ìš”í•œ ë³µì œë³¸ì„ ë§Œë“œëŠ” í¸ì´ ì˜ˆìƒì¹˜ ëª»í•œ ìˆ˜ì •ì´ ì´‰ë°œí•œ ì˜¤ë¥˜ë¥¼ ë””ë²„ê¹…í•˜ëŠ” ê²ƒë³´ë‹¤ ë‚«ë‹¤.** 
> **ì €ìëŠ” ì»¬ë ‰ì…˜ì„ ë³€ê²½í•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì‘ì—…ì„ í•  ë•Œë„ ìŠµê´€ì ìœ¼ë¡œ ë³µì‚¬ë³¸ì„ ë§Œë“ ë‹¤ê³  ë§í•œë‹¤.**


<br/>

### 7.3 ê¸°ë³¸í˜•ì„ ê°ì²´ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Primitive with Object](https://refactoring.com/catalog/replacePrimitiveWithObject.html)
- ì˜ˆì‹œ:
  - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex3)
  - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex3)

<br/>

**ë°°ê²½**
- ê°œë°œ ì´ˆê¸°ì—ëŠ” ë‹¨ìˆœí•œ ì •ë³´ë¥¼ ìˆ«ìë‚˜ ë¬¸ìì—´ ê°™ì€ ê°„ë‹¨í•œ ë°ì´í„° í•­ëª©ìœ¼ë¡œ í‘œí˜„í•  ë•Œê°€ ë§ë‹¤.
  - ë‚˜ì¤‘ì— í¬ë§·íŒ…ì´ë‚˜ ì§€ì—­ ì½”ë“œ ì¶”ì¶œ ê°™ì€ íŠ¹ë³„í•œ ë™ì‘ì´ í•„ìš”í•´ì§ˆ ìˆ˜ ìˆë‹¤.
  - ì´ëŸ° ë¡œì§ë“¤ë¡œ ê¸ˆì„¸ ì¤‘ë³µ ì½”ë“œê°€ ëŠ˜ì–´ë‚˜ì„œ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ë“œëŠ” ë…¸ë ¥ë„ ëŠ˜ì–´ë‚˜ê²Œ ëœë‹¤.
- ì €ìëŠ” ë‹¨ìˆœí•œ ì¶œë ¥ ì´ìƒì˜ ê¸°ëŠ¥ì´ í•„ìš”í•´ì§€ëŠ” ìˆœê°„ ê·¸ ë°ì´í„°ë¥¼ í‘œí˜„í•˜ëŠ” ì „ìš© í´ë˜ìŠ¤ë¥¼ ì •ì˜í•˜ëŠ” í¸ì´ë¼ê³  ë§í•œë‹¤.
  - ë‚˜ì¤‘ì— íŠ¹ë³„í•œ ë™ì‘ì´ í•„ìš”í•´ì§€ë©´ ì´ í´ë˜ìŠ¤ì— ì¶”ê°€í•˜ë©´ ë˜ë‹ˆ í”„ë¡œê·¸ë¨ì´ ì»¤ì§ˆìˆ˜ë¡ ì ì  ìœ ìš©í•œ ë„êµ¬ê°€ ëœë‹¤.
- **âœ¨ë¦¬íŒ©í„°ë§ ì¤‘ì—ì„œë„ ê°€ì¥ ìœ ìš©í•œ ê²ƒìœ¼ë¡œ ì†ê¼½ëŠ”ë‹¤.**

<br/>

**ì ˆì°¨**
- ì•„ì§ ë³€ìˆ˜ë¥¼ ìº¡ìŠí™”í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ìº¡ìŠí™”í•œë‹¤.
- ë‹¨ìˆœí•œ ê°’(value) í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
  - ìƒì„±ìëŠ” ê¸°ì¡´ ê°’ì„ ì¸ìˆ˜ë¡œ ë°›ì•„ì„œ ì €ì¥í•˜ê³ , ì´ ê°’ì„ ë°˜í™˜í•˜ëŠ” ê²Œí„°ë¥¼ ì¶”ê°€í•œë‹¤. (**immutable, ë¶ˆë³€**)
- ì •ì  ê²€ì‚¬(`ex. SonarQube`)ë¥¼ ìˆ˜í–‰í•œë‹¤.
- ê°’ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì„œ í•„ë“œì— ì €ì¥í•˜ë„ë¡ ì„¸í„°ë¥¼ ìˆ˜ì •í•œë‹¤.
  - ì´ë¯¸ ìˆë‹¤ë©´ í•„ë“œì˜ íƒ€ì…ì„ ì ì ˆíˆ ë³€ê²½í•œë‹¤
- ìƒˆë¡œ ë§Œë“  í´ë˜ìŠ¤ì˜ ê²Œí„°ë¥¼ í˜¸ì¶œí•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ë„ë¡ ê²Œí„°ë¥¼ ìˆ˜ì •í•œë‹¤.
- í…ŒìŠ¤íŠ¸í•œë‹¤.
- í•¨ìˆ˜ ì´ë¦„ì„ ë°”ê¾¸ë©´ ì›ë³¸ ì ‘ê·¼ìì˜ ë™ì‘ì„ ë” ì˜ ë“œëŸ¬ë‚¼ ìˆ˜ ìˆëŠ”ì§€ ê²€í† í•œë‹¤.
  - ì°¸ì¡°ë¥¼ ê°’ìœ¼ë¡œ ë°”ê¾¸ê±°ë‚˜ ê°’ì„ ì°¸ì¡°ë¡œ ë°”ê¾¸ë©´ ìƒˆë¡œ ë§Œë“  ê°ì²´ì˜ ì—­í• ì´ ë” ì˜ ë“œëŸ¬ë‚˜ëŠ”ì§€ ê²€í† í•œë‹¤.

> ë””ìì¸ íŒ¨í„´ ì¤‘ ìƒíƒœ(State) íŒ¨í„´ì´ ìƒê°ë‚œë‹¤.

<br/>

**ğŸ’©before**
```java
public class Order {  
    private Priority priority;  
  
    public Order(Priority priority) {  
        this.priority = priority;  
    }  
  
    public String getPriorityString() {  
        return priority.getValue();  
    }  
  
    public void setPriority(String aString) {  
        this.priority = new Priority(aString);  
    }  
}


public class Priority {  
    private final String value;  
  
    public Priority(String value) {  
        this.value = value;  
    }  
  
    public String getValue() {  
        return value;  
    }  
}
```
```java
class OrderTest {
    @Test  
    void test() {  
        List<Order> orders = new ArrayList<>();  
        orders.add(new Order(new Priority("high")));  
        orders.add(new Order(new Priority("rush")));  
        orders.add(new Order(new Priority("normal")));  
  
        int highPriorityCount = (int) orders.stream()  
                .map(Order::getPriorityString)  
                .filter(p -> p.equals("high") || p.equals("rush"))  
                .count();  
  
        assertThat(highPriorityCount).isEqualTo(2);  
    }  
}
```

**ğŸ’£ë¬¸ì œì **<br/>
- `Priority` ê°’ì´ ë¬¸ìì—´(`String`)ë¡œ ê´€ë¦¬ë˜ê¸° ë•Œë¬¸ì— **ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ì™€ë„ ëŸ°íƒ€ì„ì—ì„œì•¼ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŒ**  
  - ì˜ˆ: `new Priority("hogh")` (ì˜¤íƒ€)
- í…ŒìŠ¤íŠ¸ ì‹œ `"high"` ë˜ëŠ” `"rush"` ê°™ì€ **ë§¤ì§ ìŠ¤íŠ¸ë§**ì„ ì§ì ‘ ë¹„êµí•´ì•¼ í•¨
- ìƒˆë¡œìš´ ìš°ì„ ìˆœìœ„ ê°’ì´ ì¶”ê°€ë  ë•Œ `"high"`, `"rush"` ë“±ì˜ ë¬¸ìì—´ì„ **ì—¬ëŸ¬ ê³³ì—ì„œ ì¼ì¼ì´ ì¶”ê°€í•´ì•¼ í•˜ëŠ” ë¬¸ì œ** ë°œìƒ


<br/>

**âœ¨after**
```java
public enum Priority {  
    LOW("low"),  
    NORMAL("normal"),  
    HIGH("high"),  
    RUSH("rush");  
  
    private final String value;  
  
    Priority2(String value) {  
        this.value = value;  
    }  
  
    public String getValue() {  
        return value;  
    }  
  
    public static Priority2 from(String value) {  
        return Arrays.stream(values())  
                .filter(p -> p.value.equalsIgnoreCase(value))  
                .findFirst()  
                .orElseThrow(() -> new IllegalArgumentException(value + "ëŠ” ìœ íš¨í•˜ì§€ ì•Šì€ ìš°ì„ ìˆœìœ„ì…ë‹ˆë‹¤"));  
    }  
  
    public boolean isHigher() {  
        return this == HIGH || this == RUSH;  
    }  
}


public class Order {
  private Priority priority; // enum ì‚¬ìš©

  public Order(String aString) {
    this(Priority.from(aString));
  }

  public Order(Priority priority) {
    this.priority = priority;
  }

  public boolean isHigher() {
    return priority.isHigher();
  }

  public String getPriorityString() {
    return priority.getValue();
  }

  public void setPriority(String aString) {
    this.priority = Priority.from(aString);
  }
}
```

```java
class OrderTest {
    @Test  
    void test() {  
        List<Order> orders = new ArrayList<>();  
        orders.add(new Order(Priority.HIGH));  
        orders.add(new Order(Priority.RUSH));  
        orders.add(new Order(Priority.NORMAL));  
  
        int highPriorityCount = (int) orders.stream()  
                .filter(Order::isHigher)  
                .count();  
  
        assertThat(highPriorityCount).isEqualTo(2);  
    }  
}
```

<br/>

### 7.4 ì„ì‹œ ë³€ìˆ˜ë¥¼ ì§ˆì˜ í•¨ìˆ˜ë¡œ ë°”ê¾¸ê¸°
- ì¹´íƒˆë¡œê·¸: [Replace Temp with Query](https://refactoring.com/catalog/replaceTempWithQuery.html)
- ì˜ˆì‹œ:
    - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex4)
    - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex4)

<br/>

**ë°°ê²½**
- ì„ì‹œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ê°’ì„ ê³„ì‚°í•˜ëŠ” ì½”ë“œê°€ ë°˜ë³µë˜ëŠ” ê±¸ ì¤„ì´ê³  (ë³€ìˆ˜ ì´ë¦„ì„ í†µí•´) ê°’ì˜ ì˜ë¯¸ë¥¼ ì„¤ëª…í•  ìˆ˜ë„ ìˆì–´ì„œ ìœ ìš©í•˜ë‹¤.
  - ê·¸ëŸ°ë° í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ ì•„ì˜ˆ í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ëŠ” í¸ì´ ë‚˜ì„ë•Œê°€ ë§ë‹¤.
- ë³€ìˆ˜ ëŒ€ì‹  í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ë‘ë©´ ë¹„ìŠ·í•œ ê³„ì‚°ì„ ìˆ˜í–‰í•˜ëŠ” ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ì½”ë“œ ì¤‘ë³µì´ ì¤„ì–´ë“ ë‹¤.
- ê³„ì‚°ë˜ëŠ” ë³€ìˆ˜ë¥¼ ë°œê²¬í•  ë•Œë§ˆë‹¤ í•¨ìˆ˜ë¡œ ë°”ê¿€ ìˆ˜ ìˆëŠ”ì§€ ì‚´í´ë³¸ë‹¤.
- ì´ë²ˆ ë¦¬íŒ©í„°ë§ì€ í´ë˜ìŠ¤ ì•ˆì—ì„œ ì ìš©í•  ë•Œ íš¨ê³¼ê°€ ê°€ì¥ í¬ë‹¤.
- ë³µì¡í•œ ì½”ë“œ ë©ì–´ë¦¬ì—ì„œ ì—¬ëŸ¬ ì°¨ë¡€ ë‹¤ì‹œ ëŒ€ì…í•˜ëŠ” ê²½ìš°ëŠ” ëª¨ë‘ ì§ˆì˜ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•´ì•¼ í•œë‹¤.
<br/>

**ì ˆì°¨**
- ë³€ìˆ˜ê°€ ì‚¬ìš©ë˜ê¸° ì „ì— ê°’ì´ í™•ì‹¤íˆ ê²°ì •ë˜ëŠ”ì§€, ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ ê³„ì‚° ë¡œì§ì´ ë§¤ë²ˆ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë‚´ì§€ëŠ” ì•ŠëŠ”ì§€ í™•ì¸í•œë‹¤.
- ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ë³€ìˆ˜ëŠ” ì½ê¸° ì „ìš©ìœ¼ë¡œ ë§Œë“ ë‹¤. 
- í…ŒìŠ¤íŠ¸í•œë‹¤.
- ë³€ìˆ˜ ëŒ€ì…ë¬¸ì„ í•¨ìˆ˜ë¡œ ì¶”ì¶œí•œë‹¤.
- í…ŒìŠ¤íŠ¸í•œë‹¤.
- `ë³€ìˆ˜ ì¸ë¼ì¸í•˜ê¸°`ë¡œ ì„ì‹œ ë³€ìˆ˜ë¥¼ ì œê±°í•œë‹¤.
<br/>

**ğŸ’©before**
```java
public class Order {  
    private final int quantity;  
    private final Item item;  
  
    public Order(int quantity, Item item) {  
        this.quantity = quantity;  
        this.item = item;  
    }  
  
    public double price() {  
        final int basePrice = this.quantity * this.item.getPrice();  
        double discountFactor = 0.98;  
  
        if(basePrice > 1000) discountFactor -= 0.03;  
  
        return basePrice * discountFactor;  
    }  
}


public class Item {  
    private final int price;  
  
    public Item(int price) {  
        this.price = price;  
    }  
  
    public int getPrice() {  
        return price;  
    }  
}
```
<br/>

**âœ¨after**
```java
public class Order {  
    private final int quantity;  
    private final Item item;  
  
    public Order(int quantity, Item item) {  
        this.quantity = quantity;  
        this.item = item;  
    }  
  
    public double price() {  
        return basePrice() * discountFactor();  
    }  
  
    private int basePrice() {  
        return this.quantity * this.item.getPrice();  
    }  
  
    private double discountFactor() {  
        double discountFactor = 0.98;  
        if(basePrice() > 1000) discountFactor -= 0.03;  
        return discountFactor;  
    }  
}
```
<br/>

### 7.5 í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Extract Class](https://refactoring.com/catalog/extractClass.html)
- ì˜ˆì‹œ: 
    - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex5)
    - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex5)

<br/>

**ë°°ê²½**
- **í´ë˜ìŠ¤**ëŠ” ë°˜ë“œì‹œ ëª…í™•í•˜ê²Œ ì¶”ìƒí™”í•˜ê³  ì†Œìˆ˜ì˜ ì£¼ì–´ì§„ ì—­í• ë§Œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤ëŠ” ê°€ì´ë“œë¼ì¸ì„ ë“¤ì–´ë´¤ì„ ê²ƒì´ë‹¤.
  - ë³´í†µ ì¼ì„ í•˜ë‚˜ë³´ë©´ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì˜ ì—­í• ì´ ë§ì•„ì§€ê³  ìƒˆë¼ë¥¼ ì¹˜ë©´ì„œ í´ë˜ìŠ¤ê°€ êµ‰ì¥íˆ ë³µì¡í•´ì§„ë‹¤.
- ë©”ì„œë“œì™€ ë°ì´í„°ê°€ ë„ˆë¬´ ë§ì€ í´ë˜ìŠ¤ëŠ” ì´í•´í•˜ê¸°ê°€ ì‰½ì§€ ì•Šìœ¼ë‹ˆ ì˜ ì‚´í´ë³´ê³  ì ì ˆíˆ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
  - **íŠ¹íˆ ì¼ë¶€ ë°ì´í„°ì™€ ë©”ì„œë“œë¥¼ ë”°ë¡œ ë¬¶ì„ ìˆ˜ ìˆë‹¤ë©´ ì–´ì„œ ë¶„ë¦¬í•˜ë¼ëŠ” ì‹ í˜¸ë‹¤.**
- ì˜ˆì»¨ëŒ€ ì‘ì€ ì¼ë¶€ì˜ ê¸°ëŠ¥ë§Œì„ ìœ„í•´ ì„œë¸Œ í´ë˜ìŠ¤ë¥´ ë§Œë“¤ê±°ë‚˜, í™•ì¥í•´ì•¼ í•  ê¸°ëŠ¥ì´ ë¬´ì—‡ì´ëƒì— ë”°ë¼ ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ë§Œë“œëŠ” ë°©ì‹ë„ ë‹¬ë¼ì§„ë‹¤ë©´ **í´ë˜ìŠ¤ë¥¼ ë‚˜ëˆ ì•¼ í•œë‹¤ëŠ” ì‹ í˜¸ë‹¤.**
<br/>

**ì ˆì°¨**
- í´ë˜ìŠ¤ì˜ ì—­í• ì„ ë¶„ë¦¬í•  ë°©ë²•ì„ ì •í•œë‹¤.
- ë¶„ë¦¬ë  ì—­í• ì„ ë‹´ë‹¹í•  í´ë˜ìŠ¤ë¥¼ ìƒˆë¡œ ë§Œë“ ë‹¤.
- ì›ë˜ í´ë˜ìŠ¤ì˜ ìƒì„±ìì—ì„œ ìƒˆë¡œìš´ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ í•„ë“œì— ì €ì¥í•´ë‘”ë‹¤.
- ë¶„ë¦¬ë  ì—­í• ì— í•„ìš”í•œ í•„ë“œë“¤ì„ ìƒˆ í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤.
  - í•˜ë‚˜ì”© ì˜®ê¸¸ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- ë©”ì„œë“œë“¤ë„ ìƒˆ í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤.
  - ì´ë•Œ ì €ìˆ˜ì¤€ ë©”ì„œë“œ, ì¦‰ ë‹¤ë¥¸ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ë³´ë‹¤ëŠ” í˜¸ì¶œì„ ë‹¹í•˜ëŠ” ì¼ì´ ë§ì€ ë©”ì„œë“œë¶€í„° ì˜®ê¸´ë‹¤.
  - í•˜ë‚˜ì”© ì˜®ê¸¸ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- ì–‘ìª½ í´ë˜ìŠ¤ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚´í´ë³´ë©´ì„œ ë¶ˆí•„ìš”í•œ ë©”ì„œë“œë¥¼ ì œê±°í•˜ê³ , ì´ë¦„ë„ ìƒˆë¡œìš´ í™˜ê²½ì— ë§ê²Œ ë°”ê¾¼ë‹¤.
- ìƒˆ í´ë˜ìŠ¤ë¥¼ ì˜¤ì´ë¶€ë¡œ ë…¸ì¶œí• ì§€ ì •í•œë‹¤.
  - ë…¸ì¶œí•˜ë ¤ê±°ë“  ìƒˆ í´ë˜ìŠ¤ì— 'ì°¸ì¡°ë¥¼ ê°’ìœ¼ë¡œ ë°”ê¾¸ê¸°'ë¥¼ ì ìš©í• ì§€ ê³ ë¯¼í•´ë³¸ë‹¤.
<br/>

**ğŸ’©before**
```java
public class Person {  
    private String name;  
    private String officeAreaCode;  
    private String officeNumber;  
  
    public Person(String name, String officeAreaCode, String officeNumber) {  
        this.name = name;  
        this.officeAreaCode = officeAreaCode;  
        this.officeNumber = officeNumber;  
    }  
  
    // getter, setter
}
```
<br/>

**âœ¨after**
```java
public class Person {
    private String name;
    private TelephoneNumber telephoneNumber;

    public Person(String name, TelephoneNumber telephoneNumber) {
        this.name = name;
        this.telephoneNumber = telephoneNumber;
    }
    
    // getter, setter ìƒëµ
}


public class TelephoneNumber {
    private String areaCode;
    private String number;

    public TelephoneNumber(String areaCode, String number) {
        this.areaCode = areaCode;
        this.number = number;
    }
    
    // getter, setter ìƒëµ
}
```

<br/>

### 7.6 í´ë˜ìŠ¤ ì¸ë¼ì¸í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Inline Class](https://refactoring.com/catalog/inlineClass.html) 
- ì˜ˆì‹œ: 
    - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex6)
    - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex6)

<br/>

**ë°°ê²½**
- ë” ì´ìƒ ì œ ì—­í• ì„ ëª» í•´ì„œ ê·¸ëŒ€ë¡œ ë‘ë©´ ì•ˆë˜ëŠ” í´ë˜ìŠ¤ëŠ” ì¸ë¼ì¸í•´ë²„ë¦°ë‹¤.
- íŠ¹ì • í´ë˜ìŠ¤ì— ë‚¨ì€ ì—­í• ì´ ê±°ì˜ ì—†ì„ ë•Œ ì´ëŸ° í˜„ìƒì´ ìì£¼ ìƒê¸´ë‹¤.
- ì´ëŸ´ë• ì´ ë¶ˆìŒí•œ í´ë˜ìŠ¤ë¥¼ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ë¡œ í¡ìˆ˜ì‹œí‚¤ì.
<br/>

**ì ˆì°¨**
- ì†ŒìŠ¤ í´ë˜ìŠ¤ì˜ ê° public ë©”ì„œë“œì— ëŒ€ì‘í•˜ëŠ” ë©”ì„œë“œë“¤ì„ íƒ€ê¹ƒ í´ë˜ìŠ¤ì— ìƒì„ í•œë‹¤.
  - ì´ ë©”ì„œë“œë“¤ì€ ë‹¨ìˆœíˆ ì‘ì—…ì„ ì†ŒìŠ¤ í´ë˜ìŠ¤ë¡œ ìœ„ì„í•´ì•¼ í•œë‹¤.
- ì†ŒìŠ¤ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë¥¼ ëª¨ë‘ íƒ€ê¹ƒ í´ë˜ìŠ¤ì˜ ìœ„ì„ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë°”ê¾¼ë‹¤.
  - í•˜ë‚˜ì”© ë°”ê¿€ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- ì†ŒìŠ¤ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œì™€ í•„ë“œë¥¼ ëª¨ë‘ íƒ€ê¹ƒ í´ë˜ìŠ¤ë¡œ ì˜®ê¸´ë‹¤.
  - í•˜ë‚˜ì”© ë°”ê¿€ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- **ì†ŒìŠ¤ í´ë˜ìŠ¤ë¥¼ ì‚­ì œí•˜ê³  ì¡°ì˜ë¥¼ í‘œí•œë‹¤**(ğŸ˜¢ğŸ˜‚)
<br/>

**ğŸ’©before**
```java
public class TrackingInformation {  
    private String shippingCompany; // ë°°ì†¡ íšŒì‚¬  
    private String trackingNumber; // ì¶”ì  ë²ˆí˜¸  
  
    public TrackingInformation(String shippingCompany, String trackingNumber) {  
        this.shippingCompany = shippingCompany;  
        this.trackingNumber = trackingNumber;  
    }  
  
    public String display() {  
        return String.format("%s: %s", this.shippingCompany, this.trackingNumber);  
    }  
}


public class Shipment {  
    private TrackingInformation trackingInformation;  
  
    public Shipment(TrackingInformation trackingInformation) {  
        this.trackingInformation = trackingInformation;  
    }  
  
    public String display() {  
        return trackingInformation.display();  
    }  
  
    public TrackingInformation getTrackingInformation() {  
        return trackingInformation;  
    }  
  
    public void setTrackingInformation(TrackingInformation trackingInformation) {  
        this.trackingInformation = trackingInformation;  
    }  
}
```
<br/>

**âœ¨after**
```java
public class Shipment {  
    private String shippingCompany; // ë°°ì†¡ íšŒì‚¬  
    private String trackingNumber; // ì¶”ì   
  
    public Shipment(String shippingCompany, String trackingNumber) {  
        this.shippingCompany = shippingCompany;  
        this.trackingNumber = trackingNumber;  
    }  
  
    public String display() {  
        return String.format("%s: %s", this.shippingCompany, this.trackingNumber);  
    }  
  
    public void setShippingCompany(String arg) {  
        this.shippingCompany = arg;  
    }  
  
    public void setTrackingNumber(String arg) {  
        this.trackingNumber = arg;  
    }  
}
```

<br/>

### 7.7 ìœ„ì„ ìˆ¨ê¸°ê¸°
- ì¹´íƒˆë¡œê·¸: [Hide Delegate](https://refactoring.com/catalog/hideDelegate.html)
- ì˜ˆì‹œ: 
    - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex7)
    - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex7)

<br/>

**ë°°ê²½**
- ëª¨ë“ˆí™” ì„¤ê³„ì˜ í•µì‹¬ì€ **ìº¡ìŠí™”**ë‹¤.
  - **ìº¡ìŠí™”**ëŠ” ëª¨ë“ˆë“¤ì´ ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ ë¶€ë¶„ì— ëŒ€í•´ ì•Œì•„ì•¼ í•  ë‚´ìš©ì„ ì¤„ì—¬ì¤€ë‹¤.
  - ìº¡ìŠí™”ê°€ ì˜ ë˜ì–´ ìˆë‹¤ë©´ ë¬´ì–¸ê°€ë¥¼ ë³€ê²½í•´ì•¼ í•  ë•Œ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•  ëª¨ë“ˆ ìˆ˜ê°€ ì ì–´ì ¸ì„œ ì½”ë“œë¥¼ ë³€ê²½í•˜ê¸°ê°€ í›¨ì”¬ ì‰¬ì›Œì§„ë‹¤.
- ê°ì²´ ì§€í–¥ì„ ì²˜ìŒ ë°°ìš¸ ë•Œ **ìº¡ìŠí™”ë€ í•„ë“œë¥¼ ìˆ¨ê¸°ëŠ” ê²ƒ**ì´ë¼ê³  ë°°ìš°ì§€ë§Œ, ê²½í—˜ì´ ìŒ“ì´ë©´ ìº¡ìŠí™”ì˜ ì—­í• ì´ ê·¸ë³´ë‹¤ ë§ë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹«ëŠ”ë‹¤.
- **ìœ„ì„ ê°ì²´ì˜ ì¡´ì¬ë¥¼ ìˆ¨ê¹€**ìœ¼ë¡œì¨, ìœ„ì„ ê°ì²´ê°€ ìˆ˜ì •ë˜ë”ë¼ë„ ì„œë²„ ì½”ë“œë§Œ ê³ ì¹˜ë©´ ë˜ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ì•„ë¬´ëŸ° ì˜í–¥ì„ ë°›ì§€ ì•Šê²Œ ëœë‹¤.
  <br/>

**ì ˆì°¨**
- ìœ„ì„ ê°ì²´ì˜ ê° ë©”ì„œë“œì— í•´ë‹¹í•˜ëŠ” ìœ„ì„ ë©”ì„œë“œë¥¼ ì„œë²„ì— ìƒì„±í•œë‹¤.
- í´ë¼ì´ì–¸íŠ¸ê°€ ìœ„ì„ ê°ì²´ ëŒ€ì‹  ì„œë²„ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •í•œë‹¤. 
  - í•˜ë‚˜ì”© ë°”ê¿€ ë–„ë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- ëª¨ë‘ ìˆ˜ì •í–ˆë‹¤ë©´, ì„œë²„ë¡œë¶€í„° ìœ„ì„ ê°ì²´ë¥¼ ì–»ëŠ” ì ‘ê·¼ìë¥¼ ì œê±°í•œë‹¤.
- í…ŒìŠ¤íŠ¸í•œë‹¤.
<br/>

**ğŸ’©before**
```java
public class Person {  
    private final String name;  
    private Department department;  
  
    public Person(String name, Department department) {  
        this.name = name;  
        this.department = department;  
    }  
  
    public String getName() {  
        return name;  
    }  
  
    public Department getDepartment() {  
        return department;  
    }  
  
    public void setDepartment(Department department) {  
        this.department = department;  
    }  
  
    public static class Department {  
        private String chargeCode;  
        private String manager;  
  
        public Department(String chargeCode, String manager) {  
            this.chargeCode = chargeCode;  
            this.manager = manager;  
        }  
  
        public String getChargeCode() {  
            return chargeCode;  
        }  
  
        public void setChargeCode(String chargeCode) {  
            this.chargeCode = chargeCode;  
        }  
  
        public String getManager() {  
            return manager;  
        }  
  
        public void setManager(String manager) {  
            this.manager = manager;  
        }  
    }  
}
```

```java
import static org.assertj.core.api.Assertions.assertThat;  
  
class PersonTest {  
  
    @Test  
    void manager() {  
        Person person = new Person("tester", new Person.Department("001", "toby"));  
    
        String manager = person.getDepartment().getManager(); // ğŸ’© 
  
        assertThat(manager).isEqualTo("toby");  
    }  
}
```
- í´ë¼ì´ì–¸íŠ¸ëŠ” ë¶€ì„œ í´ë˜ìŠ¤ì˜ ì‘ë™ ë°©ì‹, ë‹¤ì‹œ ë§í•´ ë¶€ì„œ í´ë˜ìŠ¤ê°€ ê´€ë¦¬ì ì •ë³´ë¥¼ ì œê³µí•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì•„ì•¼ í•œë‹¤.
- ì´ëŸ¬í•œ ì˜ì¡´ì„±ì„ ì¤„ì´ë ¤ë©´ í´ë¼ì´ì–¸íŠ¸ê°€ ë¶€ì„œ í´ë˜ìŠ¤ë¥¼ ì•Œìˆ˜ ì—†ê²Œ ìˆ¨ê¸°ê³ , ëŒ€ì‹  ì‚¬ëŒ í´ë˜ìŠ¤ì— ê°„ë‹¨í•œ ìœ„ì„ ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ ëœë‹¤.
  <br/>

**âœ¨after**
```java
public class Person {
	//..
	
	public String manager() {  // ìœ„ì„ ë©”ì„œë“œ (= í¬ì›Œë”© ë©”ì„œë“œ?)
	    return this.department.getManager();  
	}
}
```

```java
class PersonTest {  
  
    @Test  
    void manager() {  
        Person person = new Person("tester", new Person.Department("001", "toby"));  
  
        String manager = person.manager();  //âœ¨
  
        assertThat(manager).isEqualTo("toby");  
    }  
}
```

<br/>

### 7.8 ì¤‘ê°œì ì œê±°í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Remove Middle Man](https://refactoring.com/catalog/removeMiddleMan.html)
- ğŸ™…ì˜ˆì‹œ ì½”ë“œ ìƒëµ â€â™‚ï¸

<br/>

**ë°°ê²½**
- ë‹¨ìˆœíˆ ì „ë‹¬ë§Œ í•˜ëŠ” ìœ„ì„ ë©”ì„œë“œë“¤ì´ ì ì  ì„±ê°€ì…”ì§„ë‹¤.
- ê·¸ëŸ¬ë©´ ì„œë²„ í´ë˜ìŠ¤ëŠ” ê·¸ì € ì¤‘ê°œì(`middle man`) ì—­í• ë¡œ ì „ëµí•˜ì—¬, ì°¨ë¼ë¦¬ í´ë¼ì´ì–¸íŠ¸ê°€ ìœ„ì„ ê°ì²´ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ê²Œ ë‚˜ì„ ìˆ˜ ìˆë‹¤
  - í•„ìš”í•˜ë©´ ì–¸ì œë“  ê· í˜•ì ì„ ì˜®ê¸¸ ìˆ˜ ìˆë‹¤.
  - ì‹œìŠ¤í…œì´ ë°”ë€Œë©´ 'ì ì ˆí•˜ë‹¤'ì˜ ê¸°ì¤€ë„ ë°”ë€Œê¸° ë§ˆë ¨ì´ë‹¤.
  - ë¦¬íŒ©í„°ë§ì€ ê²°ì½” ë¯¸ì•ˆí•˜ë‹¤ê³  ë§í•˜ì§€ ì•ŠëŠ”ë‹¤. `"ì¦‰ì‹œ ê³ ì¹  ë¿ì´ë‹¤"` 
    
> **INFO** ì†Œì„¤ 'ëŸ¬ë¸Œ ìŠ¤í† ë¦¬'ì™€ ì´ë¥¼ ì˜í™”í™”í•œ ë™ëª…ì˜ ì˜í™”ì— ë‚˜ì˜¨ ëŒ€ì‚¬ 'Love means never having to say you're sorry'ë¥¼ íŒ¨ëŸ¬ë””í•œ ë¬¸ì¥ì´ë‹¤

<br/>

**ì ˆì°¨**
- ìœ„ì„ ê°ì²´ë¥¼ ì–»ëŠ” ê²Œí„°ë¥¼ ë§Œë“ ë‹¤.
- ìœ„ì„ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ëª¨ë‘ ì´ ê²Œí„°ë¥¼ ê±°ì¹˜ë„ë¡ ìˆ˜ì •í•œë‹¤. 
  - í•˜ë‚˜ì”© ë°”ê¿€ ë•Œë§ˆë‹¤ í…ŒìŠ¤íŠ¸í•œë‹¤.
- ëª¨ë‘ ìˆ˜ì •í–ˆë‹¤ë©´ ìœ„ì„ ë©”ì„œë“œë¥¼ ì‚­ì œí•œë‹¤.
<br/>

**ğŸ’©before**
```java
String manager = aPerson.manager();

// Person í´ë˜ìŠ¤
public String manager() { return this.deparatment.manager();}

// Department í´ë˜ìŠ¤ 
public String manager() { return this.manager; }
```
<br/>

**âœ¨after**
```java
// Person í´ë˜ìŠ¤
public Department department() {return this.department;}

// í´ë¼ì´ì–¸íŠ¸
String manager = aPerson.department().manager();
```

> **NOTE** <br/>
> ìµœì†Œ ì§€ì‹ ì›ì¹™(principle of least knowledge)ì€ ë‚´ë¶€ ì •ë³´ë¥¼ ê°€ëŠ¥í•œ í•œ ìˆ¨ê¸°ê³  ë°€ì ‘í•œ ëª¨ë“ˆê³¼ë§Œ ìƒí˜¸ì‘ìš©í•˜ì—¬ ê²°í•©ë„ë¥¼ ë‚®ì¶”ëŠ” ì›ì¹™ì´ë‹¤. 
> ìì¹«í•˜ë©´ ì´ ê³¼ì •ì—ì„œ ìœ„ì„ í˜¹ì€ ë˜í¼(wrapper) ë©”ì„œë“œê°€ ë„ˆë¬´ ëŠ˜ì–´ë‚˜ëŠ” ë“±ì˜ ë¶€ì‘ìš©ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ìƒí™©ì— ë§ê²Œ ì‘ìš©í•˜ëŠ”ê²Œ ì¢‹ë‹¤.

<br/>

### 7.9 ì•Œê³ ë¦¬ì¦˜ êµì²´í•˜ê¸°
- ì¹´íƒˆë¡œê·¸: [Substitute Algorithm](https://refactoring.com/catalog/substituteAlgorithm.html)
- ì˜ˆì‹œ: 
    - [êµ¬í˜„ ì½”ë“œ](../src/main/java/com/example/refactoring2/ch07/ex9)
    - [í…ŒìŠ¤íŠ¸ ì½”ë“œ](../src/test/java/com/example/refactoring2/ch07/ex9)

<br/>

**ë°°ê²½**
- ì–´ë–¤ ëª©ì ì„ ë‹¬ì„±í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆê² ì§€ë§Œ ë‹¤ë¥¸ ê²ƒë³´ë‹¤ ë” ì‰¬ìš´ ë°©ë²•ì´ ë¶„ëª…íˆ ì¡´ì¬í•œë‹¤.
- ë” ê°„ëª…í•œ ë°©ë²•ì„ ì°¾ì•„ë‚´ë©´ ë³µì¡í•œ ê¸°ì¡´ ì½”ë“œë¥¼ ê°„ëª…í•œ ë°©ì‹ìœ¼ë¡œ ê³ ì¹œë‹¤. (`ê°„ëª…í•˜ë‹¤: ê°„ë‹¨ ëª…ë£Œí•˜ë‹¤`)
- ë•Œë¡œëŠ” ì•Œê³ ë¦¬ì¦˜ ì „ì²´ë¥¼ ê±·ì–´ë‚´ê³  í›¨ì”¬ ê°„ê²°í•œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ë°”ê¿”ì•¼ í•  ë•Œê°€ ìˆë‹¤.
- ë¬¸ì œë¥¼ ë” í™•ì‹¤íˆ ì´í•´í•˜ê³  í›¨ì”¬ ì‰½ê²Œ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ë°œê²¬í–ˆì„ ë–„ ì´ë ‡ê²Œ í•œë‹¤.
<br/>

**ì ˆì°¨**
- êµì²´í•  ì½”ë“œë¥¼ í•¨ìˆ˜ í•˜ë‚˜ì— ëª¨ì€ë‹¤
- ì´ í•¨ìˆ˜ë§Œì„ ì´ìš©í•´ ë™ì‘ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§ˆë ¨í•œë‹¤
- ëŒ€ì²´í•  ì•Œê³ ë¦¬ì¦˜ì„ ì¤€ë¹„í•œë‹¤
- ì •ì  ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•œë‹¤
- ê¸°ì¡´ ì•Œê³ ë¦¬ì¦˜ê³¼ ìƒˆ ì•Œê³ ë¦¬ì¦˜ì˜ ê²°ê³¼ë¥¼ ë¹„êµí•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•œë‹¤
  - ë‘ ê²°ê³¼ê°€ ê°™ë‹¤ë©´ ë¦¬íŒ©í„°ë§ì´ ëë‚œë‹¤
  - ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ê¸°ì¡´ ì•Œê³ ë¦¬ì¦˜ì„ ì°¸ê³ í•´ì„œ ìƒˆ ì•Œê³ ë¦¬ì¦˜ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ë””ë²„ê¹…í•œë‹¤
<br/>

**ğŸ’©before**
```java
public class Person {
    public String foundPerson(String[] peoples) {
        for(int i = 0; i < peoples.length; i++) {
            if(people[i].equals("Don")) {
                return "Don";
            }

            if(people[i].equals("John")) {
                return "Don";
            }

            if(people[i].equals("Jane")) {
                return "Don";
            }
        }
        
        return "";
    }
}

```
<br/>

**âœ¨after**
```java
public class Person {

    public String foundPerson(String[] peoples) {
        List<String> candidate = List.of("Don", "John", "Jane");

        return Arrays.stream(peoples)
                .filter(candidate::contains)
                .findFirst()
                .orElse("");
    }

}
```
<br/>

---
### Reference
- `7.1 ë ˆì½”ë“œ ìº¡ìŠí™”í•˜ê¸°`
  - [Refactoring Code to Load a Document](https://martinfowler.com/articles/refactoring-document-load.html)
- `7.2 ì»¬ë ‰ì…˜ ìº¡ìŠí™”í•˜ê¸°`
  - [Collection Pipeline íŒ¨í„´](https://martinfowler.com/articles/collection-pipeline/)
- `7.5 í´ë˜ìŠ¤ ì¶”ì¶œí•˜ê¸°`
  - [Value Object](https://martinfowler.com/bliki/ValueObject.html)
